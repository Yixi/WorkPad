/**
 Author: liuyixi
 this is lincence
*/
var workpad={version:"0.0.1",util:{},dom:{},commands:{},ui:{},views:{},log:{},data:{},EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,KEYS:{BACKSPACE_KEY:8,TAB_KEY:9,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,END_KEY:35,HOME_KEY:36,LEFT_KEY:37,UP_KEY:38,RIGHT_KEY:39,DOWN_KEY:40,DELETE_KEY:46,A_KEY:65,C_KEY:67,X_KEY:88,V_KEY:86,Z_KEY:90}},Base=function(){};
Base.extend=function(a,c){var b=Base.prototype.extend;Base._prototyping=!0;var e=new this;b.call(e,a);e.base=function(){};delete Base._prototyping;var g=e.constructor,h=e.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==h)this._constructing=!0,g.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||b).call(arguments[0],e)};h.ancestor=this;h.extend=this.extend;h.forEach=this.forEach;h.implement=this.implement;h.prototype=
e;h.toString=this.toString;h.valueOf=function(a){return"object"==a?h:g.valueOf()};b.call(h,c);"function"==typeof h.init&&h.init();return h};
Base.prototype={extend:function(a,c){if(1<arguments.length){var b=this[a];if(b&&"function"==typeof c&&(!b.valueOf||b.valueOf()!=c.valueOf())&&/\bbase\b/.test(c)){var e=c.valueOf();c=function(){var a=this.base||Base.prototype.base;this.base=b;var c=e.apply(this,arguments);this.base=a;return c};c.valueOf=function(a){return"object"==a?c:e};c.toString=Base.toString}this[a]=c}else if(a){var g=Base.prototype.extend;!Base._prototyping&&"function"!=typeof this&&(g=this.extend||g);for(var h={toSource:null},
n=["constructor","toString","valueOf"],l=Base._prototyping?0:1;j=n[l++];)a[j]!=h[j]&&g.call(this,j,a[j]);for(var j in a)h[j]||g.call(this,j,a[j])}return this}};
Base=Base.extend({constructor:function(a){this.extend(a)}},{ancestor:Object,version:"1.1",forEach:function(a,c,b){for(var e in a)void 0===this.prototype[e]&&c.call(b,a[e],e,a)},implement:function(){for(var a=0;a<arguments.length;a++)if("function"==typeof arguments[a])arguments[a](this.prototype);else this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}});
window.rangy=function(){function a(a,m){var b=typeof a[m];return b==v||!!(b==j&&a[m])||"unknown"==b}function c(a,m){return!!(typeof a[m]==j&&a[m])}function b(a,m){return typeof a[m]!=p}function e(a){return function(m,b){for(var c=b.length;c--;)if(!a(m,b[c]))return!1;return!0}}function g(a){return a&&q(a,f)&&C(a,y)}function h(a){window.alert("Rangy not supported in your browser. Reason: "+a);r.initialized=!0;r.supported=!1}function n(){if(!r.initialized){var m,b=!1,f=!1;a(document,"createRange")&&
(m=document.createRange(),q(m,u)&&C(m,s)&&(b=!0),m.detach());if((m=c(document,"body")?document.body:document.getElementsByTagName("body")[0])&&a(m,"createTextRange"))m=m.createTextRange(),g(m)&&(f=!0);!b&&!f&&h("Neither Range nor TextRange are implemented");r.initialized=!0;r.features={implementsDomRange:b,implementsTextRange:f};b=K.concat(F);f=0;for(m=b.length;f<m;++f)try{b[f](r)}catch(e){c(window,"console")&&a(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",
e)}}}function l(a){this.name=a;this.supported=this.initialized=!1}var j="object",v="function",p="undefined",s="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer START_TO_START START_TO_END END_TO_START END_TO_END".split(" "),u="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),
y="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),f="collapse compareEndPoints duplicate getBookmark moveToBookmark moveToElementText parentElement pasteHTML select setEndPoint getBoundingClientRect".split(" "),q=e(a),m=e(c),C=e(b),r={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:a,isHostObject:c,isHostProperty:b,areHostMethods:q,areHostObjects:m,areHostProperties:C,isTextRange:g},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};
r.fail=h;r.warn=function(a){a="Rangy warning: "+a;r.config.alertOnWarn?window.alert(a):typeof window.console!=p&&typeof window.console.log!=p&&window.console.log(a)};({}).hasOwnProperty?r.util.extend=function(a,m){for(var b in m)m.hasOwnProperty(b)&&(a[b]=m[b])}:h("hasOwnProperty not supported");var F=[],K=[];r.init=n;r.addInitListener=function(a){r.initialized?a(r):F.push(a)};var G=[];r.addCreateMissingNativeApiListener=function(a){G.push(a)};r.createMissingNativeApi=function(a){a=a||window;n();
for(var m=0,b=G.length;m<b;++m)G[m](a)};l.prototype.fail=function(a){this.initialized=!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+a);};l.prototype.warn=function(a){r.warn("Module "+this.name+": "+a)};l.prototype.createError=function(a){return Error("Error in Rangy "+this.name+" module: "+a)};r.createModule=function(a,m){var b=new l(a);r.modules[a]=b;K.push(function(a){m(a,b);b.initialized=!0;b.supported=!0})};r.requireModules=function(a){for(var m=0,b=a.length,c,f;m<
b;++m){f=a[m];c=r.modules[f];if(!c||!(c instanceof l))throw Error("Module '"+f+"' not found");if(!c.supported)throw Error("Module '"+f+"' not supported");}};var E=!1,m=function(){E||(E=!0,r.initialized||n())};if(typeof window==p)h("No window found");else if(typeof document==p)h("No document found");else return a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",m,!1),a(window,"addEventListener")?window.addEventListener("load",m,!1):a(window,"attachEvent")?window.attachEvent("onload",
m):h("Window does not have required addEventListener or attachEvent method"),r}();
rangy.createModule("DomUtil",function(a,c){function b(a){for(var b=0;a=a.previousSibling;)b++;return b}function e(a,b){var c=[],f;for(f=a;f;f=f.parentNode)c.push(f);for(f=b;f;f=f.parentNode)if(q(c,f))return f;return null}function g(a,b,c){for(c=c?a:a.parentNode;c;){a=c.parentNode;if(a===b)return c;c=a}return null}function h(a){a=a.nodeType;return 3==a||4==a||8==a}function n(a,b){var c=b.nextSibling,f=b.parentNode;c?f.insertBefore(a,c):f.appendChild(a);return a}function l(a){if(9==a.nodeType)return a;
if(typeof a.ownerDocument!=u)return a.ownerDocument;if(typeof a.document!=u)return a.document;if(a.parentNode)return l(a.parentNode);throw Error("getDocument: no document found for node");}function j(a){return!a?"[No node]":h(a)?'"'+a.data+'"':1==a.nodeType?"<"+a.nodeName+(a.id?' id="'+a.id+'"':"")+">["+a.childNodes.length+"]":a.nodeName}function v(a){this._next=this.root=a}function p(a,b){this.node=a;this.offset=b}function s(a){this.code=this[a];this.codeName=a;this.message="DOMException: "+this.codeName}
var u="undefined",y=a.util;y.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||c.fail("document missing a Node creation method");y.isHostMethod(document,"getElementsByTagName")||c.fail("document missing getElementsByTagName method");var f=document.createElement("div");y.areHostMethods(f,["insertBefore","appendChild","cloneNode"])||c.fail("Incomplete Element implementation");y.isHostProperty(f,"innerHTML")||c.fail("Element is missing innerHTML property");f=document.createTextNode("test");
y.areHostMethods(f,["splitText","deleteData","insertData","appendData","cloneNode"])||c.fail("Incomplete Text Node implementation");var q=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};v.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next,b;if(this._current){b=a.firstChild;if(!b)for(b=null;a!==this.root&&!(b=a.nextSibling);)a=a.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=
null}};p.prototype={equals:function(a){return this.node===a.node&this.offset==a.offset},inspect:function(){return"[DomPosition("+j(this.node)+":"+this.offset+")]"}};s.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};s.prototype.toString=function(){return this.message};a.dom={arrayContains:q,isHtmlNamespace:function(a){var b;return typeof a.namespaceURI==u||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==
b},parentElement:function(a){a=a.parentNode;return 1==a.nodeType?a:null},getNodeIndex:b,getNodeLength:function(a){var b;return h(a)?a.length:(b=a.childNodes)?b.length:0},getCommonAncestor:e,isAncestorOf:function(a,b,c){for(b=c?b:b.parentNode;b;){if(b===a)return!0;b=b.parentNode}return!1},getClosestAncestorIn:g,isCharacterDataNode:h,insertAfter:n,splitDataNode:function(a,b){var c=a.cloneNode(!1);c.deleteData(0,b);a.deleteData(b,a.length-b);n(c,a);return c},getDocument:l,getWindow:function(a){a=l(a);
if(typeof a.defaultView!=u)return a.defaultView;if(typeof a.parentWindow!=u)return a.parentWindow;throw Error("Cannot get a window object for node");},getIframeWindow:function(a){if(typeof a.contentWindow!=u)return a.contentWindow;if(typeof a.contentDocument!=u)return a.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element");},getIframeDocument:function(a){if(typeof a.contentDocument!=u)return a.contentDocument;if(typeof a.contentWindow!=u)return a.contentWindow.document;
throw Error("getIframeWindow: No Document object found for iframe element");},getBody:function(a){return y.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]},getRootContainer:function(a){for(var b;b=a.parentNode;)a=b;return a},comparePoints:function(a,c,f,q){var h;if(a==f)return c===q?0:c<q?-1:1;if(h=g(f,a,!0))return c<=b(h)?-1:1;if(h=g(a,f,!0))return b(h)<q?-1:1;c=e(a,f);a=a===c?c:g(a,c,!0);f=f===c?c:g(f,c,!0);if(a===f)throw Error("comparePoints got to case 4 and childA and childB are the same!");
for(c=c.firstChild;c;){if(c===a)return-1;if(c===f)return 1;c=c.nextSibling}throw Error("Should not be here!");},inspectNode:j,fragmentFromNodeChildren:function(a){for(var b=l(a).createDocumentFragment(),c;c=a.firstChild;)b.appendChild(c);return b},createIterator:function(a){return new v(a)},DomPosition:p};a.DOMException=s});
rangy.createModule("DomRange",function(a){function c(a,d){return 3!=a.nodeType&&(k.isAncestorOf(a,d.startContainer,!0)||k.isAncestorOf(a,d.endContainer,!0))}function b(a){return k.getDocument(a.startContainer)}function e(a,d,b){if(d=a._listeners[d])for(var c=0,f=d.length;c<f;++c)d[c].call(a,{target:a,args:b})}function g(a){return new L(a.parentNode,k.getNodeIndex(a))}function h(a){return new L(a.parentNode,k.getNodeIndex(a)+1)}function n(a,d,b){var c=11==a.nodeType?a.firstChild:a;k.isCharacterDataNode(d)?
b==d.length?k.insertAfter(a,d):d.parentNode.insertBefore(a,0==b?d:k.splitDataNode(d,b)):b>=d.childNodes.length?d.appendChild(a):d.insertBefore(a,d.childNodes[b]);return c}function l(a){for(var d,c,f=b(a.range).createDocumentFragment();c=a.next();){d=a.isPartiallySelectedSubtree();c=c.cloneNode(!d);d&&(d=a.getSubtreeIterator(),c.appendChild(l(d)),d.detach(!0));if(10==c.nodeType)throw new D("HIERARCHY_REQUEST_ERR");f.appendChild(c)}return f}function j(a,d,b){var c,f;for(b=b||{stop:!1};c=a.next();)if(a.isPartiallySelectedSubtree())if(!1===
d(c)){b.stop=!0;break}else{if(c=a.getSubtreeIterator(),j(c,d,b),c.detach(!0),b.stop)break}else for(c=k.createIterator(c);f=c.next();)if(!1===d(f)){b.stop=!0;return}}function v(a){for(var d;a.next();)a.isPartiallySelectedSubtree()?(d=a.getSubtreeIterator(),v(d),d.detach(!0)):a.remove()}function p(a){for(var d,c=b(a.range).createDocumentFragment(),f;d=a.next();){a.isPartiallySelectedSubtree()?(d=d.cloneNode(!1),f=a.getSubtreeIterator(),d.appendChild(p(f)),f.detach(!0)):a.remove();if(10==d.nodeType)throw new D("HIERARCHY_REQUEST_ERR");
c.appendChild(d)}return c}function s(a,d,b){var c=!(!d||!d.length),f,w=!!b;c&&(f=RegExp("^("+d.join("|")+")$"));var e=[];j(new y(a,!1),function(a){(!c||f.test(a.nodeType))&&(!w||b(a))&&e.push(a)});return e}function u(a){return"["+("undefined"==typeof a.getName?"Range":a.getName())+"("+k.inspectNode(a.startContainer)+":"+a.startOffset+", "+k.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function y(a,d){this.range=a;this.clonePartiallySelectedTextNodes=d;if(!a.collapsed){this.sc=a.startContainer;
this.so=a.startOffset;this.ec=a.endContainer;this.eo=a.endOffset;var b=a.commonAncestorContainer;this.sc===this.ec&&k.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===b&&!k.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:k.getClosestAncestorIn(this.sc,b,!0),this._last=this.ec===b&&!k.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:k.getClosestAncestorIn(this.ec,b,!0))}}function f(a){this.code=
this[a];this.codeName=a;this.message="RangeException: "+this.codeName}function q(a,d,b){this.nodes=s(a,d,b);this._next=this.nodes[0];this._position=0}function m(a){return function(d,b){for(var c,f=b?d:d.parentNode;f;){c=f.nodeType;if(k.arrayContains(a,c))return f;f=f.parentNode}return null}}function C(a,d){if(P(a,d))throw new f("INVALID_NODE_TYPE_ERR");}function r(a){if(!a.startContainer)throw new D("INVALID_STATE_ERR");}function F(a,d){if(!k.arrayContains(d,a.nodeType))throw new f("INVALID_NODE_TYPE_ERR");
}function K(a,d){if(0>d||d>(k.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new D("INDEX_SIZE_ERR");}function G(a,d){if(M(a,!0)!==M(d,!0))throw new D("WRONG_DOCUMENT_ERR");}function E(a){if(W(a,!0))throw new D("NO_MODIFICATION_ALLOWED_ERR");}function B(a,d){if(!a)throw new D(d);}function x(a){r(a);if(!k.arrayContains(Q,a.startContainer.nodeType)&&!M(a.startContainer,!0)||!k.arrayContains(Q,a.endContainer.nodeType)&&!M(a.endContainer,!0)||!(a.startOffset<=(k.isCharacterDataNode(a.startContainer)?
a.startContainer.length:a.startContainer.childNodes.length))||!(a.endOffset<=(k.isCharacterDataNode(a.endContainer)?a.endContainer.length:a.endContainer.childNodes.length)))throw Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")");}function J(){}function U(a){a.START_TO_START=X;a.START_TO_END=$;a.END_TO_END=ea;a.END_TO_START=aa;a.NODE_BEFORE=ba;a.NODE_AFTER=ca;a.NODE_BEFORE_AND_AFTER=da;a.NODE_INSIDE=Y}function t(a){U(a);U(a.prototype)}function N(a,d){return function(){x(this);
var b=this.startContainer,c=this.startOffset,f=this.commonAncestorContainer,w=new y(this,!0);b!==f&&(b=k.getClosestAncestorIn(b,f,!0),c=h(b),b=c.node,c=c.offset);j(w,E);w.reset();f=a(w);w.detach();d(this,b,c,b,c);return f}}function R(d,b,f){function w(a,d){return function(b){r(this);F(b,H);F(O(b),Q);b=(a?g:h)(b);(d?e:q)(this,b.node,b.offset)}}function e(a,d,c){var f=a.endContainer,z=a.endOffset;if(d!==a.startContainer||c!==a.startOffset){if(O(d)!=O(f)||1==k.comparePoints(d,c,f,z))f=d,z=c;b(a,d,c,
f,z)}}function q(a,d,c){var f=a.startContainer,z=a.startOffset;if(d!==a.endContainer||c!==a.endOffset){if(O(d)!=O(f)||-1==k.comparePoints(d,c,f,z))f=d,z=c;b(a,f,z,d,c)}}d.prototype=new J;a.util.extend(d.prototype,{setStart:function(a,d){r(this);C(a,!0);K(a,d);e(this,a,d)},setEnd:function(a,d){r(this);C(a,!0);K(a,d);q(this,a,d)},setStartBefore:w(!0,!0),setStartAfter:w(!1,!0),setEndBefore:w(!0,!1),setEndAfter:w(!1,!1),collapse:function(a){x(this);a?b(this,this.startContainer,this.startOffset,this.startContainer,
this.startOffset):b(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){r(this);C(a,!0);b(this,a,0,a,k.getNodeLength(a))},selectNode:function(a){r(this);C(a,!1);F(a,H);var d=g(a);a=h(a);b(this,d.node,d.offset,a.node,a.offset)},extractContents:N(p,b),deleteContents:N(v,b),canSurroundContents:function(){x(this);E(this.startContainer);E(this.endContainer);var a=new y(this,!0),d=a._first&&c(a._first,this)||a._last&&c(a._last,this);a.detach();return!d},
detach:function(){f(this)},splitBoundaries:function(){x(this);var a=this.startContainer,d=this.startOffset,c=this.endContainer,f=this.endOffset,z=a===c;k.isCharacterDataNode(c)&&0<f&&f<c.length&&k.splitDataNode(c,f);k.isCharacterDataNode(a)&&0<d&&d<a.length&&(a=k.splitDataNode(a,d),z?(f-=d,c=a):c==a.parentNode&&f>=k.getNodeIndex(a)&&f++,d=0);b(this,a,d,c,f)},normalizeBoundaries:function(){x(this);var a=this.startContainer,d=this.startOffset,c=this.endContainer,f=this.endOffset,z=function(a){var d=
a.nextSibling;d&&d.nodeType==a.nodeType&&(c=a,f=a.length,a.appendData(d.data),d.parentNode.removeChild(d))},w=function(b){var z=b.previousSibling;if(z&&z.nodeType==b.nodeType){a=b;var w=b.length;d=z.length;b.insertData(0,z.data);z.parentNode.removeChild(z);a==c?(f+=d,c=a):c==b.parentNode&&(z=k.getNodeIndex(b),f==z?(c=b,f=w):f>z&&f--)}},e=!0;k.isCharacterDataNode(c)?c.length==f&&z(c):(0<f&&(e=c.childNodes[f-1])&&k.isCharacterDataNode(e)&&z(e),e=!this.collapsed);e?k.isCharacterDataNode(a)?0==d&&w(a):
d<a.childNodes.length&&(z=a.childNodes[d])&&k.isCharacterDataNode(z)&&w(z):(a=c,d=f);b(this,a,d,c,f)},collapseToPoint:function(a,d){r(this);C(a,!0);K(a,d);(a!==this.startContainer||d!==this.startOffset||a!==this.endContainer||d!==this.endOffset)&&b(this,a,d,a,d)}});t(d)}function V(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;a.commonAncestorContainer=a.collapsed?a.startContainer:k.getCommonAncestor(a.startContainer,a.endContainer)}function S(a,d,b,c,f){var w=a.startContainer!==
d||a.startOffset!==b,q=a.endContainer!==c||a.endOffset!==f;a.startContainer=d;a.startOffset=b;a.endContainer=c;a.endOffset=f;V(a);e(a,"boundarychange",{startMoved:w,endMoved:q})}function A(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};V(this)}a.requireModules(["DomUtil"]);var k=a.dom,L=k.DomPosition,D=a.DOMException;y.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=
null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;a&&(this._next=a!==this._last?a.nextSibling:null,k.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so)));return a},remove:function(){var a=this._current,d,b;k.isCharacterDataNode(a)&&(a===this.sc||a===this.ec)?(d=a===this.sc?this.so:0,b=a===
this.ec?this.eo:a.length,d!=b&&a.deleteData(d,b-d)):a.parentNode&&a.parentNode.removeChild(a)},isPartiallySelectedSubtree:function(){return c(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new A(b(this.range));var d=this._current,c=d,f=0,w=d,e=k.getNodeLength(d);k.isAncestorOf(d,this.sc,!0)&&(c=this.sc,f=this.so);k.isAncestorOf(d,this.ec,!0)&&(w=this.ec,e=this.eo);S(a,c,f,w,e)}return new y(a,this.clonePartiallySelectedTextNodes)},
detach:function(a){a&&this.range.detach();this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};f.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};f.prototype.toString=function(){return this.message};q.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var H=[1,3,4,5,
7,8,10],Q=[2,9,11],I=[1,3,4,5,7,8,10,11],T=[1,3,4,5,7,8],O=k.getRootContainer,M=m([9,11]),W=m([5,6,10,12]),P=m([6,10,12]),d=document.createElement("style"),w=!1;try{d.innerHTML="<b>x</b>",w=3==d.firstChild.nodeType}catch(fa){}a.features.htmlParsingConforms=w;var Z="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),X=0,$=1,ea=2,aa=3,ba=0,ca=1,da=2,Y=3;J.prototype={attachListener:function(a,d){this._listeners[a].push(d)},compareBoundaryPoints:function(a,
d){x(this);G(this.startContainer,d.startContainer);var b=a==aa||a==X?"start":"end",c=a==$||a==X?"start":"end";return k.comparePoints(this[b+"Container"],this[b+"Offset"],d[c+"Container"],d[c+"Offset"])},insertNode:function(a){x(this);F(a,I);E(this.startContainer);if(k.isAncestorOf(a,this.startContainer,!0))throw new D("HIERARCHY_REQUEST_ERR");a=n(a,this.startContainer,this.startOffset);this.setStartBefore(a)},cloneContents:function(){x(this);var a,d;if(this.collapsed)return b(this).createDocumentFragment();
if(this.startContainer===this.endContainer&&k.isCharacterDataNode(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),d=b(this).createDocumentFragment(),d.appendChild(a),d;d=new y(this,!0);a=l(d);d.detach();return a},canSurroundContents:function(){x(this);E(this.startContainer);E(this.endContainer);var a=new y(this,!0),d=a._first&&c(a._first,this)||a._last&&c(a._last,this);a.detach();return!d},surroundContents:function(a){F(a,T);if(!this.canSurroundContents())throw new f("BAD_BOUNDARYPOINTS_ERR");
var d=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);n(a,this.startContainer,this.startOffset);a.appendChild(d);this.selectNode(a)},cloneRange:function(){x(this);for(var a=new A(b(this)),d=Z.length,c;d--;)c=Z[d],a[c]=this[c];return a},toString:function(){x(this);var a=this.startContainer;if(a===this.endContainer&&k.isCharacterDataNode(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var d=[],a=new y(this,!0);j(a,function(a){(3==
a.nodeType||4==a.nodeType)&&d.push(a.data)});a.detach();return d.join("")},compareNode:function(a){x(this);var d=a.parentNode,b=k.getNodeIndex(a);if(!d)throw new D("NOT_FOUND_ERR");a=this.comparePoint(d,b);d=this.comparePoint(d,b+1);return 0>a?0<d?da:ba:0<d?ca:Y},comparePoint:function(a,d){x(this);B(a,"HIERARCHY_REQUEST_ERR");G(a,this.startContainer);return 0>k.comparePoints(a,d,this.startContainer,this.startOffset)?-1:0<k.comparePoints(a,d,this.endContainer,this.endOffset)?1:0},createContextualFragment:w?
function(a){var d=this.startContainer,b=k.getDocument(d);if(!d)throw new D("INVALID_STATE_ERR");var c=null;1==d.nodeType?c=d:k.isCharacterDataNode(d)&&(c=k.parentElement(d));c=null===c||"HTML"==c.nodeName&&k.isHtmlNamespace(k.getDocument(c).documentElement)&&k.isHtmlNamespace(c)?b.createElement("body"):c.cloneNode(!1);c.innerHTML=a;return k.fragmentFromNodeChildren(c)}:function(a){r(this);var d=b(this).createElement("body");d.innerHTML=a;return k.fragmentFromNodeChildren(d)},toHtml:function(){x(this);
var a=b(this).createElement("div");a.appendChild(this.cloneContents());return a.innerHTML},intersectsNode:function(a,d){x(this);B(a,"NOT_FOUND_ERR");if(k.getDocument(a)!==b(this))return!1;var c=a.parentNode,f=k.getNodeIndex(a);B(c,"NOT_FOUND_ERR");var w=k.comparePoints(c,f,this.endContainer,this.endOffset),c=k.comparePoints(c,f+1,this.startContainer,this.startOffset);return d?0>=w&&0<=c:0>w&&0<c},isPointInRange:function(a,d){x(this);B(a,"HIERARCHY_REQUEST_ERR");G(a,this.startContainer);return 0<=
k.comparePoints(a,d,this.startContainer,this.startOffset)&&0>=k.comparePoints(a,d,this.endContainer,this.endOffset)},intersectsRange:function(a,d){x(this);if(b(a)!=b(this))throw new D("WRONG_DOCUMENT_ERR");var c=k.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),f=k.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);return d?0>=c&&0<=f:0>c&&0<f},intersection:function(a){if(this.intersectsRange(a)){var d=k.comparePoints(this.startContainer,
this.startOffset,a.startContainer,a.startOffset),b=k.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),c=this.cloneRange();-1==d&&c.setStart(a.startContainer,a.startOffset);1==b&&c.setEnd(a.endContainer,a.endOffset);return c}return null},union:function(a){if(this.intersectsRange(a,!0)){var d=this.cloneRange();-1==k.comparePoints(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&d.setStart(a.startContainer,a.startOffset);1==k.comparePoints(a.endContainer,
a.endOffset,this.endContainer,this.endOffset)&&d.setEnd(a.endContainer,a.endOffset);return d}throw new f("Ranges do not intersect");},containsNode:function(a,d){return d?this.intersectsNode(a,!1):this.compareNode(a)==Y},containsNodeContents:function(a){return 0<=this.comparePoint(a,0)&&0>=this.comparePoint(a,k.getNodeLength(a))},containsRange:function(a){return this.intersection(a).equals(a)},containsNodeText:function(a){var d=this.cloneRange();d.selectNode(a);var b=d.getNodes([3]);return 0<b.length?
(d.setStart(b[0],0),a=b.pop(),d.setEnd(a,a.length),a=this.containsRange(d),d.detach(),a):this.containsNodeContents(a)},createNodeIterator:function(a,d){x(this);return new q(this,a,d)},getNodes:function(a,d){x(this);return s(this,a,d)},getDocument:function(){return b(this)},collapseBefore:function(a){r(this);this.setEndBefore(a);this.collapse(!1)},collapseAfter:function(a){r(this);this.setStartAfter(a);this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return A.rangesEqual(this,
a)},inspect:function(){return u(this)}};R(A,S,function(a){r(a);a.startContainer=a.startOffset=a.endContainer=a.endOffset=null;a.collapsed=a.commonAncestorContainer=null;e(a,"detach",null);a._listeners=null});a.rangePrototype=J.prototype;A.rangeProperties=Z;A.RangeIterator=y;A.copyComparisonConstants=t;A.createPrototypeRange=R;A.inspect=u;A.getRangeDocument=b;A.rangesEqual=function(a,d){return a.startContainer===d.startContainer&&a.startOffset===d.startOffset&&a.endContainer===d.endContainer&&a.endOffset===
d.endOffset};a.DomRange=A;a.RangeException=f});
rangy.createModule("WrappedRange",function(a){function c(a,b,c,e){var l=a.duplicate();l.collapse(c);var j=l.parentElement();g.isAncestorOf(b,j,!0)||(j=b);if(!j.canHaveHTML)return new h(j.parentNode,g.getNodeIndex(j));b=g.getDocument(j).createElement("span");var n,p=c?"StartToStart":"StartToEnd";do j.insertBefore(b,b.previousSibling),l.moveToElementText(b);while(0<(n=l.compareEndPoints(p,a))&&b.previousSibling);p=b.nextSibling;if(-1==n&&p&&g.isCharacterDataNode(p)){l.setEndPoint(c?"EndToStart":"EndToEnd",
a);if(/[\r\n]/.test(p.data)){j=l.duplicate();c=j.text.replace(/\r\n/g,"\r").length;for(c=j.moveStart("character",c);-1==j.compareEndPoints("StartToEnd",j);)c++,j.moveStart("character",1)}else c=l.text.length;j=new h(p,c)}else p=(e||!c)&&b.previousSibling,j=(c=(e||c)&&b.nextSibling)&&g.isCharacterDataNode(c)?new h(c,0):p&&g.isCharacterDataNode(p)?new h(p,p.length):new h(j,g.getNodeIndex(b));b.parentNode.removeChild(b);return j}function b(a,b){var c,e,l=a.offset,h=g.getDocument(a.node),j=h.body.createTextRange(),
n=g.isCharacterDataNode(a.node);n?(c=a.node,e=c.parentNode):(c=a.node.childNodes,c=l<c.length?c[l]:null,e=a.node);h=h.createElement("span");h.innerHTML="&#feff;";c?e.insertBefore(h,c):e.appendChild(h);j.moveToElementText(h);j.collapse(!b);e.removeChild(h);if(n)j[b?"moveStart":"moveEnd"]("character",l);return j}a.requireModules(["DomUtil","DomRange"]);var e,g=a.dom,h=g.DomPosition,n=a.DomRange;if(a.features.implementsDomRange&&(!a.features.implementsTextRange||!a.config.preferTextRange)){var l=function(a){for(var b=
v.length,c;b--;)c=v[b],a[c]=a.nativeRange[c]},j,v=n.rangeProperties,p;e=function(a){if(!a)throw Error("Range must be specified");this.nativeRange=a;l(this)};n.createPrototypeRange(e,function(a,b,c,e,h){var g=a.endContainer!==e||a.endOffset!=h;if(a.startContainer!==b||a.startOffset!=c||g)a.setEnd(e,h),a.setStart(b,c)},function(a){a.nativeRange.detach();a.detached=!0;for(var b=v.length,c;b--;)c=v[b],a[c]=null});j=e.prototype;j.selectNode=function(a){this.nativeRange.selectNode(a);l(this)};j.deleteContents=
function(){this.nativeRange.deleteContents();l(this)};j.extractContents=function(){var a=this.nativeRange.extractContents();l(this);return a};j.cloneContents=function(){return this.nativeRange.cloneContents()};j.surroundContents=function(a){this.nativeRange.surroundContents(a);l(this)};j.collapse=function(a){this.nativeRange.collapse(a);l(this)};j.cloneRange=function(){return new e(this.nativeRange.cloneRange())};j.refresh=function(){l(this)};j.toString=function(){return this.nativeRange.toString()};
var s=document.createTextNode("test");g.getBody(document).appendChild(s);var u=document.createRange();u.setStart(s,0);u.setEnd(s,0);try{u.setStart(s,1),j.setStart=function(a,b){this.nativeRange.setStart(a,b);l(this)},j.setEnd=function(a,b){this.nativeRange.setEnd(a,b);l(this)},p=function(a){return function(b){this.nativeRange[a](b);l(this)}}}catch(y){j.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(c){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}l(this)},j.setEnd=function(a,
b){try{this.nativeRange.setEnd(a,b)}catch(c){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}l(this)},p=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(e){this.nativeRange[b](c),this.nativeRange[a](c)}l(this)}}}j.setStartBefore=p("setStartBefore","setEndBefore");j.setStartAfter=p("setStartAfter","setEndAfter");j.setEndBefore=p("setEndBefore","setStartBefore");j.setEndAfter=p("setEndAfter","setStartAfter");u.selectNodeContents(s);j.selectNodeContents=u.startContainer==
s&&u.endContainer==s&&0==u.startOffset&&u.endOffset==s.length?function(a){this.nativeRange.selectNodeContents(a);l(this)}:function(a){this.setStart(a,0);this.setEnd(a,n.getEndOffset(a))};u.selectNodeContents(s);u.setEnd(s,3);p=document.createRange();p.selectNodeContents(s);p.setEnd(s,4);p.setStart(s,2);j.compareBoundaryPoints=-1==u.compareBoundaryPoints(u.START_TO_END,p)&1==u.compareBoundaryPoints(u.END_TO_START,p)?function(a,b){b=b.nativeRange||b;a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&
(a=b.START_TO_END);return this.nativeRange.compareBoundaryPoints(a,b)}:function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};a.util.isHostMethod(u,"createContextualFragment")&&(j.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)});g.getBody(document).removeChild(s);u.detach();p.detach();a.createNativeRange=function(a){a=a||document;return a.createRange()}}else a.features.implementsTextRange&&(e=function(a){this.textRange=a;this.refresh()},
e.prototype=new n(document),e.prototype.refresh=function(){var a,b,e=this.textRange;a=e.parentElement();var h=e.duplicate();h.collapse(!0);b=h.parentElement();h=e.duplicate();h.collapse(!1);e=h.parentElement();b=b==e?b:g.getCommonAncestor(b,e);b=b==a?b:g.getCommonAncestor(a,b);0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?b=a=c(this.textRange,b,!0,!0):(a=c(this.textRange,b,!0,!1),b=c(this.textRange,b,!1,!1));this.setStart(a.node,a.offset);this.setEnd(b.node,b.offset)},n.copyComparisonConstants(e),
j=function(){return this}(),"undefined"==typeof j.Range&&(j.Range=e),a.createNativeRange=function(a){a=a||document;return a.body.createTextRange()});a.features.implementsTextRange&&(e.rangeToTextRange=function(a){if(a.collapsed)return b(new h(a.startContainer,a.startOffset),!0);var c=b(new h(a.startContainer,a.startOffset),!0),e=b(new h(a.endContainer,a.endOffset),!1);a=g.getDocument(a.startContainer).body.createTextRange();a.setEndPoint("StartToStart",c);a.setEndPoint("EndToEnd",e);return a});e.prototype.getName=
function(){return"WrappedRange"};a.WrappedRange=e;a.createRange=function(b){b=b||document;return new e(a.createNativeRange(b))};a.createRangyRange=function(a){a=a||document;return new n(a)};a.createIframeRange=function(b){return a.createRange(g.getIframeDocument(b))};a.createIframeRangyRange=function(b){return a.createRangyRange(g.getIframeDocument(b))};a.addCreateMissingNativeApiListener(function(b){b=b.document;"undefined"==typeof b.createRange&&(b.createRange=function(){return a.createRange(this)});
b=b=null})});
rangy.createModule("WrappedSelection",function(a,c){function b(a){return(a||window).getSelection()}function e(a){return(a||window).document.selection}function g(a,b,c){var e=c?"end":"start";c=c?"start":"end";a.anchorNode=b[e+"Container"];a.anchorOffset=b[e+"Offset"];a.focusNode=b[c+"Container"];a.focusOffset=b[c+"Offset"]}function h(a){a.anchorNode=a.focusNode=null;a.anchorOffset=a.focusOffset=0;a.rangeCount=0;a.isCollapsed=!0;a._ranges.length=0}function n(d){var b;d instanceof C?(b=d._selectionNativeRange,
b||(b=a.createNativeRange(q.getDocument(d.startContainer)),b.setEnd(d.endContainer,d.endOffset),b.setStart(d.startContainer,d.startOffset),d._selectionNativeRange=b,d.attachListener("detach",function(){this._selectionNativeRange=null}))):d instanceof r?b=d.nativeRange:a.features.implementsDomRange&&d instanceof q.getWindow(d.startContainer).Range&&(b=d);return b}function l(a){var b=a.getNodes(),c;a:if(!b.length||1!=b[0].nodeType)c=!1;else{c=1;for(var e=b.length;c<e;++c)if(!q.isAncestorOf(b[0],b[c])){c=
!1;break a}c=!0}if(!c)throw Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return b[0]}function j(a,b){var c=new r(b);a._ranges=[c];g(a,c,!1);a.rangeCount=1;a.isCollapsed=c.collapsed}function v(b){b._ranges.length=0;if("None"==b.docSelection.type)h(b);else{var c=b.docSelection.createRange();if(c&&"undefined"!=typeof c.text)j(b,c);else{b.rangeCount=c.length;for(var e,f=q.getDocument(c.item(0)),l=0;l<b.rangeCount;++l)e=a.createRange(f),e.selectNode(c.item(l)),
b._ranges.push(e);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed;g(b,b._ranges[b.rangeCount-1],!1)}}}function p(a,b){for(var c=a.docSelection.createRange(),e=l(b),f=q.getDocument(c.item(0)),f=q.getBody(f).createControlRange(),h=0,g=c.length;h<g;++h)f.add(c.item(h));try{f.add(e)}catch(j){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}f.select();v(a)}function s(a,b,c){this.nativeSelection=a;this.docSelection=b;this._ranges=
[];this.win=c;this.refresh()}function u(a,b){for(var c=q.getDocument(b[0].startContainer),c=q.getBody(c).createControlRange(),e=0,f;e<rangeCount;++e){f=l(b[e]);try{c.add(f)}catch(h){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}c.select();v(a)}function y(a,b){if(a.anchorNode&&q.getDocument(a.anchorNode)!==q.getDocument(b))throw new F("WRONG_DOCUMENT_ERR");}function f(a){var b=[],c=new K(a.anchorNode,a.anchorOffset),
e=new K(a.focusNode,a.focusOffset),f="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var h=0,g=a.rangeCount;h<g;++h)b[h]=C.inspect(a.getRangeAt(h));return"["+f+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+e.inspect()+"]"}a.requireModules(["DomUtil","DomRange","WrappedRange"]);a.config.checkSelectionRanges=!0;var q=a.dom,m=a.util,C=a.DomRange,r=a.WrappedRange,F=a.DOMException,K=q.DomPosition,G,E,B=a.util.isHostMethod(window,"getSelection"),
x=a.util.isHostObject(document,"selection"),J=x&&(!B||a.config.preferTextRange);J?(G=e,a.isSelectionValid=function(a){a=(a||window).document;var b=a.selection;return"None"!=b.type||q.getDocument(b.createRange().parentElement())==a}):B?(G=b,a.isSelectionValid=function(){return!0}):c.fail("Neither document.selection or window.getSelection() detected.");a.getNativeSelection=G;var B=G(),U=a.createNativeRange(document),t=q.getBody(document),N=m.areHostObjects(B,m.areHostProperties(B,["anchorOffset","focusOffset"]));
a.features.selectionHasAnchorAndFocus=N;var R=m.isHostMethod(B,"extend");a.features.selectionHasExtend=R;var V="number"==typeof B.rangeCount;a.features.selectionHasRangeCount=V;var S=!1,A=!0;if(m.areHostMethods(B,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof B.rangeCount&&a.features.implementsDomRange){var k=document.createElement("iframe");t.appendChild(k);A=q.getIframeDocument(k);A.open();A.write("<html><head></head><body>12</body></html>");A.close();var L=q.getIframeWindow(k).getSelection(),
D=A.documentElement.lastChild.firstChild,H=A.createRange();H.setStart(D,1);H.collapse(!0);L.addRange(H);A=1==L.rangeCount;L.removeAllRanges();var Q=H.cloneRange();H.setStart(D,0);Q.setEnd(D,2);L.addRange(H);L.addRange(Q);S=2==L.rangeCount;H.detach();Q.detach();t.removeChild(k)}a.features.selectionSupportsMultipleRanges=S;a.features.collapsedNonEditableSelectionsSupported=A;var I=!1;t&&m.isHostMethod(t,"createControlRange")&&(t=t.createControlRange(),m.areHostProperties(t,["item","add"])&&(I=!0));
a.features.implementsControlRange=I;E=N?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var T;m.isHostMethod(B,"getRangeAt")?T=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:N&&(T=function(b){var c=q.getDocument(b.anchorNode),c=a.createRange(c);c.setStart(b.anchorNode,b.anchorOffset);c.setEnd(b.focusNode,b.focusOffset);c.collapsed!==this.isCollapsed&&(c.setStart(b.focusNode,b.focusOffset),
c.setEnd(b.anchorNode,b.anchorOffset));return c});a.getSelection=function(a){a=a||window;var b=a._rangySelection,c=G(a),f=x?e(a):null;b?(b.nativeSelection=c,b.docSelection=f,b.refresh(a)):(b=new s(c,f,a),a._rangySelection=b);return b};a.getIframeSelection=function(b){return a.getSelection(q.getIframeWindow(b))};t=s.prototype;if(!J&&N&&m.areHostMethods(B,["removeAllRanges","addRange"])){t.removeAllRanges=function(){this.nativeSelection.removeAllRanges();h(this)};var O=function(b,c){var e=C.getRangeDocument(c),
e=a.createRange(e);e.collapseToPoint(c.endContainer,c.endOffset);b.nativeSelection.addRange(n(e));b.nativeSelection.extend(c.startContainer,c.startOffset);b.refresh()};t.addRange=V?function(b,c){if(I&&x&&"Control"==this.docSelection.type)p(this,b);else if(c&&R)O(this,b);else{var e;S?e=this.rangeCount:(this.removeAllRanges(),e=0);this.nativeSelection.addRange(n(b));this.rangeCount=this.nativeSelection.rangeCount;this.rangeCount==e+1?(a.config.checkSelectionRanges&&(e=T(this.nativeSelection,this.rangeCount-
1))&&!C.rangesEqual(e,b)&&(b=new r(e)),this._ranges[this.rangeCount-1]=b,g(this,b,P(this.nativeSelection)),this.isCollapsed=E(this)):this.refresh()}}:function(a,b){b&&R?O(this,a):(this.nativeSelection.addRange(n(a)),this.refresh())};t.setRanges=function(a){if(I&&1<a.length)u(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}}}else if(m.isHostMethod(B,"empty")&&m.isHostMethod(U,"select")&&I&&J)t.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=
this.docSelection.type){var a;if(this.anchorNode)a=q.getDocument(this.anchorNode);else if("Control"==this.docSelection.type){var b=this.docSelection.createRange();b.length&&(a=q.getDocument(b.item(0)).body.createTextRange())}a&&(a.body.createTextRange().select(),this.docSelection.empty())}}catch(c){}h(this)},t.addRange=function(a){"Control"==this.docSelection.type?p(this,a):(r.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,g(this,a,!1))},
t.setRanges=function(a){this.removeAllRanges();var b=a.length;1<b?u(this,a):b&&this.addRange(a[0])};else return c.fail("No means of selecting a Range or TextRange was found"),!1;t.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new F("INDEX_SIZE_ERR");return this._ranges[a]};var M;if(J)M=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=q.getBody(b.win.document).createTextRange(),c.collapse(!0));"Control"==b.docSelection.type?v(b):c&&"undefined"!=typeof c.text?
j(b,c):h(b)};else if(m.isHostMethod(B,"getRangeAt")&&"number"==typeof B.rangeCount)M=function(b){if(I&&x&&"Control"==b.docSelection.type)v(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,e=b.rangeCount;c<e;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));g(b,b._ranges[b.rangeCount-1],P(b.nativeSelection));b.isCollapsed=E(b)}else h(b)};else if(N&&"boolean"==typeof B.isCollapsed&&"boolean"==typeof U.collapsed&&a.features.implementsDomRange)M=
function(a){var b;b=a.nativeSelection;b.anchorNode?(b=T(b,0),a._ranges=[b],a.rangeCount=1,b=a.nativeSelection,a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset,a.isCollapsed=E(a)):h(a)};else return c.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;t.refresh=function(a){var b=a?this._ranges.slice(0):null;M(this);if(a){a=b.length;if(a!=this._ranges.length)return!1;for(;a--;)if(!C.rangesEqual(b[a],this._ranges[a]))return!1;
return!0}};var W=function(a,b){var c=a.getAllRanges(),e=!1;a.removeAllRanges();for(var f=0,g=c.length;f<g;++f)e||b!==c[f]?a.addRange(c[f]):e=!0;a.rangeCount||h(a)};t.removeRange=I?function(a){if("Control"==this.docSelection.type){var b=this.docSelection.createRange();a=l(a);for(var c=q.getDocument(b.item(0)),c=q.getBody(c).createControlRange(),e,f=!1,h=0,g=b.length;h<g;++h)e=b.item(h),e!==a||f?c.add(b.item(h)):f=!0;c.select();v(this)}else W(this,a)}:function(a){W(this,a)};var P;!J&&N&&a.features.implementsDomRange?
(P=function(a){var b=!1;a.anchorNode&&(b=1==q.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset));return b},t.isBackwards=function(){return P(this)}):P=t.isBackwards=function(){return!1};t.toString=function(){for(var a=[],b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")};t.collapse=function(b,c){y(this,b);var e=a.createRange(q.getDocument(b));e.collapseToPoint(b,c);this.removeAllRanges();this.addRange(e);this.isCollapsed=!0};t.collapseToStart=function(){if(this.rangeCount){var a=
this._ranges[0];this.collapse(a.startContainer,a.startOffset)}else throw new F("INVALID_STATE_ERR");};t.collapseToEnd=function(){if(this.rangeCount){var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)}else throw new F("INVALID_STATE_ERR");};t.selectAllChildren=function(b){y(this,b);var c=a.createRange(q.getDocument(b));c.selectNodeContents(b);this.removeAllRanges();this.addRange(c)};t.deleteFromDocument=function(){if(I&&x&&"Control"==this.docSelection.type){for(var a=this.docSelection.createRange(),
b;a.length;)b=a.item(0),a.remove(b),b.parentNode.removeChild(b);this.refresh()}else if(this.rangeCount){a=this.getAllRanges();this.removeAllRanges();b=0;for(var c=a.length;b<c;++b)a[b].deleteContents();this.addRange(a[c-1])}};t.getAllRanges=function(){return this._ranges.slice(0)};t.setSingleRange=function(a){this.setRanges([a])};t.containsNode=function(a,b){for(var c=0,e=this._ranges.length;c<e;++c)if(this._ranges[c].containsNode(a,b))return!0;return!1};t.toHtml=function(){var a="";if(this.rangeCount){for(var a=
C.getRangeDocument(this._ranges[0]).createElement("div"),b=0,c=this._ranges.length;b<c;++b)a.appendChild(this._ranges[b].cloneContents());a=a.innerHTML}return a};t.getName=function(){return"WrappedSelection"};t.inspect=function(){return f(this)};t.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null};s.inspect=f;a.Selection=s;a.selectionPrototype=t;a.addCreateMissingNativeApiListener(function(b){"undefined"==typeof b.getSelection&&(b.getSelection=function(){return a.getSelection(this)});
b=null})});
workpad.browser=function(){var a=navigator.userAgent,c=document.createElement("div"),b=-1!==a.indexOf("MSIE")&&-1===a.indexOf("Opera"),e=-1!==a.indexOf("Gecko")&&-1===a.indexOf("KHTML"),g=-1!==a.indexOf("AppleWebKit/");a.indexOf("Chrome/");a.indexOf("Opera/");var h={formatBlock:b,insertUnorderedList:b||g,insertOrderedList:b||g},n={insertHTML:e};return{USER_AGENT:a,supported:function(){var a=this.USER_AGENT.toLowerCase(),b="contentEditable"in c,e=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,
h=document.querySelector&&document.querySelectorAll,a=this.isIos()&&5>+(/ipad|iphone|ipod/.test(a)&&a.match(/ os (\d+).+? like mac os x/)||[,0])[1]||this.isAndroid()&&4>+(a.match(/android (\d+)/)||[,0])[1]||-1!==a.indexOf("opera mobi")||-1!==a.indexOf("hpwos/");return b&&e&&h&&!a},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},isTouchDevice:function(){return this.supportEvent("touchmove")},supportEvent:function(a){var b;
if(!(b="on"+a in c))c.setAttribute("on"+a,"return;"),b="function"===typeof c["on"+a];return b},supportsCommand:function(a,b){if(!h[b]){try{return a.queryCommandSupported(b)}catch(c){}try{return a.queryCommandEnabled(b)}catch(e){return!!n[b]}}return!1}}}();
(function(a){var c=["debug","info","warn","error"];a.util.debug=function(){var b=Array.prototype.slice.call(arguments),e=function(b,e,n){var l=c.indexOf(n),j=c.indexOf("debug");b=a.util.array(b).clone();b.unshift(console,e);return-1<l&&-1<j&&l>=j?console[n]?Function.prototype.bind.apply(console[n],b):Function.prototype.bind.apply(console.log,b):a.EMPTY_FUNCTION};return{error:e(b,"[WorkPad error!!!]: ","error"),debug:e(b,"[WorkPad debug]: ","debug"),info:e(b,"[WorkPad info]: ","info"),warn:e(b,"[Workpad warn!]: ",
"warn")}}})(workpad);
(function(){workpad.util.array=function(a){return{contains:function(c){if(a.indexOf)return-1!==a.indexOf(c);for(var b=0,e=a.length;b<e;b++)if(a[b]===c)return!0;return!1},without:function(c){c=workpad.util.array(c);for(var b=[],e=0,g=a.length;e<g;e++)c.contains(a[e])||b.push(a[e]);return b},get:function(){for(var c=0,b=a.length,e=[];c<b;c++)e.push(a[c]);return e},unique:function(){for(var c=[],b=0,e=a.length;b<e;b++)workpad.util.array(c).contains(a[b])||c.push(a[b]);return c},clone:function(){for(var c=
[],b=0,e=a.length;b<e;b++)c.push(a[b]);return c}}}})();(function(){var a=/^\s+/,c=/\s+$/;workpad.util.string=function(b){b=String(b);return{trim:function(){return b.replace(a,"").replace(c,"")},interpolate:function(a){for(var c in a)b=this.replace("#{"+c+"}").by(a[c]);return b},replace:function(a){return{by:function(c){return b.split(a).join(c)}}}}}})();
(function(){workpad.util.object=function(a){return{merge:function(c){for(var b in c)a[b]=c[b];return this},get:function(){return a},clone:function(){var c={},b;for(b in a)c[b]=a[b];return c},isArray:function(){return"[object Array]"===Object.prototype.toString.call(a)},safeJSON:function(){try{var c=JSON.parse(JSON.stringify(a))}catch(b){c={}}return c}}}})();
workpad.util.Events=Base.extend({on:function(a,c){this.events=this.events||{};this.events[a]=this.events[a]||[];this.events[a].push(c);return this},off:function(a,c){this.events=this.events||{};var b=0,e,g;if(a){e=this.events[a]||[];for(g=[];b<e.length;b++)e[b]!==c&&c&&g.push(e[b]);this.events[a]=g}else this.events={};return this},fire:function(a,c){this.events=this.events||{};for(var b=this.events[a]||[],e=0;e<b.length;e++)b[e].call(this,c);return this}});
workpad.data.predata=function(){return{EMPTY_DATA:[{content:"Begin to edit your workpad",description:"",id:"00000000-0000-0000-0000-000000000000",collapsed:!0,children:[]}]}}();workpad.data.check=function(a){return{isObject:function(){return"object"===typeof a&&"[object object]"===Object.prototype.toString.call(a).toLowerCase()&&!a.length}}};
(function(a){var c=a.util;a.data.pretty=function(b){return{get:function(){if(c.object(b).isArray()){for(var e=[],g=b.length,h=0;h<g;h++)if(a.data.check(b[h]).isObject())try{var n=JSON.stringify(b[h]);"{}"!==n&&e.push(JSON.parse(n))}catch(l){}1>e.length&&(e=a.data.predata.EMPTY_DATA);return e}return a.data.predata.EMPTY_DATA}}}})(workpad);
(function(a){var c=a.dom;c.addClass=function(a,e){var g=a.classList;if(g)return g.add(e);c.hasClass(a,e)||(a.className+=" "+e)};c.removeClass=function(a,c){var g=a.classList;if(g)return g.remove(c);a.className=a.className.replace(RegExp("(^|\\s+)"+c+"(\\s+|$)")," ")};c.hasClass=function(a,c){var g=a.classList;if(g)return g.contains(c);g=a.className;return 0<g.length&&(g==c||RegExp("(^|\\s)"+c+"(\\s|$)").test(g))}})(workpad);
(function(){var a={className:"class"};workpad.dom.setAttributes=function(c){return{on:function(b){for(var e in c)b.setAttribute(a[e]||e,c[e])}}}})();
workpad.dom.style=function(a){var c=workpad.dom,b={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},e=/\-[a-z]/g,g=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"];return{setto:function(b){b=b.style;if("string"===typeof a)b.cssText+=";"+a;else{a=workpad.util.object(a).safeJSON();for(var c in a)"float"===c?(b.cssFloat=a[c],b.styleFloat=a[c]):b[c]=a[c]}},getfrom:function(c){if(c.nodeType===workpad.ELEMENT_NODE){var g=c.ownerDocument,l=a,j=b[a]||
a.replace(e,function(a){return a.charAt(1).toUpperCase()}),v=c.style,p=c.currentStyle,s=v[j];if(s)return s;if(p)try{return p[j]}catch(u){}var j=g.defaultView||g.parentWindow,g=("height"===l||"width"===l)&&"TEXTAREA"===c.nodeName,y;if(j.getComputedStyle)return g&&(y=v.overflow,v.overflow="hidden"),c=j.getComputedStyle(c,null).getPropertyValue(l),g&&(v.overflow=y||""),c}},copyfrom:function(b){var e=a,l;a:{l=0;for(var j=g.length;l<j;l++)if("border-box"===c.style(g[l]).getfrom(b)){l=g[l];break a}l=void 0}(l=
l?parseInt(c.style("width").getfrom(b),10)<b.offsetWidth:!1)&&(e=workpad.util.array(e).without(g));var v="";l=e.length;for(var j=0,p;j<l;j++)p=e[j],v+=p+":"+c.style(p).getfrom(b)+";";return{to:function(a){c.style(v).setto(a);return{andTo:arguments.callee}}}}}};
(function(a){a.dom.offset=function(a){return{get:function(){var b=a&&a.ownerDocument,e={top:0,left:0},g;if(b)return g=b.documentElement,"undefined"!==typeof a.getBoundingClientRect&&(e=a.getBoundingClientRect()),b=null!=b&&b===b.window?b:9===b.nodeType&&b.defaultView,{top:e.top+b.pageYOffset-g.clientTop,left:e.left+b.pageXOffset-g.clientLeft,width:e.width,height:e.height}},set:function(){}}}})(workpad);
workpad.dom.insert=function(a){return{after:function(c){c.parentNode.insertBefore(a,c.nextSibling)},before:function(c){c.parentNode.insertBefore(a,c)},into:function(c){c.appendChild(a)}}};
workpad.dom.observe=function(a,c,b){c="string"===typeof c?[c]:c;for(var e,g,h=0,n=c.length;h<n;h++)g=c[h],a.addEventListener?a.addEventListener(g,b,!1):(e=function(c){"target"in c||(c.target=c.srcElement);c.preventDefault=c.preventDefault||function(){this.returnValue=!1};c.stopPropagation=c.stopPropagation||function(){this.cancelBubble=!0};b.call(a,c)},a.attachEvent("on"+g,e));return{stop:function(){for(var g,h=0,n=c.length;h<n;h++)g=c[h],a.removeEventListener?a.removeEventListener(g,b,!1):a.detachEvent("on"+
g,e)}}};(function(a){a.dom.delegate=function(c,b,e,g){return a.dom.observe(c,e,function(e){for(var n=e.target,l=a.util.array(c.querySelectorAll(b));n&&n!==c;){if(l.contains(n)){g.call(n,e);break}n=n.parentNode}})}})(workpad);
workpad.dom.getParentElement=function(){function a(a,b){return!b||!b.length?!0:"string"===typeof b?a===b:workpad.util.array(b).contains(a)}return function(c,b,e){e=e||70;if(b.className||b.classRegExp){a:{var g=b.nodeName,h=b.className;for(b=b.classRegExp;e--&&c&&"BODY"!==c.nodeName;){var n;if(n=c.nodeType===workpad.ELEMENT_NODE)if(n=a(c.nodeName,g)){n=h;var l=(c.className||"").match(b)||[];n=!n?!!l.length:l[l.length-1]===n}if(n)break a;c=c.parentNode}c=null}return c}a:{g=b.nodeName;for(h=e;h--&&c&&
"BODY"!==c.nodeName;){if(a(c.nodeName,g))break a;c=c.parentNode}c=null}return c}}();
(function(a){var c=document;a.dom.editArea=Base.extend({constructor:function(b,c){var g=this;this.callback=b||a.EMPTY_FUNCTION;this.config=a.util.object({}).merge(c).get();this.editArea=this._createTextArea();setTimeout(function(){g.callback(g)},0)},insertInto:function(a){"string"===typeof a&&(a=c.getElementById(a));a.appendChild(this.editArea)},getEditArea:function(){return this.editArea},setContent:function(a){this.editArea.getElementsByTagName("textarea")[0].value=a;return this},getContent:function(){return this.editArea.getElementsByTagName("textarea")[0].value},
empty:function(){this.editArea.getElementsByTagName("textarea")[0].value="";return this},_createTextArea:function(){var a=c.createElement("div");textarea=c.createElement("textarea");a.className="workpad-editArea editor";a.appendChild(textarea);return a}})})(workpad);workpad.Commands=Base.extend({constructor:function(a){this.editor=a;this.composer=a.composer;this.doc=this.composer.doc},support:function(a){return workpad.browser.supportsCommand(this.doc,a)}});
workpad.views.View=Base.extend({constructor:function(a,c,b){this.parent=a;this.element=c;this.config=b},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(a){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}});
(function(a){var c=a.dom;a.views.Composer=a.views.View.extend({name:"composer",constructor:function(a,c,g){this.base(a,c,g);this.wp=this.parent.wp;this._initEditArea()},_initEditArea:function(){var a=this;this.editArea=new c.editArea(function(){a._create()});this.editAreaElement=this.editArea.getEditArea();var e=this.wp.element;c.insert(this.editAreaElement).after(e)},_create:function(){this.doc=document;this.element=this.wp;this.wp=this.parent.wp;this.commands=new a.Commands(this.parent);this.observe()}})})(workpad);
(function(a){var c=a.dom,b=a.util;a.views.Composer.prototype.observe=function(){var a=this.parent.element,g=this.editArea.getEditArea();pasteEvents=["drop","paste"];b.debug(a,g).debug();c.observe(g,"keydown",function(){});c.delegate(a,".content","mouseover",function(a){b.debug(c.offset(a.target).get()).debug()})}})(workpad);
(function(a){var c=a.data;a.views.Wp=a.views.View.extend({name:"workpad",constructor:function(a,c,g){this.base(a,c,g);this._observe()},initContentByData:function(a){a=c.pretty(a).get();a=this.buildDomByDatas(a);this._setContent(a)},_setContent:function(a){this.element.innerHTML=a},_observe:function(){}})})(workpad);
(function(a){var c=a.util;a.views.Wp.prototype.buildDomByDatas=function(a){var c=this;return function h(a){for(var b="",j="",v=0,p=a.length;v<p;v++){var s=a[v];0<s.children.length&&s.collapse&&(j=h(s.children));b+=c.buildHTMLBySingleData({id:s.id,content:s.content,description:s.description,children:j});j=""}return b}(a)};a.views.Wp.prototype.buildHTMLBySingleData=function(a){return c.string('<div class="item" data-id="#{id}"><div class="maindata"><div class="content">#{content}</div><div class="description">#{description}</div></div><div class="children">#{children}</div></div>').interpolate(a)}})(workpad);
(function(a){var c={initContent:void 0};a.Init=a.util.Events.extend({constructor:function(b,e){this.element="string"===typeof b?document.getElementById(b):b;this.config=a.util.object({}).merge(c).merge(e).get();this.currentView=this.wp=new a.views.Wp(this,this.element,this.config);this._isCompatible=a.browser.supported();this.currentView=this.composer=new a.views.Composer(this,this.wp,this.config);this.wp.initContentByData(this.config.initContent)}})})(workpad);
//@ sourceMappingURL=workpad.js.map