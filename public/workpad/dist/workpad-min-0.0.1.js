/**
 Author: liuyixi
 this is lincence
*/
var workpad={version:"0.0.1",util:{},dom:{},commands:{},ui:{},views:{},log:{},data:{},EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,KEYS:{BACKSPACE_KEY:8,TAB_KEY:9,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,END_KEY:35,HOME_KEY:36,LEFT_KEY:37,UP_KEY:38,RIGHT_KEY:39,DOWN_KEY:40,DELETE_KEY:46,A_KEY:65,C_KEY:67,X_KEY:88,V_KEY:86,Z_KEY:90}},Base=function(){};
Base.extend=function(a,b){var c=Base.prototype.extend;Base._prototyping=!0;var d=new this;c.call(d,a);d.base=function(){};delete Base._prototyping;var e=d.constructor,f=d.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==f)this._constructing=!0,e.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||c).call(arguments[0],d)};f.ancestor=this;f.extend=this.extend;f.forEach=this.forEach;f.implement=this.implement;f.prototype=
d;f.toString=this.toString;f.valueOf=function(a){return"object"==a?f:e.valueOf()};c.call(f,b);"function"==typeof f.init&&f.init();return f};
Base.prototype={extend:function(a,b){if(1<arguments.length){var c=this[a];if(c&&"function"==typeof b&&(!c.valueOf||c.valueOf()!=b.valueOf())&&/\bbase\b/.test(b)){var d=b.valueOf();b=function(){var a=this.base||Base.prototype.base;this.base=c;var b=d.apply(this,arguments);this.base=a;return b};b.valueOf=function(a){return"object"==a?b:d};b.toString=Base.toString}this[a]=b}else if(a){var e=Base.prototype.extend;!Base._prototyping&&"function"!=typeof this&&(e=this.extend||e);for(var f={toSource:null},
g=["constructor","toString","valueOf"],h=Base._prototyping?0:1;j=g[h++];)a[j]!=f[j]&&e.call(this,j,a[j]);for(var j in a)f[j]||e.call(this,j,a[j])}return this}};
Base=Base.extend({constructor:function(a){this.extend(a)}},{ancestor:Object,version:"1.1",forEach:function(a,b,c){for(var d in a)void 0===this.prototype[d]&&b.call(c,a[d],d,a)},implement:function(){for(var a=0;a<arguments.length;a++)if("function"==typeof arguments[a])arguments[a](this.prototype);else this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}});
workpad.browser=function(){var a=navigator.userAgent,b=document.createElement("div"),c=-1!==a.indexOf("MSIE")&&-1===a.indexOf("Opera"),d=-1!==a.indexOf("Gecko")&&-1===a.indexOf("KHTML"),e=-1!==a.indexOf("AppleWebKit/");a.indexOf("Chrome/");a.indexOf("Opera/");var f={formatBlock:c,insertUnorderedList:c||e,insertOrderedList:c||e},g={insertHTML:d};return{USER_AGENT:a,supported:function(){var a=this.USER_AGENT.toLowerCase(),c="contentEditable"in b,d=document.execCommand&&document.queryCommandSupported&&
document.queryCommandState,e=document.querySelector&&document.querySelectorAll,a=this.isIos()&&5>+(/ipad|iphone|ipod/.test(a)&&a.match(/ os (\d+).+? like mac os x/)||[,0])[1]||this.isAndroid()&&4>+(a.match(/android (\d+)/)||[,0])[1]||-1!==a.indexOf("opera mobi")||-1!==a.indexOf("hpwos/");return c&&d&&e&&!a},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},isTouchDevice:function(){return this.supportEvent("touchmove")},
supportEvent:function(a){var c;if(!(c="on"+a in b))b.setAttribute("on"+a,"return;"),c="function"===typeof b["on"+a];return c},supportsCommand:function(a,c){if(!f[c]){try{return a.queryCommandSupported(c)}catch(b){}try{return a.queryCommandEnabled(c)}catch(d){return!!g[c]}}return!1}}}();
(function(a){var b=["debug","info","warn","error"];a.util.debug=function(){var c=Array.prototype.slice.call(arguments),d=function(c,d,g){var h=b.indexOf(g),j=b.indexOf("debug");c=a.util.array(c).clone();c.unshift(console,d);return-1<h&&-1<j&&h>=j?console[g]?Function.prototype.bind.apply(console[g],c):Function.prototype.bind.apply(console.log,c):a.EMPTY_FUNCTION};return{error:d(c,"[WorkPad Error!!!]: ","error"),debug:d(c,"[WorkPad Debug]: ","debug"),info:d(c,"[WorkPad Info]: ","info"),warn:d(c,"[Workpad Warn!]: ",
"warn")}}})(workpad);
(function(){workpad.util.array=function(a){return{contains:function(b){if(a.indexOf)return-1!==a.indexOf(b);for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return!0;return!1},without:function(b){b=workpad.util.array(b);for(var c=[],d=0,e=a.length;d<e;d++)b.contains(a[d])||c.push(a[d]);return c},get:function(){for(var b=0,c=a.length,d=[];b<c;b++)d.push(a[b]);return d},unique:function(){for(var b=[],c=0,d=a.length;c<d;c++)workpad.util.array(b).contains(a[c])||b.push(a[c]);return b},clone:function(){for(var b=
[],c=0,d=a.length;c<d;c++)b.push(a[c]);return b}}}})();(function(){var a=/^\s+/,b=/\s+$/;workpad.util.string=function(c){c=String(c);return{trim:function(){return c.replace(a,"").replace(b,"")},interpolate:function(a){for(var b in a)c=this.replace("#{"+b+"}").by(a[b]);return c},replace:function(a){return{by:function(b){return c.split(a).join(b)}}}}}})();
(function(){workpad.util.object=function(a){return{merge:function(b){for(var c in b)a[c]=b[c];return this},get:function(){return a},clone:function(){var b={},c;for(c in a)b[c]=a[c];return b},isArray:function(){return"[object Array]"===Object.prototype.toString.call(a)},safeJSON:function(){try{var b=JSON.parse(JSON.stringify(a))}catch(c){b={}}return b}}}})();
workpad.util.Events=Base.extend({on:function(a,b){this.events=this.events||{};this.events[a]=this.events[a]||[];this.events[a].push(b);return this},off:function(a,b){this.events=this.events||{};var c=0,d,e;if(a){d=this.events[a]||[];for(e=[];c<d.length;c++)d[c]!==b&&b&&e.push(d[c]);this.events[a]=e}else this.events={};return this},fire:function(a,b){this.events=this.events||{};for(var c=this.events[a]||[],d=0;d<c.length;d++)c[d].call(this,b);return this}});
workpad.data.predata=function(){return{EMPTY_DATA:[{content:"Begin to edit your workpad",description:"",id:"00000000-0000-0000-0000-000000000000",collapsed:!0,children:[]}]}}();workpad.data.check=function(a){return{isObject:function(){return"object"===typeof a&&"[object object]"===Object.prototype.toString.call(a).toLowerCase()&&!a.length}}};
(function(a){var b=a.util;a.data.pretty=function(c){return{get:function(){if(b.object(c).isArray()){for(var d=[],e=c.length,f=0;f<e;f++)if(a.data.check(c[f]).isObject())try{var g=JSON.stringify(c[f]);"{}"!==g&&d.push(JSON.parse(g))}catch(h){}1>d.length&&(d=a.data.predata.EMPTY_DATA);return d}return a.data.predata.EMPTY_DATA}}}})(workpad);
(function(a){var b=a.dom;b.addClass=function(a,d){var e=a.classList;if(e)return e.add(d);b.hasClass(a,d)||(a.className+=" "+d)};b.removeClass=function(a,b){var e=a.classList;if(e)return e.remove(b);a.className=a.className.replace(RegExp("(^|\\s+)"+b+"(\\s+|$)")," ")};b.hasClass=function(a,b){var e=a.classList;if(e)return e.contains(b);e=a.className;return 0<e.length&&(e==b||RegExp("(^|\\s)"+b+"(\\s|$)").test(e))}})(workpad);
(function(){var a={className:"class"};workpad.dom.setAttributes=function(b){return{on:function(c){for(var d in b)c.setAttribute(a[d]||d,b[d])}}};workpad.dom.getAttribute=function(a){return{from:function(c){return c.getAttribute(a)}}}})();
workpad.dom.style=function(a){var b=workpad.dom,c={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},d=/\-[a-z]/g,e=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"];return{setto:function(b){b=b.style;if("string"===typeof a)b.cssText+=";"+a;else{a=workpad.util.object(a).safeJSON();for(var c in a)"float"===c?(b.cssFloat=a[c],b.styleFloat=a[c]):b[c]=a[c]}},getfrom:function(b){if(b.nodeType===workpad.ELEMENT_NODE){var e=b.ownerDocument,h=a,j=c[a]||
a.replace(d,function(a){return a.charAt(1).toUpperCase()}),k=b.style,m=b.currentStyle,l=k[j];if(l)return l;if(m)try{return m[j]}catch(p){}var j=e.defaultView||e.parentWindow,e=("height"===h||"width"===h)&&"TEXTAREA"===b.nodeName,n;if(j.getComputedStyle)return e&&(n=k.overflow,k.overflow="hidden"),b=j.getComputedStyle(b,null).getPropertyValue(h),e&&(k.overflow=n||""),b}},getNumberFrom:function(b){var c=this.getfrom(b),c=c?c.replace("px",""):0,c=parseFloat(c);return isNaN(c)?(workpad.util.debug("can't return a number about "+
a+" from ",b).error(),0):c},copyfrom:function(c){var d=a,h;a:{h=0;for(var j=e.length;h<j;h++)if("border-box"===b.style(e[h]).getfrom(c)){h=e[h];break a}h=void 0}(h=h?parseInt(b.style("width").getfrom(c),10)<c.offsetWidth:!1)&&(d=workpad.util.array(d).without(e));var k="";h=d.length;for(var j=0,m;j<h;j++)m=d[j],k+=m+":"+b.style(m).getfrom(c)+";";return{to:function(a){b.style(k).setto(a);return{andTo:arguments.callee}}}}}};
(function(a){a.dom.offset=function(b){var c=a.dom;return{get:function(){var a=b&&b.ownerDocument,c={top:0,left:0},f;if(a)return f=a.documentElement,"undefined"!==typeof b.getBoundingClientRect&&(c=b.getBoundingClientRect()),a=null!=a&&a===a.window?a:9===a.nodeType&&a.defaultView,{top:c.top+a.pageYOffset-f.clientTop,left:c.left+a.pageXOffset-f.clientLeft,width:c.width,height:c.height}},set:function(a){var e,f,g,h=c.style("position").getfrom(b),j={};"static"===h&&(b.style.position="relative");g=c.offset(b).get();
f=c.style("top").getfrom(b);e=c.style("left").getfrom(b);("absolute"===h||"fixed"===h)&&-1<(f+e).indexOf("auto")?(e=c.offset(b).position(),f=e.top,e=e.left):(f=parseFloat(f)||0,e=parseFloat(e)||0);null!=a.top&&(j.top=a.top-g.top+f+"px");null!=a.left&&(j.left=a.left-g.left+e+"px");null!=a.width&&(j.width=a.width+"px");null!=a.height&&(j.height=a.height+"px");c.style(j).setto(b)},offsetParent:function(){for(var a=b.offsetParent||document.documentElement;a&&!(a.nodeName&&"html"===a.nodeName.toLowerCase())&&
"static"===c.style("position").getfrom(a);)a=a.offsetParent;return a||document.documentElement},position:function(){if(b){var a,e,f={top:0,left:0};"fixed"===c.style("position").getfrom(b)?e=b.getBoundingClientRect():(a=c.offset(b).offsetParent(),e=c.offset(b).get(),a.nodeName&&"html"===a.nodeName.toLowerCase()||(f=c.offset(a).get()),f.top+=c.style("borderTopWidth").getNumberFrom(a),f.left+=c.style("borderLeftWidth").getNumberFrom(a));return{top:e.top-f.top-c.style("marginTop").getNumberFrom(a),left:e.left-
f.left-c.style("marginLeft").getNumberFrom(a)}}}}}})(workpad);workpad.dom.insert=function(a){return{after:function(b){b.parentNode.insertBefore(a,b.nextSibling)},before:function(b){b.parentNode.insertBefore(a,b)},into:function(b){b.appendChild(a)}}};
workpad.dom.observe=function(a,b,c){b="string"===typeof b?[b]:b;for(var d,e,f=0,g=b.length;f<g;f++)e=b[f],a.addEventListener?a.addEventListener(e,c,!1):(d=function(b){"target"in b||(b.target=b.srcElement);b.preventDefault=b.preventDefault||function(){this.returnValue=!1};b.stopPropagation=b.stopPropagation||function(){this.cancelBubble=!0};c.call(a,b)},a.attachEvent("on"+e,d));return{stop:function(){for(var e,f=0,g=b.length;f<g;f++)e=b[f],a.removeEventListener?a.removeEventListener(e,c,!1):a.detachEvent("on"+
e,d)}}};(function(a){a.dom.delegate=function(b,c,d,e){return a.dom.observe(b,d,function(d){for(var g=d.target,h=a.util.array(b.querySelectorAll(c));g&&g!==b;){if(h.contains(g)){e.call(g,d);break}g=g.parentNode}})}})(workpad);
workpad.dom.getParentElement=function(){function a(a,c){return!c||!c.length?!0:"string"===typeof c?a===c:workpad.util.array(c).contains(a)}return function(b,c,d){d=d||70;if(c.className||c.classRegExp){a:{var e=c.nodeName,f=c.className;for(c=c.classRegExp;d--&&b&&"BODY"!==b.nodeName;){var g;if(g=b.nodeType===workpad.ELEMENT_NODE)if(g=a(b.nodeName,e)){g=f;var h=c,h=h||g,h=(b.className||"").match(h)||[];g=!g?!!h.length:h[h.length-1]===g}if(g)break a;b=b.parentNode}b=null}return b}a:{e=c.nodeName;for(f=
d;f--&&b&&"BODY"!==b.nodeName;){if(a(b.nodeName,e))break a;b=b.parentNode}b=null}return b}}();(function(a){a.dom.editAreaRange=Base.extend({})})(workpad);
(function(a){var b=document;a.dom.editArea=Base.extend({constructor:function(b,d){var e=this;this.callback=b||a.EMPTY_FUNCTION;this.config=a.util.object({}).merge(d).get();this.editArea=this._createTextArea();setTimeout(function(){e.callback(e)},0)},insertInto:function(a){"string"===typeof a&&(a=b.getElementById(a));a.appendChild(this.editArea)},getEditArea:function(){return this.editArea},getRealNode:function(){return this.editArea.getElementsByTagName("textarea")[0]},setContent:function(a){this.editArea.getElementsByTagName("textarea")[0].value=
a;return this},getContent:function(){return this.editArea.getElementsByTagName("textarea")[0].value},empty:function(){this.editArea.getElementsByTagName("textarea")[0].value="";return this},_createTextArea:function(){var a=b.createElement("div");textarea=b.createElement("textarea");a.className="workpad-editArea editor";a.appendChild(textarea);return a}})})(workpad);
workpad.Commands=Base.extend({constructor:function(a){this.editor=a;this.composer=a.composer;this.doc=this.composer.doc},support:function(a){return workpad.browser.supportsCommand(this.doc,a)},exec:function(a,b){var c=workpad.commands[a],d=workpad.util.array(arguments).get(),e=c&&c.exec,f=null;if(e)d.unshift(this.editor),f=e.apply(c,d);else try{f=this.doc.execCommand(a,!1,b)}catch(g){}return f}});workpad.commands.addItem={exec:function(a){a.fire("addItem:dispatcher")}};
workpad.commands.indentItem={exec:function(a){a.fire("indentItem:dispatcher")}};workpad.commands.outdentItem={exec:function(a){a.fire("outdentItem:dispatcher")}};
workpad.views.View=Base.extend({constructor:function(a,b,c){this.parent=a;this.element=b;this.config=c},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(a){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}});
(function(a){var b=a.dom;a.views.Composer=a.views.View.extend({name:"composer",constructor:function(a,b,e){this.base(a,b,e);this.wp=this.parent.wp;this._initEditArea()},getUseHoverEditAreaElement:function(){return this.getUseHoverEditArea().getEditArea()},getUseHoverEditArea:function(){return this.editAreaA.lastEdit?this.editAreaB:this.editAreaA},_initEditArea:function(){var a=this;this.editAreaA=new b.editArea(function(){a.editAreaB=new b.editArea(function(){a._insertEditAreas()})})},_insertEditAreas:function(){this.editAreaElementA=
this.editAreaA.getEditArea();this.editAreaElementB=this.editAreaB.getEditArea();var a=this.wp.element;b.insert(this.editAreaElementA).after(a);b.insert(this.editAreaElementB).after(a);this.editAreaA.lastEdit=!1;this.editAreaB.lastEdit=!0;this._create()},_create:function(){this.doc=document;this.element=this.wp;this.wp=this.parent.wp;this.commands=new a.Commands(this.parent);this.parent.commands=this.commands;this.observe();this.dispatcher()}})})(workpad);
(function(a){var b=a.dom,c=a.util,d=a.KEYS;a.views.Composer.prototype.observe=function(){var a=this,f=this.parent.element,g=this.editAreaA.getEditArea(),h=this.editAreaA.getRealNode(),j=this.editAreaB.getEditArea(),k=this.editAreaB.getRealNode();pasteEvents=["drop","paste"];c.debug(f,g,j).debug();g=function(b){var c=b.keyCode;c===d.ENTER_KEY?(b.preventDefault(),a.commands.exec("addItem")):c===d.TAB_KEY&&(b.preventDefault(),b.shiftKey?a.commands.exec("outdentItem"):a.commands.exec("indentItem"))};
b.observe(h,"keydown",g);b.observe(k,"keydown",g);b.delegate(f,".content","mouseover",function(c){var d=b.getParentElement(c.target,{nodeName:"DIV",className:"item"}),f=c.target.textContent,d=b.getAttribute("data-id").from(d);b.offset(a.getUseHoverEditAreaElement()).set(b.offset(c.target).get());a.getUseHoverEditArea().setContent(f);b.setAttributes({"data-id":d,"data-type":"content"}).on(a.getUseHoverEditAreaElement())})}})(workpad);
(function(a){var b=a.util;a.views.Composer.prototype.dispatcher=function(){var a=this.parent,d=this;a.on("addItem:dispatcher",function(){b.debug("Editor on Event:","indentItem:dispatcher").info();d.commandExec("addItem")});a.on("indentItem:dispatcher",function(){b.debug("Editor on Event:","indentItem:dispatcher").info()});a.on("outdentItem:dispatcher",function(){b.debug("Editor on Event:","outdentItem:dispatcher").info()})}})(workpad);
(function(a){a.views.Composer.commandCenter={};a.views.Composer.prototype.commandExec=function(b,c){var d=a.views.Composer.commandCenter[b],e=a.util.array(arguments).get(),f=d&&d.exec;return f?(e.unshift(this.parent),f.apply(d,e)):!1}})(workpad);
workpad.views.Composer.commandCenter.addItem={exec:function(){workpad.util.debug("Get Event:","additem:dispatcher").info()}}(function(a){var b=a.data,c=a.util.debug;a.views.Wp=a.views.View.extend({name:"workpad",constructor:function(a,b,c){this.base(a,b,c);this._observe()},initContentByData:function(a){a=b.pretty(a).get();a=this.buildDomByDatas(a);this._setContent(a)},getElementByitemId:function(a){return this.element.querySelector(".item[data-id='"+a+"']")},getContentById:function(a){a=this.getElementByitemId(a);
c(a).debug()},_setContent:function(a){this.element.innerHTML=a},_observe:function(){}})})(workpad);(function(a){var b=a.util;a.views.Wp.prototype.buildDomByDatas=function(a){var b=this;return function f(a){for(var c="",j="",k=0,m=a.length;k<m;k++){var l=a[k];0<l.children.length&&l.collapse&&(j=f(l.children));c+=b.buildHTMLBySingleData({id:l.id,content:l.content,description:l.description,children:j});j=""}return c}(a)};a.views.Wp.prototype.buildHTMLBySingleData=function(a){return b.string('<div class="item" data-id="#{id}"><div class="maindata"><div class="content">#{content}</div><div class="description">#{description}</div></div><div class="children">#{children}</div></div>').interpolate(a)}})(workpad);
(function(a){var b={initContent:void 0};a.Init=a.util.Events.extend({constructor:function(c,d){this.element="string"===typeof c?document.getElementById(c):c;this.config=a.util.object({}).merge(b).merge(d).get();this.currentView=this.wp=new a.views.Wp(this,this.element,this.config);this._isCompatible=a.browser.supported();this.currentView=this.composer=new a.views.Composer(this,this.wp,this.config);this.wp.initContentByData(this.config.initContent)}})})(workpad);
//@ sourceMappingURL=workpad.js.map