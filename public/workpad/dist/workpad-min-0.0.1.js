/**
 Author: liuyixi
 this is lincence
*/
var workpad={version:"0.0.1",util:{},dom:{},commands:{},ui:{},views:{},log:{},data:{},EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,KEYS:{BACKSPACE_KEY:8,TAB_KEY:9,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,END_KEY:35,HOME_KEY:36,LEFT_KEY:37,UP_KEY:38,RIGHT_KEY:39,DOWN_KEY:40,DELETE_KEY:46,A_KEY:65,C_KEY:67,X_KEY:88,V_KEY:86,Z_KEY:90}},Base=function(){};
Base.extend=function(b,c){var a=Base.prototype.extend;Base._prototyping=!0;var d=new this;a.call(d,b);d.base=function(){};delete Base._prototyping;var e=d.constructor,f=d.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==f)this._constructing=!0,e.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||a).call(arguments[0],d)};f.ancestor=this;f.extend=this.extend;f.forEach=this.forEach;f.implement=this.implement;f.prototype=
d;f.toString=this.toString;f.valueOf=function(a){return"object"==a?f:e.valueOf()};a.call(f,c);"function"==typeof f.init&&f.init();return f};
Base.prototype={extend:function(b,c){if(1<arguments.length){var a=this[b];if(a&&"function"==typeof c&&(!a.valueOf||a.valueOf()!=c.valueOf())&&/\bbase\b/.test(c)){var d=c.valueOf();c=function(){var b=this.base||Base.prototype.base;this.base=a;var c=d.apply(this,arguments);this.base=b;return c};c.valueOf=function(a){return"object"==a?c:d};c.toString=Base.toString}this[b]=c}else if(b){var e=Base.prototype.extend;!Base._prototyping&&"function"!=typeof this&&(e=this.extend||e);for(var f={toSource:null},
g=["constructor","toString","valueOf"],h=Base._prototyping?0:1;j=g[h++];)b[j]!=f[j]&&e.call(this,j,b[j]);for(var j in b)f[j]||e.call(this,j,b[j])}return this}};
var Base=Base.extend({constructor:function(b){this.extend(b)}},{ancestor:Object,version:"1.1",forEach:function(b,c,a){for(var d in b)void 0===this.prototype[d]&&c.call(a,b[d],d,b)},implement:function(){for(var b=0;b<arguments.length;b++)if("function"==typeof arguments[b])arguments[b](this.prototype);else this.prototype.extend(arguments[b]);return this},toString:function(){return String(this.valueOf())}}),hexcase=0;function hex_md5(b){return rstr2hex(rstr_md5(str2rstr_utf8(b)))}
function hex_hmac_md5(b,c){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(b),str2rstr_utf8(c)))}function md5_vm_test(){return"900150983cd24fb0d6963f7d28e17f72"==hex_md5("abc").toLowerCase()}function rstr_md5(b){return binl2rstr(binl_md5(rstr2binl(b),8*b.length))}
function rstr_hmac_md5(b,c){var a=rstr2binl(b);16<a.length&&(a=binl_md5(a,8*b.length));for(var d=Array(16),e=Array(16),f=0;16>f;f++)d[f]=a[f]^909522486,e[f]=a[f]^1549556828;a=binl_md5(d.concat(rstr2binl(c)),512+8*c.length);return binl2rstr(binl_md5(e.concat(a),640))}function rstr2hex(b){try{hexcase}catch(c){hexcase=0}for(var a=hexcase?"0123456789ABCDEF":"0123456789abcdef",d="",e,f=0;f<b.length;f++)e=b.charCodeAt(f),d+=a.charAt(e>>>4&15)+a.charAt(e&15);return d}
function str2rstr_utf8(b){for(var c="",a=-1,d,e;++a<b.length;)d=b.charCodeAt(a),e=a+1<b.length?b.charCodeAt(a+1):0,55296<=d&&56319>=d&&(56320<=e&&57343>=e)&&(d=65536+((d&1023)<<10)+(e&1023),a++),127>=d?c+=String.fromCharCode(d):2047>=d?c+=String.fromCharCode(192|d>>>6&31,128|d&63):65535>=d?c+=String.fromCharCode(224|d>>>12&15,128|d>>>6&63,128|d&63):2097151>=d&&(c+=String.fromCharCode(240|d>>>18&7,128|d>>>12&63,128|d>>>6&63,128|d&63));return c}
function rstr2binl(b){for(var c=Array(b.length>>2),a=0;a<c.length;a++)c[a]=0;for(a=0;a<8*b.length;a+=8)c[a>>5]|=(b.charCodeAt(a/8)&255)<<a%32;return c}function binl2rstr(b){for(var c="",a=0;a<32*b.length;a+=8)c+=String.fromCharCode(b[a>>5]>>>a%32&255);return c}
function binl_md5(b,c){b[c>>5]|=128<<c%32;b[(c+64>>>9<<4)+14]=c;for(var a=1732584193,d=-271733879,e=-1732584194,f=271733878,g=0;g<b.length;g+=16)var h=a,j=d,k=e,l=f,a=md5_ff(a,d,e,f,b[g+0],7,-680876936),f=md5_ff(f,a,d,e,b[g+1],12,-389564586),e=md5_ff(e,f,a,d,b[g+2],17,606105819),d=md5_ff(d,e,f,a,b[g+3],22,-1044525330),a=md5_ff(a,d,e,f,b[g+4],7,-176418897),f=md5_ff(f,a,d,e,b[g+5],12,1200080426),e=md5_ff(e,f,a,d,b[g+6],17,-1473231341),d=md5_ff(d,e,f,a,b[g+7],22,-45705983),a=md5_ff(a,d,e,f,b[g+8],7,
1770035416),f=md5_ff(f,a,d,e,b[g+9],12,-1958414417),e=md5_ff(e,f,a,d,b[g+10],17,-42063),d=md5_ff(d,e,f,a,b[g+11],22,-1990404162),a=md5_ff(a,d,e,f,b[g+12],7,1804603682),f=md5_ff(f,a,d,e,b[g+13],12,-40341101),e=md5_ff(e,f,a,d,b[g+14],17,-1502002290),d=md5_ff(d,e,f,a,b[g+15],22,1236535329),a=md5_gg(a,d,e,f,b[g+1],5,-165796510),f=md5_gg(f,a,d,e,b[g+6],9,-1069501632),e=md5_gg(e,f,a,d,b[g+11],14,643717713),d=md5_gg(d,e,f,a,b[g+0],20,-373897302),a=md5_gg(a,d,e,f,b[g+5],5,-701558691),f=md5_gg(f,a,d,e,b[g+
10],9,38016083),e=md5_gg(e,f,a,d,b[g+15],14,-660478335),d=md5_gg(d,e,f,a,b[g+4],20,-405537848),a=md5_gg(a,d,e,f,b[g+9],5,568446438),f=md5_gg(f,a,d,e,b[g+14],9,-1019803690),e=md5_gg(e,f,a,d,b[g+3],14,-187363961),d=md5_gg(d,e,f,a,b[g+8],20,1163531501),a=md5_gg(a,d,e,f,b[g+13],5,-1444681467),f=md5_gg(f,a,d,e,b[g+2],9,-51403784),e=md5_gg(e,f,a,d,b[g+7],14,1735328473),d=md5_gg(d,e,f,a,b[g+12],20,-1926607734),a=md5_hh(a,d,e,f,b[g+5],4,-378558),f=md5_hh(f,a,d,e,b[g+8],11,-2022574463),e=md5_hh(e,f,a,d,b[g+
11],16,1839030562),d=md5_hh(d,e,f,a,b[g+14],23,-35309556),a=md5_hh(a,d,e,f,b[g+1],4,-1530992060),f=md5_hh(f,a,d,e,b[g+4],11,1272893353),e=md5_hh(e,f,a,d,b[g+7],16,-155497632),d=md5_hh(d,e,f,a,b[g+10],23,-1094730640),a=md5_hh(a,d,e,f,b[g+13],4,681279174),f=md5_hh(f,a,d,e,b[g+0],11,-358537222),e=md5_hh(e,f,a,d,b[g+3],16,-722521979),d=md5_hh(d,e,f,a,b[g+6],23,76029189),a=md5_hh(a,d,e,f,b[g+9],4,-640364487),f=md5_hh(f,a,d,e,b[g+12],11,-421815835),e=md5_hh(e,f,a,d,b[g+15],16,530742520),d=md5_hh(d,e,f,
a,b[g+2],23,-995338651),a=md5_ii(a,d,e,f,b[g+0],6,-198630844),f=md5_ii(f,a,d,e,b[g+7],10,1126891415),e=md5_ii(e,f,a,d,b[g+14],15,-1416354905),d=md5_ii(d,e,f,a,b[g+5],21,-57434055),a=md5_ii(a,d,e,f,b[g+12],6,1700485571),f=md5_ii(f,a,d,e,b[g+3],10,-1894986606),e=md5_ii(e,f,a,d,b[g+10],15,-1051523),d=md5_ii(d,e,f,a,b[g+1],21,-2054922799),a=md5_ii(a,d,e,f,b[g+8],6,1873313359),f=md5_ii(f,a,d,e,b[g+15],10,-30611744),e=md5_ii(e,f,a,d,b[g+6],15,-1560198380),d=md5_ii(d,e,f,a,b[g+13],21,1309151649),a=md5_ii(a,
d,e,f,b[g+4],6,-145523070),f=md5_ii(f,a,d,e,b[g+11],10,-1120210379),e=md5_ii(e,f,a,d,b[g+2],15,718787259),d=md5_ii(d,e,f,a,b[g+9],21,-343485551),a=safe_add(a,h),d=safe_add(d,j),e=safe_add(e,k),f=safe_add(f,l);return[a,d,e,f]}function md5_cmn(b,c,a,d,e,f){return safe_add(bit_rol(safe_add(safe_add(c,b),safe_add(d,f)),e),a)}function md5_ff(b,c,a,d,e,f,g){return md5_cmn(c&a|~c&d,b,c,e,f,g)}function md5_gg(b,c,a,d,e,f,g){return md5_cmn(c&d|a&~d,b,c,e,f,g)}
function md5_hh(b,c,a,d,e,f,g){return md5_cmn(c^a^d,b,c,e,f,g)}function md5_ii(b,c,a,d,e,f,g){return md5_cmn(a^(c|~d),b,c,e,f,g)}function safe_add(b,c){var a=(b&65535)+(c&65535);return(b>>16)+(c>>16)+(a>>16)<<16|a&65535}function bit_rol(b,c){return b<<c|b>>>32-c}
workpad.browser=function(){var b=navigator.userAgent,c=document.createElement("div"),a=-1!==b.indexOf("MSIE")&&-1===b.indexOf("Opera"),d=-1!==b.indexOf("Gecko")&&-1===b.indexOf("KHTML"),e=-1!==b.indexOf("AppleWebKit/");b.indexOf("Chrome/");b.indexOf("Opera/");var f={formatBlock:a,insertUnorderedList:a||e,insertOrderedList:a||e},g={insertHTML:d};return{USER_AGENT:b,supported:function(){var a=this.USER_AGENT.toLowerCase(),b="contentEditable"in c,d=document.execCommand&&document.queryCommandSupported&&
document.queryCommandState,e=document.querySelector&&document.querySelectorAll,a=this.isIos()&&5>+(/ipad|iphone|ipod/.test(a)&&a.match(/ os (\d+).+? like mac os x/)||[,0])[1]||this.isAndroid()&&4>+(a.match(/android (\d+)/)||[,0])[1]||-1!==a.indexOf("opera mobi")||-1!==a.indexOf("hpwos/");return b&&d&&e&&!a},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},isTouchDevice:function(){return this.supportEvent("touchmove")},
supportEvent:function(a){var b;if(!(b="on"+a in c))c.setAttribute("on"+a,"return;"),b="function"===typeof c["on"+a];return b},supportsCommand:function(a,b){if(!f[b]){try{return a.queryCommandSupported(b)}catch(d){}try{return a.queryCommandEnabled(b)}catch(c){return!!g[b]}}return!1}}}();
(function(b){var c=["debug","info","warn","error"];b.util.debug=function(){var a=Array.prototype.slice.call(arguments),d=function(a,d,g){var h=c.indexOf(g),j=c.indexOf("debug");a=b.util.array(a).clone();a.unshift(console,d);return-1<h&&-1<j&&h>=j?console[g]?Function.prototype.bind.apply(console[g],a):Function.prototype.bind.apply(console.log,a):b.EMPTY_FUNCTION};return{error:d(a,"[WorkPad Error!!!]: ","error"),debug:d(a,"[WorkPad Debug]: ","debug"),info:d(a,"[WorkPad Info]: ","info"),warn:d(a,"[Workpad Warn!]: ",
"warn")}}})(workpad);
(function(){workpad.util.array=function(b){return{contains:function(c){if(b.indexOf)return-1!==b.indexOf(c);for(var a=0,d=b.length;a<d;a++)if(b[a]===c)return!0;return!1},without:function(c){c=workpad.util.array(c);for(var a=[],d=0,e=b.length;d<e;d++)c.contains(b[d])||a.push(b[d]);return a},get:function(){for(var c=0,a=b.length,d=[];c<a;c++)d.push(b[c]);return d},unique:function(){for(var c=[],a=0,d=b.length;a<d;a++)workpad.util.array(c).contains(b[a])||c.push(b[a]);return c},clone:function(){for(var c=
[],a=0,d=b.length;a<d;a++)c.push(b[a]);return c}}}})();(function(){var b=/^\s+/,c=/\s+$/;workpad.util.string=function(a){a=String(a);return{trim:function(){return a.replace(b,"").replace(c,"")},interpolate:function(b){for(var c in b)a=this.replace("#{"+c+"}").by(b[c]);return a},replace:function(b){return{by:function(c){return a.split(b).join(c)}}}}}})();
(function(){workpad.util.object=function(b){return{merge:function(c){for(var a in c)b[a]=c[a];return this},get:function(){return b},clone:function(){var c={},a;for(a in b)c[a]=b[a];return c},isArray:function(){return"[object Array]"===Object.prototype.toString.call(b)},safeJSON:function(){try{var c=JSON.parse(JSON.stringify(b))}catch(a){c={}}return c}}}})();
workpad.util.Events=Base.extend({on:function(b,c){this.events=this.events||{};this.events[b]=this.events[b]||[];this.events[b].push(c);return this},off:function(b,c){this.events=this.events||{};var a=0,d,e;if(b){d=this.events[b]||[];for(e=[];a<d.length;a++)d[a]!==c&&c&&e.push(d[a]);this.events[b]=e}else this.events={};return this},fire:function(b,c){this.events=this.events||{};for(var a=this.events[b]||[],d=0;d<a.length;d++)a[d].call(this,c);return this}});
workpad.data.predata=function(){var b=[{content:"Begin to edit your workpad",description:"",id:"00000000-0000-0000-0000-000000000000",expand:!0,children:[]}],c={content:"",description:"",id:"",expand:!0,children:[]};return{GET_EMPTY_DATA:function(){return JSON.parse(JSON.stringify(b))},GET_DEFAULT_JSON:function(){return JSON.parse(JSON.stringify(c))}}}();
workpad.data.check=function(b){return{isObject:function(){return"object"===typeof b&&"[object object]"===Object.prototype.toString.call(b).toLowerCase()&&!b.length}}};(function(b){var c=b.util;b.data.pretty=function(a){return{get:function(){if(c.object(a).isArray()){for(var d=[],e=a.length,f=0;f<e;f++)if(b.data.check(a[f]).isObject())try{var g=JSON.stringify(a[f]);"{}"!==g&&d.push(JSON.parse(g))}catch(h){}1>d.length&&(d=b.data.predata.GET_EMPTY_DATA());return d}return b.data.predata.GET_EMPTY_DATA()}}}})(workpad);
(function(b){var c=b.dom;c.addClass=function(a,b){var e=a.classList;if(e)return e.add(b);c.hasClass(a,b)||(a.className+=" "+b)};c.removeClass=function(a,b){var c=a.classList;if(c)return c.remove(b);a.className=a.className.replace(RegExp("(^|\\s+)"+b+"(\\s+|$)")," ")};c.hasClass=function(a,b){var c=a.classList;if(c)return c.contains(b);c=a.className;return 0<c.length&&(c==b||RegExp("(^|\\s)"+b+"(\\s|$)").test(c))}})(workpad);
(function(){var b={className:"class"};workpad.dom.setAttributes=function(c){return{on:function(a){for(var d in c)a.setAttribute(b[d]||d,c[d])}}};workpad.dom.getAttribute=function(b){return{from:function(a){return a.getAttribute(b)}}}})();
workpad.dom.style=function(b){var c=workpad.dom,a={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},d=/\-[a-z]/g,e=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"];return{setto:function(a){a=a.style;if("string"===typeof b)a.cssText+=";"+b;else{b=workpad.util.object(b).safeJSON();for(var d in b)"float"===d?(a.cssFloat=b[d],a.styleFloat=b[d]):a[d]=b[d]}},getfrom:function(c){if(c.nodeType===workpad.ELEMENT_NODE){var e=c.ownerDocument,h=b,j=a[b]||
b.replace(d,function(a){return a.charAt(1).toUpperCase()}),k=c.style,l=c.currentStyle,m=k[j];if(m)return m;if(l)try{return l[j]}catch(p){}var j=e.defaultView||e.parentWindow,e=("height"===h||"width"===h)&&"TEXTAREA"===c.nodeName,n;if(j.getComputedStyle)return e&&(n=k.overflow,k.overflow="hidden"),c=j.getComputedStyle(c,null).getPropertyValue(h),e&&(k.overflow=n||""),c}},getNumberFrom:function(a){var d=this.getfrom(a),d=d?d.replace("px",""):0,d=parseFloat(d);return isNaN(d)?(workpad.util.debug("can't return a number about "+
b+" from ",a).error(),0):d},copyfrom:function(a){var d=b,h;a:{h=0;for(var j=e.length;h<j;h++)if("border-box"===c.style(e[h]).getfrom(a)){h=e[h];break a}h=void 0}(h=h?parseInt(c.style("width").getfrom(a),10)<a.offsetWidth:!1)&&(d=workpad.util.array(d).without(e));var k="";h=d.length;for(var j=0,l;j<h;j++)l=d[j],k+=l+":"+c.style(l).getfrom(a)+";";return{to:function(a){c.style(k).setto(a);return{andTo:arguments.callee}}}}}};
(function(b){b.dom.offset=function(c){var a=b.dom;return{get:function(){var a=c&&c.ownerDocument,b={top:0,left:0},f;if(a)return f=a.documentElement,"undefined"!==typeof c.getBoundingClientRect&&(b=c.getBoundingClientRect()),a=null!=a&&a===a.window?a:9===a.nodeType&&a.defaultView,{top:b.top+a.pageYOffset-f.clientTop,left:b.left+a.pageXOffset-f.clientLeft,width:b.width,height:b.height}},set:function(b){var e,f,g,h=a.style("position").getfrom(c),j={};"static"===h&&(c.style.position="relative");g=a.offset(c).get();
f=a.style("top").getfrom(c);e=a.style("left").getfrom(c);("absolute"===h||"fixed"===h)&&-1<(f+e).indexOf("auto")?(e=a.offset(c).position(),f=e.top,e=e.left):(f=parseFloat(f)||0,e=parseFloat(e)||0);null!=b.top&&(j.top=b.top-g.top+f+"px");null!=b.left&&(j.left=b.left-g.left+e+"px");null!=b.width&&(j.width=b.width+"px");null!=b.height&&(j.height=b.height+"px");a.style(j).setto(c)},offsetParent:function(){for(var b=c.offsetParent||document.documentElement;b&&!(b.nodeName&&"html"===b.nodeName.toLowerCase())&&
"static"===a.style("position").getfrom(b);)b=b.offsetParent;return b||document.documentElement},position:function(){if(c){var b,e,f={top:0,left:0};"fixed"===a.style("position").getfrom(c)?e=c.getBoundingClientRect():(b=a.offset(c).offsetParent(),e=a.offset(c).get(),b.nodeName&&"html"===b.nodeName.toLowerCase()||(f=a.offset(b).get()),f.top+=a.style("borderTopWidth").getNumberFrom(b),f.left+=a.style("borderLeftWidth").getNumberFrom(b));return{top:e.top-f.top-a.style("marginTop").getNumberFrom(b),left:e.left-
f.left-a.style("marginLeft").getNumberFrom(b)}}}}}})(workpad);workpad.dom.getAsDom=function(){return function(b,c){c=c||document;var a;if("object"===typeof b&&b.nodeType)a=c.createElement("div"),a.appendChild(b);else{a=c;var d=a.createElement("div");d.style.display="none";a.body.appendChild(d);try{d.innerHTML=b}catch(e){}a.body.removeChild(d);a=d}a=a.childNodes;1==a.length&&(a=a[0]);return a}}();
workpad.dom.insert=function(b){return{after:function(c){c.parentNode.insertBefore(b,c.nextSibling)},before:function(c){c.parentNode.insertBefore(b,c)},into:function(c){c.appendChild(b)}}};
workpad.dom.observe=function(b,c,a){c="string"===typeof c?[c]:c;for(var d,e,f=0,g=c.length;f<g;f++)e=c[f],b.addEventListener?b.addEventListener(e,a,!1):(d=function(d){"target"in d||(d.target=d.srcElement);d.preventDefault=d.preventDefault||function(){this.returnValue=!1};d.stopPropagation=d.stopPropagation||function(){this.cancelBubble=!0};a.call(b,d)},b.attachEvent("on"+e,d));return{stop:function(){for(var e,f=0,g=c.length;f<g;f++)e=c[f],b.removeEventListener?b.removeEventListener(e,a,!1):b.detachEvent("on"+
e,d)}}};(function(b){b.dom.delegate=function(c,a,d,e){return b.dom.observe(c,d,function(d){for(var g=d.target,h=b.util.array(c.querySelectorAll(a));g&&g!==c;){if(h.contains(g)){e.call(g,d);break}g=g.parentNode}})}})(workpad);
workpad.dom.getParentElement=function(){function b(b,a){return!a||!a.length?!0:"string"===typeof a?b===a:workpad.util.array(a).contains(b)}return function(c,a,d){d=d||70;if(a.className||a.classRegExp){a:{var e=a.nodeName,f=a.className;for(a=a.classRegExp;d--&&c&&"BODY"!==c.nodeName;){var g;if(g=c.nodeType===workpad.ELEMENT_NODE)if(g=b(c.nodeName,e)){g=f;var h=a,h=h||g,h=(c.className||"").match(h)||[];g=!g?!!h.length:h[h.length-1]===g}if(g)break a;c=c.parentNode}c=null}return c}a:{e=a.nodeName;for(f=
d;f--&&c&&"BODY"!==c.nodeName;){if(b(c.nodeName,e))break a;c=c.parentNode}c=null}return c}}();(function(b){var c,a;a=function(a,b,c){return{start:b,end:c,length:c-b,text:a.value.slice(b,c)}};c=function(b){return a(b,b.selectionStart,b.selectionEnd)};b.dom.editAreaRange=Base.extend({constructor:function(a){this.element=a},getSelection:function(){return c(this.element)},getLRchar:function(){var a=c(this.element),b=this.element.value;return{left:b.slice(0,a.start),right:b.slice(a.start,b.length)}}})})(workpad);
(function(b){var c=document;b.dom.editArea=b.dom.editAreaRange.extend({constructor:function(a,d){var c=this;this.callback=a||b.EMPTY_FUNCTION;this.config=b.util.object({}).merge(d).get();this.editArea=this._createTextArea();this.base(this.getRealNode());setTimeout(function(){c.callback(c)},0)},insertInto:function(a){"string"===typeof a&&(a=c.getElementById(a));a.appendChild(this.editArea)},getEditArea:function(){return this.editArea},getRealNode:function(){return this.editArea.getElementsByTagName("textarea")[0]},
setContent:function(a){this.editArea.getElementsByTagName("textarea")[0].value=a;return this},getContent:function(){return this.editArea.getElementsByTagName("textarea")[0].value},empty:function(){this.editArea.getElementsByTagName("textarea")[0].value="";return this},_createTextArea:function(){var a=c.createElement("div");textarea=c.createElement("textarea");a.className="workpad-editArea editor";a.appendChild(textarea);return a}})})(workpad);
workpad.Commands=Base.extend({constructor:function(b){this.editor=b;this.composer=b.composer;this.doc=this.composer.doc},support:function(b){return workpad.browser.supportsCommand(this.doc,b)},exec:function(b,c){var a=workpad.commands[b],d=workpad.util.array(arguments).get(),e=a&&a.exec,f=null;if(e)d.unshift(this.editor),f=e.apply(a,d);else try{f=this.doc.execCommand(b,!1,c)}catch(g){}return f}});workpad.commands.addItem={exec:function(b){b.fire("addItem:dispatcher")}};
workpad.commands.indentItem={exec:function(b){b.fire("indentItem:dispatcher")}};workpad.commands.outdentItem={exec:function(b){b.fire("outdentItem:dispatcher")}};
workpad.views.View=Base.extend({constructor:function(b,c,a){this.parent=b;this.element=c;this.config=a},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(b){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}});
(function(b){var c=b.dom;b.views.Composer=b.views.View.extend({name:"composer",constructor:function(a,b,c){this.base(a,b,c);this.wp=this.parent.wp;this._initEditArea()},getUseHoverEditAreaElement:function(){return this.getUseHoverEditArea().getEditArea()},getUseHoverEditArea:function(){return this.editAreaA.lastEdit?this.editAreaB:this.editAreaA},getCurrentUseEditAreaElement:function(){return this.getCurrentUseEditArea().getEditArea()},getCurrentUseEditArea:function(){return this.editAreaA.lastEdit?
this.editAreaA:this.editAreaB},setEditAreaWithItemIdForContent:function(a,b){var e=this.wp.getContentElementById(b);c.offset(a.getEditArea()).set(c.offset(e).get());a.setContent(e.textContent);c.setAttributes({"data-id":b,"data-type":"content"}).on(a.getEditArea())},_initEditArea:function(){var a=this;this.editAreaA=new c.editArea(function(){a.editAreaB=new c.editArea(function(){a._insertEditAreas()})})},_insertEditAreas:function(){this.editAreaElementA=this.editAreaA.getEditArea();this.editAreaElementB=
this.editAreaB.getEditArea();var a=this.wp.element;c.insert(this.editAreaElementA).after(a);c.insert(this.editAreaElementB).after(a);this.editAreaA.lastEdit=!1;this.editAreaB.lastEdit=!0;this._create()},_create:function(){this.doc=document;this.element=this.wp;this.wp=this.parent.wp;this.commands=new b.Commands(this.parent);this.parent.commands=this.commands;this.observe();this.dispatcher()}})})(workpad);
(function(b){var c=b.dom,a=b.util,d=b.KEYS;b.views.Composer.prototype.observe=function(){var b=this,f=this.parent.element,g=this.editAreaA.getEditArea(),h=this.editAreaA.getRealNode(),j=this.editAreaB.getEditArea(),k=this.editAreaB.getRealNode();pasteEvents=["drop","paste"];a.debug(f,g,j).debug();g=function(a){var c=a.keyCode;c===d.ENTER_KEY?(a.preventDefault(),b.commands.exec("addItem")):c===d.TAB_KEY&&(a.preventDefault(),a.shiftKey?b.commands.exec("outdentItem"):b.commands.exec("indentItem"))};
c.observe(h,"keydown",g);c.observe(k,"keydown",g);c.observe(h,"focus",function(){b.editAreaA.lastEdit=!0;b.editAreaB.lastEdit=!1});c.observe(k,"focus",function(){b.editAreaA.lastEdit=!1;b.editAreaB.lastEdit=!0});c.delegate(f,".content","mouseover",function(a){var d=c.getParentElement(a.target,{nodeName:"DIV",className:"item"}),f=a.target.textContent,d=c.getAttribute("data-id").from(d);c.offset(b.getUseHoverEditAreaElement()).set(c.offset(a.target).get());b.getUseHoverEditArea().setContent(f);c.setAttributes({"data-id":d,
"data-type":"content"}).on(b.getUseHoverEditAreaElement())})}})(workpad);(function(b){var c=b.util;b.views.Composer.prototype.dispatcher=function(){var a=this.parent,b=this;a.on("addItem:dispatcher",function(){c.debug("Editor on Event:","indentItem:dispatcher").info();b.commandExec("addItem")});a.on("indentItem:dispatcher",function(){c.debug("Editor on Event:","indentItem:dispatcher").info()});a.on("outdentItem:dispatcher",function(){c.debug("Editor on Event:","outdentItem:dispatcher").info()})}})(workpad);
(function(b){b.views.Composer.commandCenter={};b.views.Composer.prototype.commandExec=function(c,a){var d=b.views.Composer.commandCenter[c],e=b.util.array(arguments).get(),f=d&&d.exec;return f?(e.unshift(this.parent),f.apply(d,e)):!1}})(workpad);
workpad.views.Composer.commandCenter.addItem={exec:function(b){workpad.util.debug("Get Event:","additem:dispatcher").info();var c=workpad.dom,a=b.composer,d=a.getCurrentUseEditArea();b=b.wp;var e=d.getLRchar(),f=workpad.dom.getAttribute("data-id").from(d.getEditArea()),g=b.getElementByitemId(f),h=b.haveChildrenWithId(f),j=b.isExpandWithID(f),k=b.initNewBulletPointData(),l=k.id,m=c.getAsDom(b.buildHTMLBySingleData(k));workpad.util.debug(e,f,g,h,j,k,m).debug();h&&1>e.right.length&&j?workpad.util.debug("Add item case 1").info():
!h&&1>e.right.length?workpad.util.debug("Add item case 2").info():(workpad.util.debug("Add item case 3").info(),c.insert(m).before(g),b.setContentById(f,e.right),b.setContentById(l,e.left),a.setEditAreaWithItemIdForContent(d,f))}};
(function(b){var c=b.data;b.views.Wp=b.views.View.extend({name:"workpad",constructor:function(a,b,c){this.base(a,b,c);this._observe()},initContentByData:function(a){a=c.pretty(a).get();a=this.buildDomByDatas(a);this._setContent(a)},getElementByitemId:function(a){return this.element.querySelector(".item[data-id='"+a+"']")},getContentById:function(a){return this.getElementByitemId(a).querySelector(".content").innerHTML},setContentById:function(a,b){this.getElementByitemId(a).querySelector(".content").innerHTML=
b},haveChildrenWithId:function(a){a=this.getElementByitemId(a).querySelector(".children");return 1>b.util.string(a.innerHTML).trim().length?!1:!0},getContentElementById:function(a){return this.getElementByitemId(a).querySelector("div.content")},initNewBulletPointId:function(){for(var a=hex_md5(Date.parse(new Date).toString()+Math.random().toString()),b="",c=[8,12,16,20],f=0,g=a.length,h;h=a.charAt(f),f<g;f++)b+=h,-1<c.indexOf(f+1)&&(b+="-");return b},initNewBulletPointData:function(){var a=b.data.predata.GET_DEFAULT_JSON();
a.id=this.initNewBulletPointId();return a},isExpandWithID:function(){return!0},_setContent:function(a){this.element.innerHTML=a},_observe:function(){}})})(workpad);
(function(b){var c=b.util;b=b.views.Wp.prototype;b.buildDomByDatas=function(a){var b=this;return function f(a){for(var c="",j="",k=0,l=a.length;k<l;k++){var m=a[k];0<m.children.length&&m.expand&&(j=f(m.children));c+=b.buildHTMLBySingleData({id:m.id,content:m.content,description:m.description,children:j});j=""}return c}(a)};b.buildHTMLBySingleData=function(a){return c.string('<div class="item" data-id="#{id}"><div class="maindata"><div class="content">#{content}</div><div class="description">#{description}</div></div><div class="children">#{children}</div></div>').interpolate(a)}})(workpad);
(function(b){var c={initContent:void 0};b.Init=b.util.Events.extend({constructor:function(a,d){this.element="string"===typeof a?document.getElementById(a):a;this.config=b.util.object({}).merge(c).merge(d).get();this.currentView=this.wp=new b.views.Wp(this,this.element,this.config);this._isCompatible=b.browser.supported();this.currentView=this.composer=new b.views.Composer(this,this.wp,this.config);this.wp.initContentByData(this.config.initContent)}})})(workpad);
//@ sourceMappingURL=workpad.js.map