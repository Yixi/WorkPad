/**
 Author: liuyixi
 this is lincence
*/
var workpad={version:"0.0.1",util:{},dom:{},commands:{},ui:{},views:{},log:{},data:{},EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,KEYS:{BACKSPACE_KEY:8,TAB_KEY:9,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,END_KEY:35,HOME_KEY:36,LEFT_KEY:37,UP_KEY:38,RIGHT_KEY:39,DOWN_KEY:40,DELETE_KEY:46,A_KEY:65,C_KEY:67,X_KEY:88,V_KEY:86,Z_KEY:90}},Base=function(){};
Base.extend=function(a,c){var b=Base.prototype.extend;Base._prototyping=!0;var d=new this;b.call(d,a);d.base=function(){};delete Base._prototyping;var e=d.constructor,f=d.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==f)this._constructing=!0,e.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||b).call(arguments[0],d)};f.ancestor=this;f.extend=this.extend;f.forEach=this.forEach;f.implement=this.implement;f.prototype=
d;f.toString=this.toString;f.valueOf=function(a){return"object"==a?f:e.valueOf()};b.call(f,c);"function"==typeof f.init&&f.init();return f};
Base.prototype={extend:function(a,c){if(1<arguments.length){var b=this[a];if(b&&"function"==typeof c&&(!b.valueOf||b.valueOf()!=c.valueOf())&&/\bbase\b/.test(c)){var d=c.valueOf();c=function(){var a=this.base||Base.prototype.base;this.base=b;var c=d.apply(this,arguments);this.base=a;return c};c.valueOf=function(a){return"object"==a?c:d};c.toString=Base.toString}this[a]=c}else if(a){var e=Base.prototype.extend;!Base._prototyping&&"function"!=typeof this&&(e=this.extend||e);for(var f={toSource:null},
l=["constructor","toString","valueOf"],j=Base._prototyping?0:1;g=l[j++];)a[g]!=f[g]&&e.call(this,g,a[g]);for(var g in a)f[g]||e.call(this,g,a[g])}return this}};
Base=Base.extend({constructor:function(a){this.extend(a)}},{ancestor:Object,version:"1.1",forEach:function(a,c,b){for(var d in a)void 0===this.prototype[d]&&c.call(b,a[d],d,a)},implement:function(){for(var a=0;a<arguments.length;a++)if("function"==typeof arguments[a])arguments[a](this.prototype);else this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}});
window.rangy=function(){function a(a,c){var b=typeof a[c];return b==v||!!(b==g&&a[c])||"unknown"==b}function c(a,c){return!!(typeof a[c]==g&&a[c])}function b(a,c){return typeof a[c]!=n}function d(a){return function(c,b){for(var s=b.length;s--;)if(!a(c,b[s]))return!1;return!0}}function e(a){return a&&p(a,m)&&C(a,x)}function f(a){window.alert("Rangy not supported in your browser. Reason: "+a);q.initialized=!0;q.supported=!1}function l(){if(!q.initialized){var b,s=!1,d=!1;a(document,"createRange")&&
(b=document.createRange(),p(b,u)&&C(b,r)&&(s=!0),b.detach());if((b=c(document,"body")?document.body:document.getElementsByTagName("body")[0])&&a(b,"createTextRange"))b=b.createTextRange(),e(b)&&(d=!0);!s&&!d&&f("Neither Range nor TextRange are implemented");q.initialized=!0;q.features={implementsDomRange:s,implementsTextRange:d};s=K.concat(F);d=0;for(b=s.length;d<b;++d)try{s[d](q)}catch(m){c(window,"console")&&a(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",
m)}}}function j(a){this.name=a;this.supported=this.initialized=!1}var g="object",v="function",n="undefined",r="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer START_TO_START START_TO_END END_TO_START END_TO_END".split(" "),u="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),
x="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),m="collapse compareEndPoints duplicate getBookmark moveToBookmark moveToElementText parentElement pasteHTML select setEndPoint getBoundingClientRect".split(" "),p=d(a),s=d(c),C=d(b),q={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:a,isHostObject:c,isHostProperty:b,areHostMethods:p,areHostObjects:s,areHostProperties:C,isTextRange:e},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};
q.fail=f;q.warn=function(a){a="Rangy warning: "+a;q.config.alertOnWarn?window.alert(a):typeof window.console!=n&&typeof window.console.log!=n&&window.console.log(a)};({}).hasOwnProperty?q.util.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}:f("hasOwnProperty not supported");var F=[],K=[];q.init=l;q.addInitListener=function(a){q.initialized?a(q):F.push(a)};var G=[];q.addCreateMissingNativeApiListener=function(a){G.push(a)};q.createMissingNativeApi=function(a){a=a||window;l();
for(var b=0,c=G.length;b<c;++b)G[b](a)};j.prototype.fail=function(a){this.initialized=!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+a);};j.prototype.warn=function(a){q.warn("Module "+this.name+": "+a)};j.prototype.createError=function(a){return Error("Error in Rangy "+this.name+" module: "+a)};q.createModule=function(a,b){var c=new j(a);q.modules[a]=c;K.push(function(a){b(a,c);c.initialized=!0;c.supported=!0})};q.requireModules=function(a){for(var b=0,c=a.length,s,d;b<
c;++b){d=a[b];s=q.modules[d];if(!s||!(s instanceof j))throw Error("Module '"+d+"' not found");if(!s.supported)throw Error("Module '"+d+"' not supported");}};var E=!1,s=function(){E||(E=!0,q.initialized||l())};if(typeof window==n)f("No window found");else if(typeof document==n)f("No document found");else return a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",s,!1),a(window,"addEventListener")?window.addEventListener("load",s,!1):a(window,"attachEvent")?window.attachEvent("onload",
s):f("Window does not have required addEventListener or attachEvent method"),q}();
rangy.createModule("DomUtil",function(a,c){function b(a){for(var b=0;a=a.previousSibling;)b++;return b}function d(a,b){var c=[],d;for(d=a;d;d=d.parentNode)c.push(d);for(d=b;d;d=d.parentNode)if(p(c,d))return d;return null}function e(a,b,c){for(c=c?a:a.parentNode;c;){a=c.parentNode;if(a===b)return c;c=a}return null}function f(a){a=a.nodeType;return 3==a||4==a||8==a}function l(a,b){var c=b.nextSibling,d=b.parentNode;c?d.insertBefore(a,c):d.appendChild(a);return a}function j(a){if(9==a.nodeType)return a;
if(typeof a.ownerDocument!=u)return a.ownerDocument;if(typeof a.document!=u)return a.document;if(a.parentNode)return j(a.parentNode);throw Error("getDocument: no document found for node");}function g(a){return!a?"[No node]":f(a)?'"'+a.data+'"':1==a.nodeType?"<"+a.nodeName+(a.id?' id="'+a.id+'"':"")+">["+a.childNodes.length+"]":a.nodeName}function v(a){this._next=this.root=a}function n(a,b){this.node=a;this.offset=b}function r(a){this.code=this[a];this.codeName=a;this.message="DOMException: "+this.codeName}
var u="undefined",x=a.util;x.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||c.fail("document missing a Node creation method");x.isHostMethod(document,"getElementsByTagName")||c.fail("document missing getElementsByTagName method");var m=document.createElement("div");x.areHostMethods(m,["insertBefore","appendChild","cloneNode"])||c.fail("Incomplete Element implementation");x.isHostProperty(m,"innerHTML")||c.fail("Element is missing innerHTML property");m=document.createTextNode("test");
x.areHostMethods(m,["splitText","deleteData","insertData","appendData","cloneNode"])||c.fail("Incomplete Text Node implementation");var p=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};v.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next,b;if(this._current){b=a.firstChild;if(!b)for(b=null;a!==this.root&&!(b=a.nextSibling);)a=a.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=
null}};n.prototype={equals:function(a){return this.node===a.node&this.offset==a.offset},inspect:function(){return"[DomPosition("+g(this.node)+":"+this.offset+")]"}};r.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};r.prototype.toString=function(){return this.message};a.dom={arrayContains:p,isHtmlNamespace:function(a){var b;return typeof a.namespaceURI==u||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==
b},parentElement:function(a){a=a.parentNode;return 1==a.nodeType?a:null},getNodeIndex:b,getNodeLength:function(a){var b;return f(a)?a.length:(b=a.childNodes)?b.length:0},getCommonAncestor:d,isAncestorOf:function(a,b,c){for(b=c?b:b.parentNode;b;){if(b===a)return!0;b=b.parentNode}return!1},getClosestAncestorIn:e,isCharacterDataNode:f,insertAfter:l,splitDataNode:function(a,b){var c=a.cloneNode(!1);c.deleteData(0,b);a.deleteData(b,a.length-b);l(c,a);return c},getDocument:j,getWindow:function(a){a=j(a);
if(typeof a.defaultView!=u)return a.defaultView;if(typeof a.parentWindow!=u)return a.parentWindow;throw Error("Cannot get a window object for node");},getIframeWindow:function(a){if(typeof a.contentWindow!=u)return a.contentWindow;if(typeof a.contentDocument!=u)return a.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element");},getIframeDocument:function(a){if(typeof a.contentDocument!=u)return a.contentDocument;if(typeof a.contentWindow!=u)return a.contentWindow.document;
throw Error("getIframeWindow: No Document object found for iframe element");},getBody:function(a){return x.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]},getRootContainer:function(a){for(var b;b=a.parentNode;)a=b;return a},comparePoints:function(a,c,m,f){var p;if(a==m)return c===f?0:c<f?-1:1;if(p=e(m,a,!0))return c<=b(p)?-1:1;if(p=e(a,m,!0))return b(p)<f?-1:1;c=d(a,m);a=a===c?c:e(a,c,!0);m=m===c?c:e(m,c,!0);if(a===m)throw Error("comparePoints got to case 4 and childA and childB are the same!");
for(c=c.firstChild;c;){if(c===a)return-1;if(c===m)return 1;c=c.nextSibling}throw Error("Should not be here!");},inspectNode:g,fragmentFromNodeChildren:function(a){for(var b=j(a).createDocumentFragment(),c;c=a.firstChild;)b.appendChild(c);return b},createIterator:function(a){return new v(a)},DomPosition:n};a.DOMException=r});
rangy.createModule("DomRange",function(a){function c(a,b){return 3!=a.nodeType&&(k.isAncestorOf(a,b.startContainer,!0)||k.isAncestorOf(a,b.endContainer,!0))}function b(a){return k.getDocument(a.startContainer)}function d(a,b,c){if(b=a._listeners[b])for(var h=0,d=b.length;h<d;++h)b[h].call(a,{target:a,args:c})}function e(a){return new L(a.parentNode,k.getNodeIndex(a))}function f(a){return new L(a.parentNode,k.getNodeIndex(a)+1)}function l(a,b,c){var h=11==a.nodeType?a.firstChild:a;k.isCharacterDataNode(b)?
c==b.length?k.insertAfter(a,b):b.parentNode.insertBefore(a,0==c?b:k.splitDataNode(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]);return h}function j(a){for(var c,h,d=b(a.range).createDocumentFragment();h=a.next();){c=a.isPartiallySelectedSubtree();h=h.cloneNode(!c);c&&(c=a.getSubtreeIterator(),h.appendChild(j(c)),c.detach(!0));if(10==h.nodeType)throw new D("HIERARCHY_REQUEST_ERR");d.appendChild(h)}return d}function g(a,b,c){var h,d;for(c=c||{stop:!1};h=a.next();)if(a.isPartiallySelectedSubtree())if(!1===
b(h)){c.stop=!0;break}else{if(h=a.getSubtreeIterator(),g(h,b,c),h.detach(!0),c.stop)break}else for(h=k.createIterator(h);d=h.next();)if(!1===b(d)){c.stop=!0;return}}function v(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),v(b),b.detach(!0)):a.remove()}function n(a){for(var c,h=b(a.range).createDocumentFragment(),d;c=a.next();){a.isPartiallySelectedSubtree()?(c=c.cloneNode(!1),d=a.getSubtreeIterator(),c.appendChild(n(d)),d.detach(!0)):a.remove();if(10==c.nodeType)throw new D("HIERARCHY_REQUEST_ERR");
h.appendChild(c)}return h}function r(a,b,c){var h=!(!b||!b.length),d,m=!!c;h&&(d=RegExp("^("+b.join("|")+")$"));var B=[];g(new x(a,!1),function(a){(!h||d.test(a.nodeType))&&(!m||c(a))&&B.push(a)});return B}function u(a){return"["+("undefined"==typeof a.getName?"Range":a.getName())+"("+k.inspectNode(a.startContainer)+":"+a.startOffset+", "+k.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function x(a,b){this.range=a;this.clonePartiallySelectedTextNodes=b;if(!a.collapsed){this.sc=a.startContainer;
this.so=a.startOffset;this.ec=a.endContainer;this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&k.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===c&&!k.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:k.getClosestAncestorIn(this.sc,c,!0),this._last=this.ec===c&&!k.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:k.getClosestAncestorIn(this.ec,c,!0))}}function m(a){this.code=
this[a];this.codeName=a;this.message="RangeException: "+this.codeName}function p(a,b,c){this.nodes=r(a,b,c);this._next=this.nodes[0];this._position=0}function s(a){return function(b,c){for(var h,d=c?b:b.parentNode;d;){h=d.nodeType;if(k.arrayContains(a,h))return d;d=d.parentNode}return null}}function C(a,b){if(P(a,b))throw new m("INVALID_NODE_TYPE_ERR");}function q(a){if(!a.startContainer)throw new D("INVALID_STATE_ERR");}function F(a,b){if(!k.arrayContains(b,a.nodeType))throw new m("INVALID_NODE_TYPE_ERR");
}function K(a,b){if(0>b||b>(k.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new D("INDEX_SIZE_ERR");}function G(a,b){if(M(a,!0)!==M(b,!0))throw new D("WRONG_DOCUMENT_ERR");}function E(a){if(W(a,!0))throw new D("NO_MODIFICATION_ALLOWED_ERR");}function A(a,b){if(!a)throw new D(b);}function w(a){q(a);if(!k.arrayContains(Q,a.startContainer.nodeType)&&!M(a.startContainer,!0)||!k.arrayContains(Q,a.endContainer.nodeType)&&!M(a.endContainer,!0)||!(a.startOffset<=(k.isCharacterDataNode(a.startContainer)?
a.startContainer.length:a.startContainer.childNodes.length))||!(a.endOffset<=(k.isCharacterDataNode(a.endContainer)?a.endContainer.length:a.endContainer.childNodes.length)))throw Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")");}function J(){}function U(a){a.START_TO_START=X;a.START_TO_END=$;a.END_TO_END=ea;a.END_TO_START=aa;a.NODE_BEFORE=ba;a.NODE_AFTER=ca;a.NODE_BEFORE_AND_AFTER=da;a.NODE_INSIDE=Y}function t(a){U(a);U(a.prototype)}function N(a,b){return function(){w(this);
var c=this.startContainer,h=this.startOffset,d=this.commonAncestorContainer,m=new x(this,!0);c!==d&&(c=k.getClosestAncestorIn(c,d,!0),h=f(c),c=h.node,h=h.offset);g(m,E);m.reset();d=a(m);m.detach();b(this,c,h,c,h);return d}}function R(b,h,d){function m(a,b){return function(c){q(this);F(c,H);F(O(c),Q);c=(a?e:f)(c);(b?B:p)(this,c.node,c.offset)}}function B(a,b,c){var d=a.endContainer,y=a.endOffset;if(b!==a.startContainer||c!==a.startOffset){if(O(b)!=O(d)||1==k.comparePoints(b,c,d,y))d=b,y=c;h(a,b,c,
d,y)}}function p(a,b,c){var d=a.startContainer,y=a.startOffset;if(b!==a.endContainer||c!==a.endOffset){if(O(b)!=O(d)||-1==k.comparePoints(b,c,d,y))d=b,y=c;h(a,d,y,b,c)}}b.prototype=new J;a.util.extend(b.prototype,{setStart:function(a,b){q(this);C(a,!0);K(a,b);B(this,a,b)},setEnd:function(a,b){q(this);C(a,!0);K(a,b);p(this,a,b)},setStartBefore:m(!0,!0),setStartAfter:m(!1,!0),setEndBefore:m(!0,!1),setEndAfter:m(!1,!1),collapse:function(a){w(this);a?h(this,this.startContainer,this.startOffset,this.startContainer,
this.startOffset):h(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){q(this);C(a,!0);h(this,a,0,a,k.getNodeLength(a))},selectNode:function(a){q(this);C(a,!1);F(a,H);var b=e(a);a=f(a);h(this,b.node,b.offset,a.node,a.offset)},extractContents:N(n,h),deleteContents:N(v,h),canSurroundContents:function(){w(this);E(this.startContainer);E(this.endContainer);var a=new x(this,!0),b=a._first&&c(a._first,this)||a._last&&c(a._last,this);a.detach();return!b},
detach:function(){d(this)},splitBoundaries:function(){w(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,d=this.endOffset,y=a===c;k.isCharacterDataNode(c)&&0<d&&d<c.length&&k.splitDataNode(c,d);k.isCharacterDataNode(a)&&0<b&&b<a.length&&(a=k.splitDataNode(a,b),y?(d-=b,c=a):c==a.parentNode&&d>=k.getNodeIndex(a)&&d++,b=0);h(this,a,b,c,d)},normalizeBoundaries:function(){w(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,d=this.endOffset,y=function(a){var b=
a.nextSibling;b&&b.nodeType==a.nodeType&&(c=a,d=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},m=function(h){var y=h.previousSibling;if(y&&y.nodeType==h.nodeType){a=h;var m=h.length;b=y.length;h.insertData(0,y.data);y.parentNode.removeChild(y);a==c?(d+=b,c=a):c==h.parentNode&&(y=k.getNodeIndex(h),d==y?(c=h,d=m):d>y&&d--)}},B=!0;k.isCharacterDataNode(c)?c.length==d&&y(c):(0<d&&(B=c.childNodes[d-1])&&k.isCharacterDataNode(B)&&y(B),B=!this.collapsed);B?k.isCharacterDataNode(a)?0==b&&m(a):
b<a.childNodes.length&&(y=a.childNodes[b])&&k.isCharacterDataNode(y)&&m(y):(a=c,b=d);h(this,a,b,c,d)},collapseToPoint:function(a,b){q(this);C(a,!0);K(a,b);(a!==this.startContainer||b!==this.startOffset||a!==this.endContainer||b!==this.endOffset)&&h(this,a,b,a,b)}});t(b)}function V(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;a.commonAncestorContainer=a.collapsed?a.startContainer:k.getCommonAncestor(a.startContainer,a.endContainer)}function S(a,b,c,h,m){var B=a.startContainer!==
b||a.startOffset!==c,e=a.endContainer!==h||a.endOffset!==m;a.startContainer=b;a.startOffset=c;a.endContainer=h;a.endOffset=m;V(a);d(a,"boundarychange",{startMoved:B,endMoved:e})}function z(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};V(this)}a.requireModules(["DomUtil"]);var k=a.dom,L=k.DomPosition,D=a.DOMException;x.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=
null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;a&&(this._next=a!==this._last?a.nextSibling:null,k.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so)));return a},remove:function(){var a=this._current,b,c;k.isCharacterDataNode(a)&&(a===this.sc||a===this.ec)?(b=a===this.sc?this.so:0,c=a===
this.ec?this.eo:a.length,b!=c&&a.deleteData(b,c-b)):a.parentNode&&a.parentNode.removeChild(a)},isPartiallySelectedSubtree:function(){return c(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new z(b(this.range));var c=this._current,h=c,d=0,m=c,B=k.getNodeLength(c);k.isAncestorOf(c,this.sc,!0)&&(h=this.sc,d=this.so);k.isAncestorOf(c,this.ec,!0)&&(m=this.ec,B=this.eo);S(a,h,d,m,B)}return new x(a,this.clonePartiallySelectedTextNodes)},
detach:function(a){a&&this.range.detach();this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};m.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};m.prototype.toString=function(){return this.message};p.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var H=[1,3,4,5,
7,8,10],Q=[2,9,11],I=[1,3,4,5,7,8,10,11],T=[1,3,4,5,7,8],O=k.getRootContainer,M=s([9,11]),W=s([5,6,10,12]),P=s([6,10,12]),h=document.createElement("style"),B=!1;try{h.innerHTML="<b>x</b>",B=3==h.firstChild.nodeType}catch(fa){}a.features.htmlParsingConforms=B;var Z="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),X=0,$=1,ea=2,aa=3,ba=0,ca=1,da=2,Y=3;J.prototype={attachListener:function(a,b){this._listeners[a].push(b)},compareBoundaryPoints:function(a,
b){w(this);G(this.startContainer,b.startContainer);var c=a==aa||a==X?"start":"end",h=a==$||a==X?"start":"end";return k.comparePoints(this[c+"Container"],this[c+"Offset"],b[h+"Container"],b[h+"Offset"])},insertNode:function(a){w(this);F(a,I);E(this.startContainer);if(k.isAncestorOf(a,this.startContainer,!0))throw new D("HIERARCHY_REQUEST_ERR");a=l(a,this.startContainer,this.startOffset);this.setStartBefore(a)},cloneContents:function(){w(this);var a,c;if(this.collapsed)return b(this).createDocumentFragment();
if(this.startContainer===this.endContainer&&k.isCharacterDataNode(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),c=b(this).createDocumentFragment(),c.appendChild(a),c;c=new x(this,!0);a=j(c);c.detach();return a},canSurroundContents:function(){w(this);E(this.startContainer);E(this.endContainer);var a=new x(this,!0),b=a._first&&c(a._first,this)||a._last&&c(a._last,this);a.detach();return!b},surroundContents:function(a){F(a,T);if(!this.canSurroundContents())throw new m("BAD_BOUNDARYPOINTS_ERR");
var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);l(a,this.startContainer,this.startOffset);a.appendChild(b);this.selectNode(a)},cloneRange:function(){w(this);for(var a=new z(b(this)),c=Z.length,h;c--;)h=Z[c],a[h]=this[h];return a},toString:function(){w(this);var a=this.startContainer;if(a===this.endContainer&&k.isCharacterDataNode(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[],a=new x(this,!0);g(a,function(a){(3==
a.nodeType||4==a.nodeType)&&b.push(a.data)});a.detach();return b.join("")},compareNode:function(a){w(this);var b=a.parentNode,c=k.getNodeIndex(a);if(!b)throw new D("NOT_FOUND_ERR");a=this.comparePoint(b,c);b=this.comparePoint(b,c+1);return 0>a?0<b?da:ba:0<b?ca:Y},comparePoint:function(a,b){w(this);A(a,"HIERARCHY_REQUEST_ERR");G(a,this.startContainer);return 0>k.comparePoints(a,b,this.startContainer,this.startOffset)?-1:0<k.comparePoints(a,b,this.endContainer,this.endOffset)?1:0},createContextualFragment:B?
function(a){var b=this.startContainer,c=k.getDocument(b);if(!b)throw new D("INVALID_STATE_ERR");var h=null;1==b.nodeType?h=b:k.isCharacterDataNode(b)&&(h=k.parentElement(b));h=null===h||"HTML"==h.nodeName&&k.isHtmlNamespace(k.getDocument(h).documentElement)&&k.isHtmlNamespace(h)?c.createElement("body"):h.cloneNode(!1);h.innerHTML=a;return k.fragmentFromNodeChildren(h)}:function(a){q(this);var c=b(this).createElement("body");c.innerHTML=a;return k.fragmentFromNodeChildren(c)},toHtml:function(){w(this);
var a=b(this).createElement("div");a.appendChild(this.cloneContents());return a.innerHTML},intersectsNode:function(a,c){w(this);A(a,"NOT_FOUND_ERR");if(k.getDocument(a)!==b(this))return!1;var h=a.parentNode,d=k.getNodeIndex(a);A(h,"NOT_FOUND_ERR");var m=k.comparePoints(h,d,this.endContainer,this.endOffset),h=k.comparePoints(h,d+1,this.startContainer,this.startOffset);return c?0>=m&&0<=h:0>m&&0<h},isPointInRange:function(a,b){w(this);A(a,"HIERARCHY_REQUEST_ERR");G(a,this.startContainer);return 0<=
k.comparePoints(a,b,this.startContainer,this.startOffset)&&0>=k.comparePoints(a,b,this.endContainer,this.endOffset)},intersectsRange:function(a,c){w(this);if(b(a)!=b(this))throw new D("WRONG_DOCUMENT_ERR");var h=k.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),d=k.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);return c?0>=h&&0<=d:0>h&&0<d},intersection:function(a){if(this.intersectsRange(a)){var b=k.comparePoints(this.startContainer,
this.startOffset,a.startContainer,a.startOffset),c=k.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),h=this.cloneRange();-1==b&&h.setStart(a.startContainer,a.startOffset);1==c&&h.setEnd(a.endContainer,a.endOffset);return h}return null},union:function(a){if(this.intersectsRange(a,!0)){var b=this.cloneRange();-1==k.comparePoints(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset);1==k.comparePoints(a.endContainer,
a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset);return b}throw new m("Ranges do not intersect");},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==Y},containsNodeContents:function(a){return 0<=this.comparePoint(a,0)&&0>=this.comparePoint(a,k.getNodeLength(a))},containsRange:function(a){return this.intersection(a).equals(a)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);return 0<c.length?
(b.setStart(c[0],0),a=c.pop(),b.setEnd(a,a.length),a=this.containsRange(b),b.detach(),a):this.containsNodeContents(a)},createNodeIterator:function(a,b){w(this);return new p(this,a,b)},getNodes:function(a,b){w(this);return r(this,a,b)},getDocument:function(){return b(this)},collapseBefore:function(a){q(this);this.setEndBefore(a);this.collapse(!1)},collapseAfter:function(a){q(this);this.setStartAfter(a);this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return z.rangesEqual(this,
a)},inspect:function(){return u(this)}};R(z,S,function(a){q(a);a.startContainer=a.startOffset=a.endContainer=a.endOffset=null;a.collapsed=a.commonAncestorContainer=null;d(a,"detach",null);a._listeners=null});a.rangePrototype=J.prototype;z.rangeProperties=Z;z.RangeIterator=x;z.copyComparisonConstants=t;z.createPrototypeRange=R;z.inspect=u;z.getRangeDocument=b;z.rangesEqual=function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===
b.endOffset};a.DomRange=z;a.RangeException=m});
rangy.createModule("WrappedRange",function(a){function c(a,b,c,d){var j=a.duplicate();j.collapse(c);var g=j.parentElement();e.isAncestorOf(b,g,!0)||(g=b);if(!g.canHaveHTML)return new f(g.parentNode,e.getNodeIndex(g));b=e.getDocument(g).createElement("span");var l,n=c?"StartToStart":"StartToEnd";do g.insertBefore(b,b.previousSibling),j.moveToElementText(b);while(0<(l=j.compareEndPoints(n,a))&&b.previousSibling);n=b.nextSibling;if(-1==l&&n&&e.isCharacterDataNode(n)){j.setEndPoint(c?"EndToStart":"EndToEnd",
a);if(/[\r\n]/.test(n.data)){g=j.duplicate();c=g.text.replace(/\r\n/g,"\r").length;for(c=g.moveStart("character",c);-1==g.compareEndPoints("StartToEnd",g);)c++,g.moveStart("character",1)}else c=j.text.length;g=new f(n,c)}else n=(d||!c)&&b.previousSibling,g=(c=(d||c)&&b.nextSibling)&&e.isCharacterDataNode(c)?new f(c,0):n&&e.isCharacterDataNode(n)?new f(n,n.length):new f(g,e.getNodeIndex(b));b.parentNode.removeChild(b);return g}function b(a,b){var c,d,f=a.offset,j=e.getDocument(a.node),g=j.body.createTextRange(),
l=e.isCharacterDataNode(a.node);l?(c=a.node,d=c.parentNode):(c=a.node.childNodes,c=f<c.length?c[f]:null,d=a.node);j=j.createElement("span");j.innerHTML="&#feff;";c?d.insertBefore(j,c):d.appendChild(j);g.moveToElementText(j);g.collapse(!b);d.removeChild(j);if(l)g[b?"moveStart":"moveEnd"]("character",f);return g}a.requireModules(["DomUtil","DomRange"]);var d,e=a.dom,f=e.DomPosition,l=a.DomRange;if(a.features.implementsDomRange&&(!a.features.implementsTextRange||!a.config.preferTextRange)){var j=function(a){for(var b=
v.length,c;b--;)c=v[b],a[c]=a.nativeRange[c]},g,v=l.rangeProperties,n;d=function(a){if(!a)throw Error("Range must be specified");this.nativeRange=a;j(this)};l.createPrototypeRange(d,function(a,b,c,d,e){var f=a.endContainer!==d||a.endOffset!=e;if(a.startContainer!==b||a.startOffset!=c||f)a.setEnd(d,e),a.setStart(b,c)},function(a){a.nativeRange.detach();a.detached=!0;for(var b=v.length,c;b--;)c=v[b],a[c]=null});g=d.prototype;g.selectNode=function(a){this.nativeRange.selectNode(a);j(this)};g.deleteContents=
function(){this.nativeRange.deleteContents();j(this)};g.extractContents=function(){var a=this.nativeRange.extractContents();j(this);return a};g.cloneContents=function(){return this.nativeRange.cloneContents()};g.surroundContents=function(a){this.nativeRange.surroundContents(a);j(this)};g.collapse=function(a){this.nativeRange.collapse(a);j(this)};g.cloneRange=function(){return new d(this.nativeRange.cloneRange())};g.refresh=function(){j(this)};g.toString=function(){return this.nativeRange.toString()};
var r=document.createTextNode("test");e.getBody(document).appendChild(r);var u=document.createRange();u.setStart(r,0);u.setEnd(r,0);try{u.setStart(r,1),g.setStart=function(a,b){this.nativeRange.setStart(a,b);j(this)},g.setEnd=function(a,b){this.nativeRange.setEnd(a,b);j(this)},n=function(a){return function(b){this.nativeRange[a](b);j(this)}}}catch(x){g.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(c){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}j(this)},g.setEnd=function(a,
b){try{this.nativeRange.setEnd(a,b)}catch(c){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}j(this)},n=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(d){this.nativeRange[b](c),this.nativeRange[a](c)}j(this)}}}g.setStartBefore=n("setStartBefore","setEndBefore");g.setStartAfter=n("setStartAfter","setEndAfter");g.setEndBefore=n("setEndBefore","setStartBefore");g.setEndAfter=n("setEndAfter","setStartAfter");u.selectNodeContents(r);g.selectNodeContents=u.startContainer==
r&&u.endContainer==r&&0==u.startOffset&&u.endOffset==r.length?function(a){this.nativeRange.selectNodeContents(a);j(this)}:function(a){this.setStart(a,0);this.setEnd(a,l.getEndOffset(a))};u.selectNodeContents(r);u.setEnd(r,3);n=document.createRange();n.selectNodeContents(r);n.setEnd(r,4);n.setStart(r,2);g.compareBoundaryPoints=-1==u.compareBoundaryPoints(u.START_TO_END,n)&1==u.compareBoundaryPoints(u.END_TO_START,n)?function(a,b){b=b.nativeRange||b;a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&
(a=b.START_TO_END);return this.nativeRange.compareBoundaryPoints(a,b)}:function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};a.util.isHostMethod(u,"createContextualFragment")&&(g.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)});e.getBody(document).removeChild(r);u.detach();n.detach();a.createNativeRange=function(a){a=a||document;return a.createRange()}}else a.features.implementsTextRange&&(d=function(a){this.textRange=a;this.refresh()},
d.prototype=new l(document),d.prototype.refresh=function(){var a,b,d=this.textRange;a=d.parentElement();var f=d.duplicate();f.collapse(!0);b=f.parentElement();f=d.duplicate();f.collapse(!1);d=f.parentElement();b=b==d?b:e.getCommonAncestor(b,d);b=b==a?b:e.getCommonAncestor(a,b);0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?b=a=c(this.textRange,b,!0,!0):(a=c(this.textRange,b,!0,!1),b=c(this.textRange,b,!1,!1));this.setStart(a.node,a.offset);this.setEnd(b.node,b.offset)},l.copyComparisonConstants(d),
g=function(){return this}(),"undefined"==typeof g.Range&&(g.Range=d),a.createNativeRange=function(a){a=a||document;return a.body.createTextRange()});a.features.implementsTextRange&&(d.rangeToTextRange=function(a){if(a.collapsed)return b(new f(a.startContainer,a.startOffset),!0);var c=b(new f(a.startContainer,a.startOffset),!0),d=b(new f(a.endContainer,a.endOffset),!1);a=e.getDocument(a.startContainer).body.createTextRange();a.setEndPoint("StartToStart",c);a.setEndPoint("EndToEnd",d);return a});d.prototype.getName=
function(){return"WrappedRange"};a.WrappedRange=d;a.createRange=function(b){b=b||document;return new d(a.createNativeRange(b))};a.createRangyRange=function(a){a=a||document;return new l(a)};a.createIframeRange=function(b){return a.createRange(e.getIframeDocument(b))};a.createIframeRangyRange=function(b){return a.createRangyRange(e.getIframeDocument(b))};a.addCreateMissingNativeApiListener(function(b){b=b.document;"undefined"==typeof b.createRange&&(b.createRange=function(){return a.createRange(this)});
b=b=null})});
rangy.createModule("WrappedSelection",function(a,c){function b(a){return(a||window).getSelection()}function d(a){return(a||window).document.selection}function e(a,b,c){var d=c?"end":"start";c=c?"start":"end";a.anchorNode=b[d+"Container"];a.anchorOffset=b[d+"Offset"];a.focusNode=b[c+"Container"];a.focusOffset=b[c+"Offset"]}function f(a){a.anchorNode=a.focusNode=null;a.anchorOffset=a.focusOffset=0;a.rangeCount=0;a.isCollapsed=!0;a._ranges.length=0}function l(b){var c;b instanceof C?(c=b._selectionNativeRange,
c||(c=a.createNativeRange(p.getDocument(b.startContainer)),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset),b._selectionNativeRange=c,b.attachListener("detach",function(){this._selectionNativeRange=null}))):b instanceof q?c=b.nativeRange:a.features.implementsDomRange&&b instanceof p.getWindow(b.startContainer).Range&&(c=b);return c}function j(a){var b=a.getNodes(),c;a:if(!b.length||1!=b[0].nodeType)c=!1;else{c=1;for(var d=b.length;c<d;++c)if(!p.isAncestorOf(b[0],b[c])){c=
!1;break a}c=!0}if(!c)throw Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return b[0]}function g(a,b){var c=new q(b);a._ranges=[c];e(a,c,!1);a.rangeCount=1;a.isCollapsed=c.collapsed}function v(b){b._ranges.length=0;if("None"==b.docSelection.type)f(b);else{var c=b.docSelection.createRange();if(c&&"undefined"!=typeof c.text)g(b,c);else{b.rangeCount=c.length;for(var d,j=p.getDocument(c.item(0)),l=0;l<b.rangeCount;++l)d=a.createRange(j),d.selectNode(c.item(l)),
b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed;e(b,b._ranges[b.rangeCount-1],!1)}}}function n(a,b){for(var c=a.docSelection.createRange(),d=j(b),f=p.getDocument(c.item(0)),f=p.getBody(f).createControlRange(),e=0,g=c.length;e<g;++e)f.add(c.item(e));try{f.add(d)}catch(l){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}f.select();v(a)}function r(a,b,c){this.nativeSelection=a;this.docSelection=b;this._ranges=
[];this.win=c;this.refresh()}function u(a,b){for(var c=p.getDocument(b[0].startContainer),c=p.getBody(c).createControlRange(),d=0,f;d<rangeCount;++d){f=j(b[d]);try{c.add(f)}catch(e){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}c.select();v(a)}function x(a,b){if(a.anchorNode&&p.getDocument(a.anchorNode)!==p.getDocument(b))throw new F("WRONG_DOCUMENT_ERR");}function m(a){var b=[],c=new K(a.anchorNode,a.anchorOffset),
d=new K(a.focusNode,a.focusOffset),f="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var e=0,j=a.rangeCount;e<j;++e)b[e]=C.inspect(a.getRangeAt(e));return"["+f+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.requireModules(["DomUtil","DomRange","WrappedRange"]);a.config.checkSelectionRanges=!0;var p=a.dom,s=a.util,C=a.DomRange,q=a.WrappedRange,F=a.DOMException,K=p.DomPosition,G,E,A=a.util.isHostMethod(window,"getSelection"),
w=a.util.isHostObject(document,"selection"),J=w&&(!A||a.config.preferTextRange);J?(G=d,a.isSelectionValid=function(a){a=(a||window).document;var b=a.selection;return"None"!=b.type||p.getDocument(b.createRange().parentElement())==a}):A?(G=b,a.isSelectionValid=function(){return!0}):c.fail("Neither document.selection or window.getSelection() detected.");a.getNativeSelection=G;var A=G(),U=a.createNativeRange(document),t=p.getBody(document),N=s.areHostObjects(A,s.areHostProperties(A,["anchorOffset","focusOffset"]));
a.features.selectionHasAnchorAndFocus=N;var R=s.isHostMethod(A,"extend");a.features.selectionHasExtend=R;var V="number"==typeof A.rangeCount;a.features.selectionHasRangeCount=V;var S=!1,z=!0;if(s.areHostMethods(A,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof A.rangeCount&&a.features.implementsDomRange){var k=document.createElement("iframe");t.appendChild(k);z=p.getIframeDocument(k);z.open();z.write("<html><head></head><body>12</body></html>");z.close();var L=p.getIframeWindow(k).getSelection(),
D=z.documentElement.lastChild.firstChild,H=z.createRange();H.setStart(D,1);H.collapse(!0);L.addRange(H);z=1==L.rangeCount;L.removeAllRanges();var Q=H.cloneRange();H.setStart(D,0);Q.setEnd(D,2);L.addRange(H);L.addRange(Q);S=2==L.rangeCount;H.detach();Q.detach();t.removeChild(k)}a.features.selectionSupportsMultipleRanges=S;a.features.collapsedNonEditableSelectionsSupported=z;var I=!1;t&&s.isHostMethod(t,"createControlRange")&&(t=t.createControlRange(),s.areHostProperties(t,["item","add"])&&(I=!0));
a.features.implementsControlRange=I;E=N?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var T;s.isHostMethod(A,"getRangeAt")?T=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:N&&(T=function(b){var c=p.getDocument(b.anchorNode),c=a.createRange(c);c.setStart(b.anchorNode,b.anchorOffset);c.setEnd(b.focusNode,b.focusOffset);c.collapsed!==this.isCollapsed&&(c.setStart(b.focusNode,b.focusOffset),
c.setEnd(b.anchorNode,b.anchorOffset));return c});a.getSelection=function(a){a=a||window;var b=a._rangySelection,c=G(a),f=w?d(a):null;b?(b.nativeSelection=c,b.docSelection=f,b.refresh(a)):(b=new r(c,f,a),a._rangySelection=b);return b};a.getIframeSelection=function(b){return a.getSelection(p.getIframeWindow(b))};t=r.prototype;if(!J&&N&&s.areHostMethods(A,["removeAllRanges","addRange"])){t.removeAllRanges=function(){this.nativeSelection.removeAllRanges();f(this)};var O=function(b,c){var d=C.getRangeDocument(c),
d=a.createRange(d);d.collapseToPoint(c.endContainer,c.endOffset);b.nativeSelection.addRange(l(d));b.nativeSelection.extend(c.startContainer,c.startOffset);b.refresh()};t.addRange=V?function(b,c){if(I&&w&&"Control"==this.docSelection.type)n(this,b);else if(c&&R)O(this,b);else{var d;S?d=this.rangeCount:(this.removeAllRanges(),d=0);this.nativeSelection.addRange(l(b));this.rangeCount=this.nativeSelection.rangeCount;this.rangeCount==d+1?(a.config.checkSelectionRanges&&(d=T(this.nativeSelection,this.rangeCount-
1))&&!C.rangesEqual(d,b)&&(b=new q(d)),this._ranges[this.rangeCount-1]=b,e(this,b,P(this.nativeSelection)),this.isCollapsed=E(this)):this.refresh()}}:function(a,b){b&&R?O(this,a):(this.nativeSelection.addRange(l(a)),this.refresh())};t.setRanges=function(a){if(I&&1<a.length)u(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}}}else if(s.isHostMethod(A,"empty")&&s.isHostMethod(U,"select")&&I&&J)t.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=
this.docSelection.type){var a;if(this.anchorNode)a=p.getDocument(this.anchorNode);else if("Control"==this.docSelection.type){var b=this.docSelection.createRange();b.length&&(a=p.getDocument(b.item(0)).body.createTextRange())}a&&(a.body.createTextRange().select(),this.docSelection.empty())}}catch(c){}f(this)},t.addRange=function(a){"Control"==this.docSelection.type?n(this,a):(q.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,e(this,a,!1))},
t.setRanges=function(a){this.removeAllRanges();var b=a.length;1<b?u(this,a):b&&this.addRange(a[0])};else return c.fail("No means of selecting a Range or TextRange was found"),!1;t.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new F("INDEX_SIZE_ERR");return this._ranges[a]};var M;if(J)M=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=p.getBody(b.win.document).createTextRange(),c.collapse(!0));"Control"==b.docSelection.type?v(b):c&&"undefined"!=typeof c.text?
g(b,c):f(b)};else if(s.isHostMethod(A,"getRangeAt")&&"number"==typeof A.rangeCount)M=function(b){if(I&&w&&"Control"==b.docSelection.type)v(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;c<d;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));e(b,b._ranges[b.rangeCount-1],P(b.nativeSelection));b.isCollapsed=E(b)}else f(b)};else if(N&&"boolean"==typeof A.isCollapsed&&"boolean"==typeof U.collapsed&&a.features.implementsDomRange)M=
function(a){var b;b=a.nativeSelection;b.anchorNode?(b=T(b,0),a._ranges=[b],a.rangeCount=1,b=a.nativeSelection,a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset,a.isCollapsed=E(a)):f(a)};else return c.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;t.refresh=function(a){var b=a?this._ranges.slice(0):null;M(this);if(a){a=b.length;if(a!=this._ranges.length)return!1;for(;a--;)if(!C.rangesEqual(b[a],this._ranges[a]))return!1;
return!0}};var W=function(a,b){var c=a.getAllRanges(),d=!1;a.removeAllRanges();for(var e=0,j=c.length;e<j;++e)d||b!==c[e]?a.addRange(c[e]):d=!0;a.rangeCount||f(a)};t.removeRange=I?function(a){if("Control"==this.docSelection.type){var b=this.docSelection.createRange();a=j(a);for(var c=p.getDocument(b.item(0)),c=p.getBody(c).createControlRange(),d,f=!1,e=0,g=b.length;e<g;++e)d=b.item(e),d!==a||f?c.add(b.item(e)):f=!0;c.select();v(this)}else W(this,a)}:function(a){W(this,a)};var P;!J&&N&&a.features.implementsDomRange?
(P=function(a){var b=!1;a.anchorNode&&(b=1==p.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset));return b},t.isBackwards=function(){return P(this)}):P=t.isBackwards=function(){return!1};t.toString=function(){for(var a=[],b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")};t.collapse=function(b,c){x(this,b);var d=a.createRange(p.getDocument(b));d.collapseToPoint(b,c);this.removeAllRanges();this.addRange(d);this.isCollapsed=!0};t.collapseToStart=function(){if(this.rangeCount){var a=
this._ranges[0];this.collapse(a.startContainer,a.startOffset)}else throw new F("INVALID_STATE_ERR");};t.collapseToEnd=function(){if(this.rangeCount){var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)}else throw new F("INVALID_STATE_ERR");};t.selectAllChildren=function(b){x(this,b);var c=a.createRange(p.getDocument(b));c.selectNodeContents(b);this.removeAllRanges();this.addRange(c)};t.deleteFromDocument=function(){if(I&&w&&"Control"==this.docSelection.type){for(var a=this.docSelection.createRange(),
b;a.length;)b=a.item(0),a.remove(b),b.parentNode.removeChild(b);this.refresh()}else if(this.rangeCount){a=this.getAllRanges();this.removeAllRanges();b=0;for(var c=a.length;b<c;++b)a[b].deleteContents();this.addRange(a[c-1])}};t.getAllRanges=function(){return this._ranges.slice(0)};t.setSingleRange=function(a){this.setRanges([a])};t.containsNode=function(a,b){for(var c=0,d=this._ranges.length;c<d;++c)if(this._ranges[c].containsNode(a,b))return!0;return!1};t.toHtml=function(){var a="";if(this.rangeCount){for(var a=
C.getRangeDocument(this._ranges[0]).createElement("div"),b=0,c=this._ranges.length;b<c;++b)a.appendChild(this._ranges[b].cloneContents());a=a.innerHTML}return a};t.getName=function(){return"WrappedSelection"};t.inspect=function(){return m(this)};t.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null};r.inspect=m;a.Selection=r;a.selectionPrototype=t;a.addCreateMissingNativeApiListener(function(b){"undefined"==typeof b.getSelection&&(b.getSelection=function(){return a.getSelection(this)});
b=null})});
workpad.browser=function(){var a=navigator.userAgent,c=document.createElement("div"),b=-1!==a.indexOf("MSIE")&&-1===a.indexOf("Opera"),d=-1!==a.indexOf("Gecko")&&-1===a.indexOf("KHTML"),e=-1!==a.indexOf("AppleWebKit/");a.indexOf("Chrome/");a.indexOf("Opera/");var f={formatBlock:b,insertUnorderedList:b||e,insertOrderedList:b||e},l={insertHTML:d};return{USER_AGENT:a,supported:function(){var a=this.USER_AGENT.toLowerCase(),b="contentEditable"in c,d=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,
e=document.querySelector&&document.querySelectorAll,a=this.isIos()&&5>+(/ipad|iphone|ipod/.test(a)&&a.match(/ os (\d+).+? like mac os x/)||[,0])[1]||this.isAndroid()&&4>+(a.match(/android (\d+)/)||[,0])[1]||-1!==a.indexOf("opera mobi")||-1!==a.indexOf("hpwos/");return b&&d&&e&&!a},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},isTouchDevice:function(){return this.supportEvent("touchmove")},supportEvent:function(a){var b;
if(!(b="on"+a in c))c.setAttribute("on"+a,"return;"),b="function"===typeof c["on"+a];return b},supportsCommand:function(a,b){if(!f[b]){try{return a.queryCommandSupported(b)}catch(c){}try{return a.queryCommandEnabled(b)}catch(d){return!!l[b]}}return!1}}}();
(function(a){var c=["debug","info","warn","error"];a.util.debug=function(){var b=Array.prototype.slice.call(arguments),d=function(b,d,l){var j=c.indexOf(l),g=c.indexOf("debug");b=a.util.array(b).clone();b.unshift(console,d);return-1<j&&-1<g&&j>=g?console[l]?Function.prototype.bind.apply(console[l],b):Function.prototype.bind.apply(console.log,b):a.EMPTY_FUNCTION};return{error:d(b,"[WorkPad Error!!!]: ","error"),debug:d(b,"[WorkPad Debug]: ","debug"),info:d(b,"[WorkPad Info]: ","info"),warn:d(b,"[Workpad Warn!]: ",
"warn")}}})(workpad);
(function(){workpad.util.array=function(a){return{contains:function(c){if(a.indexOf)return-1!==a.indexOf(c);for(var b=0,d=a.length;b<d;b++)if(a[b]===c)return!0;return!1},without:function(c){c=workpad.util.array(c);for(var b=[],d=0,e=a.length;d<e;d++)c.contains(a[d])||b.push(a[d]);return b},get:function(){for(var c=0,b=a.length,d=[];c<b;c++)d.push(a[c]);return d},unique:function(){for(var c=[],b=0,d=a.length;b<d;b++)workpad.util.array(c).contains(a[b])||c.push(a[b]);return c},clone:function(){for(var c=
[],b=0,d=a.length;b<d;b++)c.push(a[b]);return c}}}})();(function(){var a=/^\s+/,c=/\s+$/;workpad.util.string=function(b){b=String(b);return{trim:function(){return b.replace(a,"").replace(c,"")},interpolate:function(a){for(var c in a)b=this.replace("#{"+c+"}").by(a[c]);return b},replace:function(a){return{by:function(c){return b.split(a).join(c)}}}}}})();
(function(){workpad.util.object=function(a){return{merge:function(c){for(var b in c)a[b]=c[b];return this},get:function(){return a},clone:function(){var c={},b;for(b in a)c[b]=a[b];return c},isArray:function(){return"[object Array]"===Object.prototype.toString.call(a)},safeJSON:function(){try{var c=JSON.parse(JSON.stringify(a))}catch(b){c={}}return c}}}})();
workpad.util.Events=Base.extend({on:function(a,c){this.events=this.events||{};this.events[a]=this.events[a]||[];this.events[a].push(c);return this},off:function(a,c){this.events=this.events||{};var b=0,d,e;if(a){d=this.events[a]||[];for(e=[];b<d.length;b++)d[b]!==c&&c&&e.push(d[b]);this.events[a]=e}else this.events={};return this},fire:function(a,c){this.events=this.events||{};for(var b=this.events[a]||[],d=0;d<b.length;d++)b[d].call(this,c);return this}});
workpad.data.predata=function(){return{EMPTY_DATA:[{content:"Begin to edit your workpad",description:"",id:"00000000-0000-0000-0000-000000000000",collapsed:!0,children:[]}]}}();workpad.data.check=function(a){return{isObject:function(){return"object"===typeof a&&"[object object]"===Object.prototype.toString.call(a).toLowerCase()&&!a.length}}};
(function(a){var c=a.util;a.data.pretty=function(b){return{get:function(){if(c.object(b).isArray()){for(var d=[],e=b.length,f=0;f<e;f++)if(a.data.check(b[f]).isObject())try{var l=JSON.stringify(b[f]);"{}"!==l&&d.push(JSON.parse(l))}catch(j){}1>d.length&&(d=a.data.predata.EMPTY_DATA);return d}return a.data.predata.EMPTY_DATA}}}})(workpad);
(function(a){var c=a.dom;c.addClass=function(a,d){var e=a.classList;if(e)return e.add(d);c.hasClass(a,d)||(a.className+=" "+d)};c.removeClass=function(a,c){var e=a.classList;if(e)return e.remove(c);a.className=a.className.replace(RegExp("(^|\\s+)"+c+"(\\s+|$)")," ")};c.hasClass=function(a,c){var e=a.classList;if(e)return e.contains(c);e=a.className;return 0<e.length&&(e==c||RegExp("(^|\\s)"+c+"(\\s|$)").test(e))}})(workpad);
(function(){var a={className:"class"};workpad.dom.setAttributes=function(c){return{on:function(b){for(var d in c)b.setAttribute(a[d]||d,c[d])}}};workpad.dom.getAttribute=function(a){return{from:function(b){return b.getAttribute(a)}}}})();
workpad.dom.style=function(a){var c=workpad.dom,b={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},d=/\-[a-z]/g,e=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"];return{setto:function(b){b=b.style;if("string"===typeof a)b.cssText+=";"+a;else{a=workpad.util.object(a).safeJSON();for(var c in a)"float"===c?(b.cssFloat=a[c],b.styleFloat=a[c]):b[c]=a[c]}},getfrom:function(c){if(c.nodeType===workpad.ELEMENT_NODE){var e=c.ownerDocument,j=a,g=b[a]||
a.replace(d,function(a){return a.charAt(1).toUpperCase()}),v=c.style,n=c.currentStyle,r=v[g];if(r)return r;if(n)try{return n[g]}catch(u){}var g=e.defaultView||e.parentWindow,e=("height"===j||"width"===j)&&"TEXTAREA"===c.nodeName,x;if(g.getComputedStyle)return e&&(x=v.overflow,v.overflow="hidden"),c=g.getComputedStyle(c,null).getPropertyValue(j),e&&(v.overflow=x||""),c}},getNumberFrom:function(b){var c=this.getfrom(b),c=c?c.replace("px",""):0,c=parseFloat(c);return isNaN(c)?(workpad.util.debug("can't return a number about "+
a+" from ",b).error(),0):c},copyfrom:function(b){var d=a,j;a:{j=0;for(var g=e.length;j<g;j++)if("border-box"===c.style(e[j]).getfrom(b)){j=e[j];break a}j=void 0}(j=j?parseInt(c.style("width").getfrom(b),10)<b.offsetWidth:!1)&&(d=workpad.util.array(d).without(e));var v="";j=d.length;for(var g=0,n;g<j;g++)n=d[g],v+=n+":"+c.style(n).getfrom(b)+";";return{to:function(a){c.style(v).setto(a);return{andTo:arguments.callee}}}}}};
(function(a){a.dom.offset=function(c){var b=a.dom;return{get:function(){var a=c&&c.ownerDocument,b={top:0,left:0},f;if(a)return f=a.documentElement,"undefined"!==typeof c.getBoundingClientRect&&(b=c.getBoundingClientRect()),a=null!=a&&a===a.window?a:9===a.nodeType&&a.defaultView,{top:b.top+a.pageYOffset-f.clientTop,left:b.left+a.pageXOffset-f.clientLeft,width:b.width,height:b.height}},set:function(a){var e,f,l,j=b.style("position").getfrom(c),g={};"static"===j&&(c.style.position="relative");l=b.offset(c).get();
f=b.style("top").getfrom(c);e=b.style("left").getfrom(c);("absolute"===j||"fixed"===j)&&-1<(f+e).indexOf("auto")?(e=b.offset(c).position(),f=e.top,e=e.left):(f=parseFloat(f)||0,e=parseFloat(e)||0);null!=a.top&&(g.top=a.top-l.top+f+"px");null!=a.left&&(g.left=a.left-l.left+e+"px");null!=a.width&&(g.width=a.width+"px");null!=a.height&&(g.height=a.height+"px");b.style(g).setto(c)},offsetParent:function(){for(var a=c.offsetParent||document.documentElement;a&&!(a.nodeName&&"html"===a.nodeName.toLowerCase())&&
"static"===b.style("position").getfrom(a);)a=a.offsetParent;return a||document.documentElement},position:function(){if(c){var a,e,f={top:0,left:0};"fixed"===b.style("position").getfrom(c)?e=c.getBoundingClientRect():(a=b.offset(c).offsetParent(),e=b.offset(c).get(),a.nodeName&&"html"===a.nodeName.toLowerCase()||(f=b.offset(a).get()),f.top+=b.style("borderTopWidth").getNumberFrom(a),f.left+=b.style("borderLeftWidth").getNumberFrom(a));return{top:e.top-f.top-b.style("marginTop").getNumberFrom(a),left:e.left-
f.left-b.style("marginLeft").getNumberFrom(a)}}}}}})(workpad);workpad.dom.insert=function(a){return{after:function(c){c.parentNode.insertBefore(a,c.nextSibling)},before:function(c){c.parentNode.insertBefore(a,c)},into:function(c){c.appendChild(a)}}};
workpad.dom.observe=function(a,c,b){c="string"===typeof c?[c]:c;for(var d,e,f=0,l=c.length;f<l;f++)e=c[f],a.addEventListener?a.addEventListener(e,b,!1):(d=function(c){"target"in c||(c.target=c.srcElement);c.preventDefault=c.preventDefault||function(){this.returnValue=!1};c.stopPropagation=c.stopPropagation||function(){this.cancelBubble=!0};b.call(a,c)},a.attachEvent("on"+e,d));return{stop:function(){for(var e,f=0,l=c.length;f<l;f++)e=c[f],a.removeEventListener?a.removeEventListener(e,b,!1):a.detachEvent("on"+
e,d)}}};(function(a){a.dom.delegate=function(c,b,d,e){return a.dom.observe(c,d,function(d){for(var l=d.target,j=a.util.array(c.querySelectorAll(b));l&&l!==c;){if(j.contains(l)){e.call(l,d);break}l=l.parentNode}})}})(workpad);
workpad.dom.getParentElement=function(){function a(a,b){return!b||!b.length?!0:"string"===typeof b?a===b:workpad.util.array(b).contains(a)}return function(c,b,d){d=d||70;if(b.className||b.classRegExp){a:{var e=b.nodeName,f=b.className;for(b=b.classRegExp;d--&&c&&"BODY"!==c.nodeName;){var l;if(l=c.nodeType===workpad.ELEMENT_NODE)if(l=a(c.nodeName,e)){l=f;var j=b,j=j||l,j=(c.className||"").match(j)||[];l=!l?!!j.length:j[j.length-1]===l}if(l)break a;c=c.parentNode}c=null}return c}a:{e=b.nodeName;for(f=
d;f--&&c&&"BODY"!==c.nodeName;){if(a(c.nodeName,e))break a;c=c.parentNode}c=null}return c}}();
(function(a){var c=document;a.dom.editArea=Base.extend({constructor:function(b,c){var e=this;this.callback=b||a.EMPTY_FUNCTION;this.config=a.util.object({}).merge(c).get();this.editArea=this._createTextArea();setTimeout(function(){e.callback(e)},0)},insertInto:function(a){"string"===typeof a&&(a=c.getElementById(a));a.appendChild(this.editArea)},getEditArea:function(){return this.editArea},getRealNode:function(){return this.editArea.getElementsByTagName("textarea")[0]},setContent:function(a){this.editArea.getElementsByTagName("textarea")[0].value=
a;return this},getContent:function(){return this.editArea.getElementsByTagName("textarea")[0].value},empty:function(){this.editArea.getElementsByTagName("textarea")[0].value="";return this},_createTextArea:function(){var a=c.createElement("div");textarea=c.createElement("textarea");a.className="workpad-editArea editor";a.appendChild(textarea);return a}})})(workpad);
workpad.Commands=Base.extend({constructor:function(a){this.editor=a;this.composer=a.composer;this.doc=this.composer.doc},support:function(a){return workpad.browser.supportsCommand(this.doc,a)},exec:function(a,c){var b=workpad.commands[a],d=workpad.util.array(arguments).get(),e=b&&b.exec,f=null;if(e)d.unshift(this.editor),f=e.apply(b,d);else try{f=this.doc.execCommand(a,!1,c)}catch(l){}return f}});workpad.commands.addItem={exec:function(a){a.fire("addItem:dispatcher")}};
workpad.commands.indentItem={exec:function(a){a.fire("indentItem:dispatcher")}};workpad.commands.outdentItem={exec:function(a){a.fire("outdentItem:dispatcher")}};
workpad.views.View=Base.extend({constructor:function(a,c,b){this.parent=a;this.element=c;this.config=b},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(a){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}});
(function(a){var c=a.dom;a.views.Composer=a.views.View.extend({name:"composer",constructor:function(a,c,e){this.base(a,c,e);this.wp=this.parent.wp;this._initEditArea()},getUseHoverEditAreaElement:function(){return this.getUseHoverEditArea().getEditArea()},getUseHoverEditArea:function(){return this.editAreaA.lastEdit?this.editAreaB:this.editAreaA},_initEditArea:function(){var a=this;this.editAreaA=new c.editArea(function(){a.editAreaB=new c.editArea(function(){a._insertEditAreas()})})},_insertEditAreas:function(){this.editAreaElementA=
this.editAreaA.getEditArea();this.editAreaElementB=this.editAreaB.getEditArea();var a=this.wp.element;c.insert(this.editAreaElementA).after(a);c.insert(this.editAreaElementB).after(a);this.editAreaA.lastEdit=!1;this.editAreaB.lastEdit=!0;this._create()},_create:function(){this.doc=document;this.element=this.wp;this.wp=this.parent.wp;this.commands=new a.Commands(this.parent);this.parent.commands=this.commands;this.observe();this.dispatcher()}})})(workpad);
(function(a){var c=a.dom,b=a.util,d=a.KEYS;a.views.Composer.prototype.observe=function(){var a=this,f=this.parent.element,l=this.editAreaA.getEditArea(),j=this.editAreaA.getRealNode(),g=this.editAreaB.getEditArea(),v=this.editAreaB.getRealNode();pasteEvents=["drop","paste"];b.debug(f,l,g).debug();l=function(b){var c=b.keyCode;c===d.ENTER_KEY?(b.preventDefault(),a.commands.exec("addItem")):c===d.TAB_KEY&&(b.preventDefault(),b.shiftKey?a.commands.exec("outdentItem"):a.commands.exec("indentItem"))};
c.observe(j,"keydown",l);c.observe(v,"keydown",l);c.delegate(f,".content","mouseover",function(b){var d=c.getParentElement(b.target,{nodeName:"DIV",className:"item"}),f=b.target.textContent,d=c.getAttribute("data-id").from(d);c.offset(a.getUseHoverEditAreaElement()).set(c.offset(b.target).get());a.getUseHoverEditArea().setContent(f);c.setAttributes({"data-id":d,"data-type":"content"}).on(a.getUseHoverEditAreaElement())})}})(workpad);
(function(a){var c=a.util;a.views.Composer.prototype.dispatcher=function(){var a=this.parent,d=this;a.on("addItem:dispatcher",function(){c.debug("Editor on Event:","indentItem:dispatcher").info();d.commandExec("addItem")});a.on("indentItem:dispatcher",function(){c.debug("Editor on Event:","indentItem:dispatcher").info()});a.on("outdentItem:dispatcher",function(){c.debug("Editor on Event:","outdentItem:dispatcher").info()})}})(workpad);
(function(a){a.views.Composer.commandCenter={};window.rangy.init();a.views.Composer.prototype.commandExec=function(c,b){var d=a.views.Composer.commandCenter[c],e=a.util.array(arguments).get(),f=d&&d.exec;return f?(e.unshift(this.parent),f.apply(d,e)):!1}})(workpad);
workpad.views.Composer.commandCenter.addItem={exec:function(){workpad.util.debug("Get Event:","additem:dispatcher").info()}}(function(a){var c=a.data,b=a.util.debug;a.views.Wp=a.views.View.extend({name:"workpad",constructor:function(a,b,c){this.base(a,b,c);this._observe()},initContentByData:function(a){a=c.pretty(a).get();a=this.buildDomByDatas(a);this._setContent(a)},getElementByitemId:function(a){return this.element.querySelector(".item[data-id='"+a+"']")},getContentById:function(a){a=this.getElementByitemId(a);
b(a).debug()},_setContent:function(a){this.element.innerHTML=a},_observe:function(){}})})(workpad);(function(a){var c=a.util;a.views.Wp.prototype.buildDomByDatas=function(a){var c=this;return function f(a){for(var b="",g="",v=0,n=a.length;v<n;v++){var r=a[v];0<r.children.length&&r.collapse&&(g=f(r.children));b+=c.buildHTMLBySingleData({id:r.id,content:r.content,description:r.description,children:g});g=""}return b}(a)};a.views.Wp.prototype.buildHTMLBySingleData=function(a){return c.string('<div class="item" data-id="#{id}"><div class="maindata"><div class="content">#{content}</div><div class="description">#{description}</div></div><div class="children">#{children}</div></div>').interpolate(a)}})(workpad);
(function(a){var c={initContent:void 0};a.Init=a.util.Events.extend({constructor:function(b,d){this.element="string"===typeof b?document.getElementById(b):b;this.config=a.util.object({}).merge(c).merge(d).get();this.currentView=this.wp=new a.views.Wp(this,this.element,this.config);this._isCompatible=a.browser.supported();this.currentView=this.composer=new a.views.Composer(this,this.wp,this.config);this.wp.initContentByData(this.config.initContent)}})})(workpad);
//@ sourceMappingURL=workpad.js.map