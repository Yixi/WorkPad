/**
 Author: liuyixi
 this is lincence
*/
var workpad={version:"0.0.1",util:{},dom:{},commands:{},ui:{},views:{},log:{},data:{},EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,KEYS:{BACKSPACE_KEY:8,TAB_KEY:9,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,END_KEY:35,HOME_KEY:36,LEFT_KEY:37,UP_KEY:38,RIGHT_KEY:39,DOWN_KEY:40,DELETE_KEY:46,A_KEY:65,C_KEY:67,X_KEY:88,V_KEY:86,Z_KEY:90}},Base=function(){};
Base.extend=function(a,d){var c=Base.prototype.extend;Base._prototyping=!0;var b=new this;c.call(b,a);b.base=function(){};delete Base._prototyping;var e=b.constructor,f=b.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==f)this._constructing=!0,e.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||c).call(arguments[0],b)};f.ancestor=this;f.extend=this.extend;f.forEach=this.forEach;f.implement=this.implement;f.prototype=
b;f.toString=this.toString;f.valueOf=function(b){return"object"==b?f:e.valueOf()};c.call(f,d);"function"==typeof f.init&&f.init();return f};
Base.prototype={extend:function(a,d){if(1<arguments.length){var c=this[a];if(c&&"function"==typeof d&&(!c.valueOf||c.valueOf()!=d.valueOf())&&/\bbase\b/.test(d)){var b=d.valueOf();d=function(){var a=this.base||Base.prototype.base;this.base=c;var e=b.apply(this,arguments);this.base=a;return e};d.valueOf=function(a){return"object"==a?d:b};d.toString=Base.toString}this[a]=d}else if(a){var e=Base.prototype.extend;!Base._prototyping&&"function"!=typeof this&&(e=this.extend||e);for(var f={toSource:null},
g=["constructor","toString","valueOf"],h=Base._prototyping?0:1;j=g[h++];)a[j]!=f[j]&&e.call(this,j,a[j]);for(var j in a)f[j]||e.call(this,j,a[j])}return this}};
var Base=Base.extend({constructor:function(a){this.extend(a)}},{ancestor:Object,version:"1.1",forEach:function(a,d,c){for(var b in a)void 0===this.prototype[b]&&d.call(c,a[b],b,a)},implement:function(){for(var a=0;a<arguments.length;a++)if("function"==typeof arguments[a])arguments[a](this.prototype);else this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}}),hexcase=0,b64pad="";function hex_md5(a){return rstr2hex(rstr_md5(str2rstr_utf8(a)))}
function b64_md5(a){return rstr2b64(rstr_md5(str2rstr_utf8(a)))}function any_md5(a,d){return rstr2any(rstr_md5(str2rstr_utf8(a)),d)}function hex_hmac_md5(a,d){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(a),str2rstr_utf8(d)))}function b64_hmac_md5(a,d){return rstr2b64(rstr_hmac_md5(str2rstr_utf8(a),str2rstr_utf8(d)))}function any_hmac_md5(a,d,c){return rstr2any(rstr_hmac_md5(str2rstr_utf8(a),str2rstr_utf8(d)),c)}
function md5_vm_test(){return"900150983cd24fb0d6963f7d28e17f72"==hex_md5("abc").toLowerCase()}function rstr_md5(a){return binl2rstr(binl_md5(rstr2binl(a),8*a.length))}function rstr_hmac_md5(a,d){var c=rstr2binl(a);16<c.length&&(c=binl_md5(c,8*a.length));for(var b=Array(16),e=Array(16),f=0;16>f;f++)b[f]=c[f]^909522486,e[f]=c[f]^1549556828;c=binl_md5(b.concat(rstr2binl(d)),512+8*d.length);return binl2rstr(binl_md5(e.concat(c),640))}
function rstr2hex(a){window.hexcase||(hexcase=0);for(var d=hexcase?"0123456789ABCDEF":"0123456789abcdef",c="",b,e=0;e<a.length;e++)b=a.charCodeAt(e),c+=d.charAt(b>>>4&15)+d.charAt(b&15);return c}
function rstr2b64(a){window.b64pad||(b64pad="");for(var d="",c=a.length,b=0;b<c;b+=3)for(var e=a.charCodeAt(b)<<16|(b+1<c?a.charCodeAt(b+1)<<8:0)|(b+2<c?a.charCodeAt(b+2):0),f=0;4>f;f++)d=8*b+6*f>8*a.length?d+b64pad:d+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>6*(3-f)&63);return d}
function rstr2any(a,d){var c=d.length,b,e,f,g,h,j=Array(Math.ceil(a.length/2));for(b=0;b<j.length;b++)j[b]=a.charCodeAt(2*b)<<8|a.charCodeAt(2*b+1);var l=Math.ceil(8*a.length/(Math.log(d.length)/Math.log(2))),k=Array(l);for(e=0;e<l;e++){h=[];for(b=g=0;b<j.length;b++)if(g=(g<<16)+j[b],f=Math.floor(g/c),g-=f*c,0<h.length||0<f)h[h.length]=f;k[e]=g;j=h}c="";for(b=k.length-1;0<=b;b--)c+=d.charAt(k[b]);return c}
function str2rstr_utf8(a){for(var d="",c=-1,b,e;++c<a.length;)b=a.charCodeAt(c),e=c+1<a.length?a.charCodeAt(c+1):0,55296<=b&&56319>=b&&(56320<=e&&57343>=e)&&(b=65536+((b&1023)<<10)+(e&1023),c++),127>=b?d+=String.fromCharCode(b):2047>=b?d+=String.fromCharCode(192|b>>>6&31,128|b&63):65535>=b?d+=String.fromCharCode(224|b>>>12&15,128|b>>>6&63,128|b&63):2097151>=b&&(d+=String.fromCharCode(240|b>>>18&7,128|b>>>12&63,128|b>>>6&63,128|b&63));return d}
function str2rstr_utf16le(a){for(var d="",c=0;c<a.length;c++)d+=String.fromCharCode(a.charCodeAt(c)&255,a.charCodeAt(c)>>>8&255);return d}function str2rstr_utf16be(a){for(var d="",c=0;c<a.length;c++)d+=String.fromCharCode(a.charCodeAt(c)>>>8&255,a.charCodeAt(c)&255);return d}function rstr2binl(a){for(var d=Array(a.length>>2),c=0;c<d.length;c++)d[c]=0;for(c=0;c<8*a.length;c+=8)d[c>>5]|=(a.charCodeAt(c/8)&255)<<c%32;return d}
function binl2rstr(a){for(var d="",c=0;c<32*a.length;c+=8)d+=String.fromCharCode(a[c>>5]>>>c%32&255);return d}
function binl_md5(a,d){a[d>>5]|=128<<d%32;a[(d+64>>>9<<4)+14]=d;for(var c=1732584193,b=-271733879,e=-1732584194,f=271733878,g=0;g<a.length;g+=16)var h=c,j=b,l=e,k=f,c=md5_ff(c,b,e,f,a[g+0],7,-680876936),f=md5_ff(f,c,b,e,a[g+1],12,-389564586),e=md5_ff(e,f,c,b,a[g+2],17,606105819),b=md5_ff(b,e,f,c,a[g+3],22,-1044525330),c=md5_ff(c,b,e,f,a[g+4],7,-176418897),f=md5_ff(f,c,b,e,a[g+5],12,1200080426),e=md5_ff(e,f,c,b,a[g+6],17,-1473231341),b=md5_ff(b,e,f,c,a[g+7],22,-45705983),c=md5_ff(c,b,e,f,a[g+8],7,
1770035416),f=md5_ff(f,c,b,e,a[g+9],12,-1958414417),e=md5_ff(e,f,c,b,a[g+10],17,-42063),b=md5_ff(b,e,f,c,a[g+11],22,-1990404162),c=md5_ff(c,b,e,f,a[g+12],7,1804603682),f=md5_ff(f,c,b,e,a[g+13],12,-40341101),e=md5_ff(e,f,c,b,a[g+14],17,-1502002290),b=md5_ff(b,e,f,c,a[g+15],22,1236535329),c=md5_gg(c,b,e,f,a[g+1],5,-165796510),f=md5_gg(f,c,b,e,a[g+6],9,-1069501632),e=md5_gg(e,f,c,b,a[g+11],14,643717713),b=md5_gg(b,e,f,c,a[g+0],20,-373897302),c=md5_gg(c,b,e,f,a[g+5],5,-701558691),f=md5_gg(f,c,b,e,a[g+
10],9,38016083),e=md5_gg(e,f,c,b,a[g+15],14,-660478335),b=md5_gg(b,e,f,c,a[g+4],20,-405537848),c=md5_gg(c,b,e,f,a[g+9],5,568446438),f=md5_gg(f,c,b,e,a[g+14],9,-1019803690),e=md5_gg(e,f,c,b,a[g+3],14,-187363961),b=md5_gg(b,e,f,c,a[g+8],20,1163531501),c=md5_gg(c,b,e,f,a[g+13],5,-1444681467),f=md5_gg(f,c,b,e,a[g+2],9,-51403784),e=md5_gg(e,f,c,b,a[g+7],14,1735328473),b=md5_gg(b,e,f,c,a[g+12],20,-1926607734),c=md5_hh(c,b,e,f,a[g+5],4,-378558),f=md5_hh(f,c,b,e,a[g+8],11,-2022574463),e=md5_hh(e,f,c,b,a[g+
11],16,1839030562),b=md5_hh(b,e,f,c,a[g+14],23,-35309556),c=md5_hh(c,b,e,f,a[g+1],4,-1530992060),f=md5_hh(f,c,b,e,a[g+4],11,1272893353),e=md5_hh(e,f,c,b,a[g+7],16,-155497632),b=md5_hh(b,e,f,c,a[g+10],23,-1094730640),c=md5_hh(c,b,e,f,a[g+13],4,681279174),f=md5_hh(f,c,b,e,a[g+0],11,-358537222),e=md5_hh(e,f,c,b,a[g+3],16,-722521979),b=md5_hh(b,e,f,c,a[g+6],23,76029189),c=md5_hh(c,b,e,f,a[g+9],4,-640364487),f=md5_hh(f,c,b,e,a[g+12],11,-421815835),e=md5_hh(e,f,c,b,a[g+15],16,530742520),b=md5_hh(b,e,f,
c,a[g+2],23,-995338651),c=md5_ii(c,b,e,f,a[g+0],6,-198630844),f=md5_ii(f,c,b,e,a[g+7],10,1126891415),e=md5_ii(e,f,c,b,a[g+14],15,-1416354905),b=md5_ii(b,e,f,c,a[g+5],21,-57434055),c=md5_ii(c,b,e,f,a[g+12],6,1700485571),f=md5_ii(f,c,b,e,a[g+3],10,-1894986606),e=md5_ii(e,f,c,b,a[g+10],15,-1051523),b=md5_ii(b,e,f,c,a[g+1],21,-2054922799),c=md5_ii(c,b,e,f,a[g+8],6,1873313359),f=md5_ii(f,c,b,e,a[g+15],10,-30611744),e=md5_ii(e,f,c,b,a[g+6],15,-1560198380),b=md5_ii(b,e,f,c,a[g+13],21,1309151649),c=md5_ii(c,
b,e,f,a[g+4],6,-145523070),f=md5_ii(f,c,b,e,a[g+11],10,-1120210379),e=md5_ii(e,f,c,b,a[g+2],15,718787259),b=md5_ii(b,e,f,c,a[g+9],21,-343485551),c=safe_add(c,h),b=safe_add(b,j),e=safe_add(e,l),f=safe_add(f,k);return[c,b,e,f]}function md5_cmn(a,d,c,b,e,f){return safe_add(bit_rol(safe_add(safe_add(d,a),safe_add(b,f)),e),c)}function md5_ff(a,d,c,b,e,f,g){return md5_cmn(d&c|~d&b,a,d,e,f,g)}function md5_gg(a,d,c,b,e,f,g){return md5_cmn(d&b|c&~b,a,d,e,f,g)}
function md5_hh(a,d,c,b,e,f,g){return md5_cmn(d^c^b,a,d,e,f,g)}function md5_ii(a,d,c,b,e,f,g){return md5_cmn(c^(d|~b),a,d,e,f,g)}function safe_add(a,d){var c=(a&65535)+(d&65535);return(a>>16)+(d>>16)+(c>>16)<<16|c&65535}function bit_rol(a,d){return a<<d|a>>>32-d}
workpad.browser=function(){var a=navigator.userAgent,d=document.createElement("div"),c=-1!==a.indexOf("MSIE")&&-1===a.indexOf("Opera"),b=-1!==a.indexOf("Gecko")&&-1===a.indexOf("KHTML"),e=-1!==a.indexOf("AppleWebKit/");a.indexOf("Chrome/");a.indexOf("Opera/");var f={formatBlock:c,insertUnorderedList:c||e,insertOrderedList:c||e},g={insertHTML:b};return{USER_AGENT:a,supported:function(){var b=this.USER_AGENT.toLowerCase(),a="contentEditable"in d,c=document.execCommand&&document.queryCommandSupported&&
document.queryCommandState,e=document.querySelector&&document.querySelectorAll,b=this.isIos()&&5>+(/ipad|iphone|ipod/.test(b)&&b.match(/ os (\d+).+? like mac os x/)||[,0])[1]||this.isAndroid()&&4>+(b.match(/android (\d+)/)||[,0])[1]||-1!==b.indexOf("opera mobi")||-1!==b.indexOf("hpwos/");return a&&c&&e&&!b},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},isTouchDevice:function(){return this.supportEvent("touchmove")},
supportEvent:function(b){var a;if(!(a="on"+b in d))d.setAttribute("on"+b,"return;"),a="function"===typeof d["on"+b];return a},supportsCommand:function(b,a){if(!f[a]){try{return b.queryCommandSupported(a)}catch(c){}try{return b.queryCommandEnabled(a)}catch(e){return!!g[a]}}return!1}}}();
(function(a){var d=["debug","info","warn","error"];a.util.debug=function(){var c=Array.prototype.slice.call(arguments),b=function(b,c,g){var h=d.indexOf(g),j=d.indexOf("debug");b=a.util.array(b).clone();b.unshift(console,c);return-1<h&&-1<j&&h>=j?console[g]?Function.prototype.bind.apply(console[g],b):Function.prototype.bind.apply(console.log,b):a.EMPTY_FUNCTION};return{error:b(c,"[WorkPad Error!!!]: ","error"),debug:b(c,"[WorkPad Debug]: ","debug"),info:b(c,"[WorkPad Info]: ","info"),warn:b(c,"[Workpad Warn!]: ",
"warn")}}})(workpad);
(function(){workpad.util.array=function(a){return{contains:function(d){if(a.indexOf)return-1!==a.indexOf(d);for(var c=0,b=a.length;c<b;c++)if(a[c]===d)return!0;return!1},without:function(d){d=workpad.util.array(d);for(var c=[],b=0,e=a.length;b<e;b++)d.contains(a[b])||c.push(a[b]);return c},get:function(){for(var d=0,c=a.length,b=[];d<c;d++)b.push(a[d]);return b},unique:function(){for(var d=[],c=0,b=a.length;c<b;c++)workpad.util.array(d).contains(a[c])||d.push(a[c]);return d},clone:function(){for(var d=
[],c=0,b=a.length;c<b;c++)d.push(a[c]);return d}}}})();(function(){var a=/^\s+/,d=/\s+$/;workpad.util.string=function(c){c=String(c);return{trim:function(){return c.replace(a,"").replace(d,"")},interpolate:function(b){for(var a in b)c=this.replace("#{"+a+"}").by(b[a]);return c},replace:function(b){return{by:function(a){return c.split(b).join(a)}}}}}})();
(function(){workpad.util.object=function(a){return{merge:function(d){for(var c in d)a[c]=d[c];return this},get:function(){return a},clone:function(){var d={},c;for(c in a)d[c]=a[c];return d},isArray:function(){return"[object Array]"===Object.prototype.toString.call(a)},safeJSON:function(){try{var d=JSON.parse(JSON.stringify(a))}catch(c){d={}}return d}}}})();
workpad.util.Events=Base.extend({on:function(a,d){this.events=this.events||{};this.events[a]=this.events[a]||[];this.events[a].push(d);return this},off:function(a,d){this.events=this.events||{};var c=0,b,e;if(a){b=this.events[a]||[];for(e=[];c<b.length;c++)b[c]!==d&&d&&e.push(b[c]);this.events[a]=e}else this.events={};return this},fire:function(a,d){this.events=this.events||{};for(var c=this.events[a]||[],b=0;b<c.length;b++)c[b].call(this,d);return this}});
workpad.data.predata=function(){var a=[{content:"Begin to edit your workpad",description:"",id:"00000000-0000-0000-0000-000000000000",expand:!0,children:[]}],d={content:"",description:"",id:"",expand:!0,children:[]};return{GET_EMPTY_DATA:function(){return JSON.parse(JSON.stringify(a))},GET_DEFAULT_JSON:function(){return JSON.parse(JSON.stringify(d))}}}();
workpad.data.check=function(a){return{isObject:function(){return"object"===typeof a&&"[object object]"===Object.prototype.toString.call(a).toLowerCase()&&!a.length}}};(function(a){var d=a.util;a.data.pretty=function(c){return{get:function(){if(d.object(c).isArray()){for(var b=[],e=c.length,f=0;f<e;f++)if(a.data.check(c[f]).isObject())try{var g=JSON.stringify(c[f]);"{}"!==g&&b.push(JSON.parse(g))}catch(h){}1>b.length&&(b=a.data.predata.GET_EMPTY_DATA());return b}return a.data.predata.GET_EMPTY_DATA()}}}})(workpad);
(function(a){var d=a.dom;d.addClass=function(a,b){var e=a.classList;if(e)return e.add(b);d.hasClass(a,b)||(a.className+=" "+b)};d.removeClass=function(a,b){var e=a.classList;if(e)return e.remove(b);a.className=a.className.replace(RegExp("(^|\\s+)"+b+"(\\s+|$)")," ")};d.hasClass=function(a,b){var e=a.classList;if(e)return e.contains(b);e=a.className;return 0<e.length&&(e==b||RegExp("(^|\\s)"+b+"(\\s|$)").test(e))}})(workpad);
(function(){var a={className:"class"};workpad.dom.setAttributes=function(d){return{on:function(c){for(var b in d)c.setAttribute(a[b]||b,d[b])}}};workpad.dom.getAttribute=function(a){return{from:function(c){return c.getAttribute(a)}}}})();
workpad.dom.style=function(a){var d=workpad.dom,c={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},b=/\-[a-z]/g,e=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"];return{setto:function(b){b=b.style;if("string"===typeof a)b.cssText+=";"+a;else{a=workpad.util.object(a).safeJSON();for(var c in a)"float"===c?(b.cssFloat=a[c],b.styleFloat=a[c]):b[c]=a[c]}},getfrom:function(e){if(e.nodeType===workpad.ELEMENT_NODE){var d=e.ownerDocument,h=a,j=c[a]||
a.replace(b,function(b){return b.charAt(1).toUpperCase()}),l=e.style,k=e.currentStyle,m=l[j];if(m)return m;if(k)try{return k[j]}catch(n){}var j=d.defaultView||d.parentWindow,d=("height"===h||"width"===h)&&"TEXTAREA"===e.nodeName,p;if(j.getComputedStyle)return d&&(p=l.overflow,l.overflow="hidden"),e=j.getComputedStyle(e,null).getPropertyValue(h),d&&(l.overflow=p||""),e}},getNumberFrom:function(b){var c=this.getfrom(b),c=c?c.replace("px",""):0,c=parseFloat(c);return isNaN(c)?(workpad.util.debug("can't return a number about "+
a+" from ",b).error(),0):c},copyfrom:function(b){var c=a,h;a:{h=0;for(var j=e.length;h<j;h++)if("border-box"===d.style(e[h]).getfrom(b)){h=e[h];break a}h=void 0}(h=h?parseInt(d.style("width").getfrom(b),10)<b.offsetWidth:!1)&&(c=workpad.util.array(c).without(e));var l="";h=c.length;for(var j=0,k;j<h;j++)k=c[j],l+=k+":"+d.style(k).getfrom(b)+";";return{to:function(b){d.style(l).setto(b);return{andTo:arguments.callee}}}}}};
(function(a){a.dom.offset=function(d){var c=a.dom;return{get:function(){var b=d&&d.ownerDocument,a={top:0,left:0},c;if(b)return c=b.documentElement,"undefined"!==typeof d.getBoundingClientRect&&(a=d.getBoundingClientRect()),b=null!=b&&b===b.window?b:9===b.nodeType&&b.defaultView,{top:a.top+b.pageYOffset-c.clientTop,left:a.left+b.pageXOffset-c.clientLeft,width:a.width,height:a.height}},set:function(b){var a,f,g,h=c.style("position").getfrom(d),j={};"static"===h&&(d.style.position="relative");g=c.offset(d).get();
f=c.style("top").getfrom(d);a=c.style("left").getfrom(d);("absolute"===h||"fixed"===h)&&-1<(f+a).indexOf("auto")?(a=c.offset(d).position(),f=a.top,a=a.left):(f=parseFloat(f)||0,a=parseFloat(a)||0);null!=b.top&&(j.top=b.top-g.top+f+"px");null!=b.left&&(j.left=b.left-g.left+a+"px");null!=b.width&&(j.width=b.width+"px");null!=b.height&&(j.height=b.height+"px");c.style(j).setto(d)},offsetParent:function(){for(var b=d.offsetParent||document.documentElement;b&&!(b.nodeName&&"html"===b.nodeName.toLowerCase())&&
"static"===c.style("position").getfrom(b);)b=b.offsetParent;return b||document.documentElement},position:function(){if(d){var b,a,f={top:0,left:0};"fixed"===c.style("position").getfrom(d)?a=d.getBoundingClientRect():(b=c.offset(d).offsetParent(),a=c.offset(d).get(),b.nodeName&&"html"===b.nodeName.toLowerCase()||(f=c.offset(b).get()),f.top+=c.style("borderTopWidth").getNumberFrom(b),f.left+=c.style("borderLeftWidth").getNumberFrom(b));return{top:a.top-f.top-c.style("marginTop").getNumberFrom(b),left:a.left-
f.left-c.style("marginLeft").getNumberFrom(b)}}}}}})(workpad);workpad.dom.getAsDom=function(){return function(a,d){d=d||document;var c;if("object"===typeof a&&a.nodeType)c=d.createElement("div"),c.appendChild(a);else{c=d;var b=c.createElement("div");b.style.display="none";c.body.appendChild(b);try{b.innerHTML=a}catch(e){}c.body.removeChild(b);c=b}c=c.childNodes;1==c.length&&(c=c[0]);return c}}();
workpad.dom.insert=function(a){return{after:function(d){d.parentNode.insertBefore(a,d.nextSibling)},before:function(d){d.parentNode.insertBefore(a,d)},into:function(d){d.appendChild(a)}}};
workpad.dom.observe=function(a,d,c){d="string"===typeof d?[d]:d;for(var b,e,f=0,g=d.length;f<g;f++)e=d[f],a.addEventListener?a.addEventListener(e,c,!1):(b=function(b){"target"in b||(b.target=b.srcElement);b.preventDefault=b.preventDefault||function(){this.returnValue=!1};b.stopPropagation=b.stopPropagation||function(){this.cancelBubble=!0};c.call(a,b)},a.attachEvent("on"+e,b));return{stop:function(){for(var e,f=0,g=d.length;f<g;f++)e=d[f],a.removeEventListener?a.removeEventListener(e,c,!1):a.detachEvent("on"+
e,b)}}};(function(a){a.dom.delegate=function(d,c,b,e){return a.dom.observe(d,b,function(b){for(var g=b.target,h=a.util.array(d.querySelectorAll(c));g&&g!==d;){if(h.contains(g)){e.call(g,b);break}g=g.parentNode}})}})(workpad);
workpad.dom.getParentElement=function(){function a(a,c){return!c||!c.length?!0:"string"===typeof c?a===c:workpad.util.array(c).contains(a)}return function(d,c,b,e){3==arguments.length&&"boolean"==typeof b&&(e=b,b=70);b=b||70;e&&(d=d.parentNode);if(c.className||c.classRegExp){var f;a:{f=d;for(var g=c.nodeName,h=c.className,j=c.classRegExp,l=b;l--&&f&&"BODY"!==f.nodeName;){var k;if(k=f.nodeType===workpad.ELEMENT_NODE)if(k=a(f.nodeName,g)){k=h;var m=j,m=m||k,m=(f.className||"").match(m)||[];k=!k?!!m.length:
m[m.length-1]===k}if(k)break a;f=f.parentNode}f=null}return f}a:{f=d;g=c.nodeName;for(h=b;h--&&f&&"BODY"!==f.nodeName;){if(a(f.nodeName,g))break a;f=f.parentNode}f=null}return f}}();
(function(a){var d,c;c=function(b){var a=b.selectionStart,c=b.selectionEnd;return{start:a,end:c,length:c-a,text:b.value.slice(a,c)}};d=function(b,a,c){"last"==a&&(a=b.value.length);0>a&&(a+=b.value.length);"undefined"==typeof c&&(c=a);0>c&&(c+=b.value.length);b.selectionStart=a;b.selectionEnd=c};a.dom.editAreaRange=Base.extend({constructor:function(b){this.element=b},getSelection:function(){return c(this.element)},setSelection:function(b,a){d(this.element,b,a)},setCursorLocation:function(b){d(this.element,
b)},getLRchar:function(){var b=c(this.element),a=this.element.value;return{left:a.slice(0,b.start),right:a.slice(b.start,a.length)}}})})(workpad);
(function(a){var d=document;a.dom.editArea=a.dom.editAreaRange.extend({constructor:function(c,b){var d=this;this.callback=c||a.EMPTY_FUNCTION;this.config=a.util.object({}).merge(b).get();this.editArea=this._createTextArea();this.base(this.getRealNode());setTimeout(function(){d.callback(d)},0)},insertInto:function(a){"string"===typeof a&&(a=d.getElementById(a));a.appendChild(this.editArea)},focus:function(){this.getRealNode().focus()},blur:function(){this.getRealNode().blur()},getEditArea:function(){return this.editArea},
getRealNode:function(){return this.editArea.getElementsByTagName("textarea")[0]},setContent:function(a){this.editArea.getElementsByTagName("textarea")[0].value=a;return this},getContent:function(){return this.editArea.getElementsByTagName("textarea")[0].value},empty:function(){this.editArea.getElementsByTagName("textarea")[0].value="";return this},handleContentChange:function(a){this.getRealNode().addEventListener("input",a,!1)},_createTextArea:function(){var a=d.createElement("div");textarea=d.createElement("textarea");
a.className="workpad-editArea editor";a.appendChild(textarea);return a}})})(workpad);workpad.Commands=Base.extend({constructor:function(a){this.editor=a;this.composer=a.composer;this.doc=this.composer.doc},support:function(a){return workpad.browser.supportsCommand(this.doc,a)},exec:function(a,d){var c=workpad.commands[a],b=workpad.util.array(arguments).get(),e=c&&c.exec,f=null;if(e)b.unshift(this.editor),f=e.apply(c,b);else try{f=this.doc.execCommand(a,!1,d)}catch(g){}return f}});
workpad.commands.addItem={exec:function(a){a.fire("addItem:dispatcher")}};workpad.commands.backspace={exec:function(a,d,c){a.fire("backspace:dispatcher",c)}};workpad.commands.indentItem={exec:function(a){a.fire("indentItem:dispatcher")}};workpad.commands.outdentItem={exec:function(a){a.fire("outdentItem:dispatcher")}};workpad.commands.moveUp={exec:function(a){a.fire("editAreaMoveUp:dispatcher")}};workpad.commands.moveDown={exec:function(a){a.fire("editAreaMoveDown:dispatcher")}};
workpad.views.View=Base.extend({constructor:function(a,d,c){this.parent=a;this.element=d;this.config=c},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(a){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}});
(function(a){var d=a.dom;a.views.Composer=a.views.View.extend({name:"composer",constructor:function(a,b,d){this.base(a,b,d);this.wp=this.parent.wp;this._initEditArea()},getUseHoverEditAreaElement:function(){return this.getUseHoverEditArea().getEditArea()},getUseHoverEditArea:function(){return this.editAreaA.lastEdit?this.editAreaB:this.editAreaA},getCurrentUseEditAreaElement:function(){return this.getCurrentUseEditArea().getEditArea()},getCurrentUseEditArea:function(){return this.editAreaA.lastEdit?
this.editAreaA:this.editAreaB},setEditAreaWithItemIdForContent:function(a,b){var e=this.wp.getContentElementById(b);d.offset(a.getEditArea()).set(d.offset(e).get());a.getEditArea().style.display="";a.setContent(e.textContent);d.setAttributes({"data-id":b,"data-type":"content"}).on(a.getEditArea())},hideEditArea:function(a){d.offset(a.getEditArea()).set({top:0,left:0});a.getEditArea().style.display="none"},_initEditArea:function(){var a=this;this.editAreaA=new d.editArea(function(){a.editAreaB=new d.editArea(function(){a._insertEditAreas()})})},
_insertEditAreas:function(){this.editAreaElementA=this.editAreaA.getEditArea();this.editAreaElementB=this.editAreaB.getEditArea();var a=this.wp.element;d.insert(this.editAreaElementA).after(a);d.insert(this.editAreaElementB).after(a);this.editAreaA.lastEdit=!1;this.editAreaB.lastEdit=!0;this._create()},_create:function(){this.doc=document;this.element=this.wp;this.wp=this.parent.wp;this.commands=new a.Commands(this.parent);this.parent.commands=this.commands;this.observe();this.dispatcher()}})})(workpad);
(function(a){var d=a.dom,c=a.util,b=a.KEYS;a.views.Composer.prototype.observe=function(){var a=this,f=this.parent.element,g=this.editAreaA.getEditArea(),h=this.editAreaA.getRealNode(),j=this.editAreaB.getEditArea(),l=this.editAreaB.getRealNode();pasteEvents=["drop","paste"];c.debug(f,g,j).debug();g=function(c){var d=c.keyCode;d===b.ENTER_KEY?(c.preventDefault(),a.commands.exec("addItem")):d===b.TAB_KEY?(c.preventDefault(),c.shiftKey?a.commands.exec("outdentItem"):a.commands.exec("indentItem")):d===
b.UP_KEY?(c.preventDefault(),a.commands.exec("moveUp")):d===b.DOWN_KEY?(c.preventDefault(),a.commands.exec("moveDown")):d===b.BACKSPACE_KEY&&a.commands.exec("backspace",c)};d.observe(h,"keydown",g);d.observe(l,"keydown",g);d.observe(h,"focus",function(){a.editAreaA.lastEdit=!0;a.editAreaB.lastEdit=!1});d.observe(l,"focus",function(){a.editAreaA.lastEdit=!1;a.editAreaB.lastEdit=!0});a.editAreaA.handleContentChange(function(){a.commandExec("syncContent",a.editAreaA)});a.editAreaB.handleContentChange(function(){a.commandExec("syncContent",
a.editAreaB)});d.delegate(f,".content","mouseover",function(b){b=d.getParentElement(b.target,{nodeName:"DIV",className:"item"});b=d.getAttribute("data-id").from(b);a.setEditAreaWithItemIdForContent(a.getUseHoverEditArea(),b)})}})(workpad);
(function(a){var d=a.util;a.views.Composer.prototype.dispatcher=function(){var a=this.parent,b=this;a.on("addItem:dispatcher",function(){d.debug("Editor on Event:","indentItem:dispatcher").info();b.commandExec("addItem")});a.on("backspace:dispatcher",function(a){d.debug("Editor on Event:","backspace:dispatcher").info();b.commandExec("backspace",a)});a.on("indentItem:dispatcher",function(){d.debug("Editor on Event:","indentItem:dispatcher").info();b.commandExec("indentItem")});a.on("outdentItem:dispatcher",
function(){d.debug("Editor on Event:","outdentItem:dispatcher").info();b.commandExec("outdentItem")});a.on("editAreaMoveUp:dispatcher",function(){d.debug("Editor on Event:","editAreaMoveUp:dispatcher").info();b.commandExec("moveUp")});a.on("editAreaMoveDown:dispatcher",function(){d.debug("Editor on Event:","editAreaMoveDown:dispatcher").info();b.commandExec("moveDown")})}})(workpad);
(function(a){a.views.Composer.commandCenter={};a.views.Composer.prototype.commandExec=function(d,c){var b=a.views.Composer.commandCenter[d],e=a.util.array(arguments).get(),f=b&&b.exec;return f?(e.unshift(this.parent),f.apply(b,e)):!1}})(workpad);
workpad.views.Composer.commandCenter.addItem={exec:function(a){workpad.util.debug("Get Event:","additem:dispatcher").info();var d=workpad.dom,c=a.composer,b=c.getCurrentUseEditArea(),e=a.wp,f=b.getLRchar(),g=workpad.dom.getAttribute("data-id").from(b.getEditArea()),h=e.getElementByitemId(g),j=e.haveChildrenWithId(g),l=e.isExpandWithID(g),k=e.initNewBulletPointData();a=k.id;k=d.getAsDom(e.buildHTMLBySingleData(k));c.hideEditArea(c.getUseHoverEditArea());1>workpad.util.string(e.getContentById(g)).trim().length||
(j&&1>f.right.length&&l?(workpad.util.debug("Add item case 1").info(),e=e.getFirstChildElementByItemId(g),d.insert(k).before(e),c.setEditAreaWithItemIdForContent(b,a)):!j&&1>f.right.length?(workpad.util.debug("Add item case 2").info(),d.insert(k).after(h),e.setContentById(g,f.left),c.setEditAreaWithItemIdForContent(b,a)):(workpad.util.debug("Add item case 3").info(),d.insert(k).before(h),e.setContentById(g,f.right),e.setContentById(a,f.left),c.setEditAreaWithItemIdForContent(b,g),b.setCursorLocation(0)))}};
workpad.views.Composer.commandCenter.backspace={exec:function(a,d,c){workpad.util.debug("Get Event:","backspace:dispatcher").info();var b=workpad.dom;d=a.composer;var e=d.getCurrentUseEditArea();a=a.wp;var f=e.getLRchar(),g=workpad.dom.getAttribute("data-id").from(e.getEditArea()),h=a.haveDescriptionWithID(g),j=a.isExpandWithID(g),l=a.haveChildrenWithId(g);a.getElementByitemId(g);var k=a.getTheUpItemIdByCurrent(g),m=a.getPrevElementItemByItemId(g);if(m)var n=m&&b.getAttribute("data-id").from(m),p=
a.haveDescriptionWithID(n),q=a.isExpandWithID(n),r=a.haveChildrenWithId(n);d.hideEditArea(d.getUseHoverEditArea());if(1>f.left.length&&(!(0<f.right.length)||m))0<f.right.length&&m?!p&&!r&&q&&(c.preventDefault(),workpad.util.debug("Backspace button case 3").info(),c=a.getContentById(n),a.removeItemByID(n),a.setContentById(g,c+f.right),d.setEditAreaWithItemIdForContent(e,g),e.setCursorLocation(c.length)):1>f.right.length&&(1==a.getLength()?workpad.util.debug("Backspace button case 1-1").info():(l||
!j||h)&&(!m||p||r||!q)?workpad.util.debug("Backspace button case 4").info():(l||!j||h)&&m?(c.preventDefault(),workpad.util.debug("Backspace button case 3-2").info(),c=a.getContentById(n),a.removeItemByID(n),a.setContentById(g,c),d.setEditAreaWithItemIdForContent(e,g),e.setCursorLocation(c.length)):(c.preventDefault(),(n=a.getNextElementItemByItemId(g))&&b.getAttribute("data-id").from(n),a.removeItemByID(g),k?(d.setEditAreaWithItemIdForContent(e,k),e.setCursorLocation("last")):(e.blur(),d.hideEditArea(e))))}};
workpad.views.Composer.commandCenter.syncContent={exec:function(a,d,c){d=workpad.dom;a=a.wp;var b=c.getEditArea(),e=d.getAttribute("data-id").from(b);"content"===d.getAttribute("data-type").from(b)&&a.setContentById(e,c.getContent())}};
workpad.views.Composer.commandCenter.indentItem={exec:function(a){workpad.util.debug("Get Event:","indentItem:dispatcher").info();var d=workpad.dom,c=a.composer,b=c.getCurrentUseEditArea(),e=a.wp;a=workpad.dom.getAttribute("data-id").from(b.getEditArea());var f=e.getElementByitemId(a);(e=e.getPrevElementItemByItemId(a))&&d.getAttribute("data-id").from(e);c.hideEditArea(c.getUseHoverEditArea());e&&(d.insert(f).into(e.querySelector(".children")),c.setEditAreaWithItemIdForContent(b,a))}};
workpad.views.Composer.commandCenter.outdentItem={exec:function(a){workpad.util.debug("Get Event:","outdentItem:dispatcher").info();var d=workpad.dom,c=a.composer,b=c.getCurrentUseEditArea(),e=a.wp;a=workpad.dom.getAttribute("data-id").from(b.getEditArea());var f=e.getElementByitemId(a);(e=e.getParentElementByitemId(a))&&d.getAttribute("data-id").from(e);c.hideEditArea(c.getUseHoverEditArea());e&&(d.insert(f).after(e),c.setEditAreaWithItemIdForContent(b,a))}};
workpad.views.Composer.commandCenter.moveUp={exec:function(a){workpad.util.debug("Get Event:","editAreaMoveUp:dispatcher").info();var d=a.composer,c=d.getCurrentUseEditArea();a=a.wp;var b=workpad.dom.getAttribute("data-id").from(c.getEditArea());a=a.getTheUpItemIdByCurrent(b);d.hideEditArea(d.getUseHoverEditArea());a&&(d.setEditAreaWithItemIdForContent(c,a),c.setCursorLocation(0))}};
workpad.views.Composer.commandCenter.moveDown={exec:function(a){workpad.util.debug("Get Event:","editAreaMoveDown:dispatcher").info();var d=a.composer,c=d.getCurrentUseEditArea();a=a.wp;var b=workpad.dom.getAttribute("data-id").from(c.getEditArea());a=a.getTheDownItemIdByCurrent(b);d.hideEditArea(d.getUseHoverEditArea());a&&(d.setEditAreaWithItemIdForContent(c,a),c.setCursorLocation(0))}};
(function(a){var d=a.data,c=a.dom;a.views.Wp=a.views.View.extend({name:"workpad",constructor:function(a,c,d){this.base(a,c,d);this._observe()},initContentByData:function(a){a=d.pretty(a).get();a=this.buildDomByDatas(a);this._setContent(a)},getElementByitemId:function(a){return this.element.querySelector(".item[data-id='"+a+"']")},getPrevElementItemByItemId:function(a){return this.getElementByitemId(a).previousElementSibling},getNextElementItemByItemId:function(a){return this.getElementByitemId(a).nextElementSibling},
getParentElementByitemId:function(a){return c.getParentElement(this.getElementByitemId(a),{nodeName:"DIV",className:"item"},!0)},getFirstChildElementByItemId:function(a){if(this.haveChildrenWithId(a))return this.getElementByitemId(a).querySelector(".children").childNodes[0]},getLastChildElementByItemId:function(a){if(this.haveChildrenWithId(a))return a=this.getElementByitemId(a).querySelector(".children").childNodes,a[a.length-1]},getLength:function(){return this.element.querySelectorAll(".item").length},
getTheUpElementByItemId:function(a,d){var f=this.getElementByitemId(a);if(f=d?f:this.getPrevElementItemByItemId(a)){var g=c.getAttribute("data-id").from(f);return this.haveChildrenWithId(g)?(f=this.getLastChildElementByItemId(g),this.getTheUpElementByItemId(c.getAttribute("data-id").from(f),!0)):f}return this.getParentElementByitemId(a)},getTheUpItemIdByCurrent:function(a){return(a=this.getTheUpElementByItemId(a))&&c.getAttribute("data-id").from(a)},getTheDownElementByItemId:function(a,d){this.getElementByitemId(a);
var f=this.getNextElementItemByItemId(a),g=this.haveChildrenWithId(a);if(!d&&g)return this.getFirstChildElementByItemId(a);if(f)return f;if(f=this.getParentElementByitemId(a))return this.getTheDownElementByItemId(c.getAttribute("data-id").from(f),!0)},getTheDownItemIdByCurrent:function(a){return(a=this.getTheDownElementByItemId(a))&&c.getAttribute("data-id").from(a)},getContentById:function(a){return this.getElementByitemId(a).querySelector(".content").innerHTML},setContentById:function(a,c){this.getElementByitemId(a).querySelector(".content").innerHTML=
c},haveChildrenWithId:function(b){b=this.getElementByitemId(b).querySelector(".children");return 1>a.util.string(b.innerHTML).trim().length?!1:!0},getContentElementById:function(a){return this.getElementByitemId(a).querySelector("div.content")},initNewBulletPointId:function(){for(var a=hex_md5(Date.parse(new Date).toString()+Math.random().toString()),c="",d=[8,12,16,20],g=0,h=a.length,j;j=a.charAt(g),g<h;g++)c+=j,-1<d.indexOf(g+1)&&(c+="-");return c},initNewBulletPointData:function(){var b=a.data.predata.GET_DEFAULT_JSON();
b.id=this.initNewBulletPointId();return b},isExpandWithID:function(){return!0},removeItemByID:function(a){a=this.getElementByitemId(a);a.parentNode.removeChild(a)},haveDescriptionWithID:function(){return!1},_setContent:function(a){this.element.innerHTML=a},_observe:function(){}})})(workpad);
(function(a){var d=a.util;a=a.views.Wp.prototype;a.buildDomByDatas=function(a){var b=this;return function f(a){for(var c="",d="",l=0,k=a.length;l<k;l++){var m=a[l];0<m.children.length&&m.expand&&(d=f(m.children));c+=b.buildHTMLBySingleData({id:m.id,content:m.content,description:m.description,children:d});d=""}return c}(a)};a.buildHTMLBySingleData=function(a){return d.string('<div class="item" data-id="#{id}"><div class="maindata"><div class="content">#{content}</div><div class="description">#{description}</div></div><div class="children">#{children}</div></div>').interpolate(a)}})(workpad);
(function(a){var d={initContent:void 0};a.Init=a.util.Events.extend({constructor:function(c,b){this.element="string"===typeof c?document.getElementById(c):c;this.config=a.util.object({}).merge(d).merge(b).get();this.currentView=this.wp=new a.views.Wp(this,this.element,this.config);this._isCompatible=a.browser.supported();this.currentView=this.composer=new a.views.Composer(this,this.wp,this.config);this.wp.initContentByData(this.config.initContent)}})})(workpad);
//@ sourceMappingURL=workpad.js.map