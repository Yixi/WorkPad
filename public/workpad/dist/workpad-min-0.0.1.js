/**
 Author: liuyixi
 this is lincence
*/
var workpad={version:"0.0.1",util:{},dom:{},commands:{},ui:{},views:{},log:{},data:{},EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,KEYS:{BACKSPACE_KEY:8,TAB_KEY:9,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,END_KEY:35,HOME_KEY:36,LEFT_KEY:37,UP_KEY:38,RIGHT_KEY:39,DOWN_KEY:40,DELETE_KEY:46,A_KEY:65,C_KEY:67,X_KEY:88,V_KEY:86,Z_KEY:90}},Base=function(){};
Base.extend=function(a,b){var d=Base.prototype.extend;Base._prototyping=!0;var c=new this;d.call(c,a);c.base=function(){};delete Base._prototyping;var e=c.constructor,g=c.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==g)this._constructing=!0,e.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||d).call(arguments[0],c)};g.ancestor=this;g.extend=this.extend;g.forEach=this.forEach;g.implement=this.implement;g.prototype=
c;g.toString=this.toString;g.valueOf=function(a){return"object"==a?g:e.valueOf()};d.call(g,b);"function"==typeof g.init&&g.init();return g};
Base.prototype={extend:function(a,b){if(1<arguments.length){var d=this[a];if(d&&"function"==typeof b&&(!d.valueOf||d.valueOf()!=b.valueOf())&&/\bbase\b/.test(b)){var c=b.valueOf();b=function(){var a=this.base||Base.prototype.base;this.base=d;var b=c.apply(this,arguments);this.base=a;return b};b.valueOf=function(a){return"object"==a?b:c};b.toString=Base.toString}this[a]=b}else if(a){var e=Base.prototype.extend;!Base._prototyping&&"function"!=typeof this&&(e=this.extend||e);for(var g={toSource:null},
l=["constructor","toString","valueOf"],j=Base._prototyping?0:1;h=l[j++];)a[h]!=g[h]&&e.call(this,h,a[h]);for(var h in a)g[h]||e.call(this,h,a[h])}return this}};
Base=Base.extend({constructor:function(a){this.extend(a)}},{ancestor:Object,version:"1.1",forEach:function(a,b,d){for(var c in a)void 0===this.prototype[c]&&b.call(d,a[c],c,a)},implement:function(){for(var a=0;a<arguments.length;a++)if("function"==typeof arguments[a])arguments[a](this.prototype);else this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}});
window.rangy=function(){function a(a,m){var b=typeof a[m];return b==v||!!(b==h&&a[m])||"unknown"==b}function b(a,m){return!!(typeof a[m]==h&&a[m])}function d(a,m){return typeof a[m]!=p}function c(a){return function(m,b){for(var d=b.length;d--;)if(!a(m,b[d]))return!1;return!0}}function e(a){return a&&q(a,n)&&C(a,x)}function g(a){window.alert("Rangy not supported in your browser. Reason: "+a);r.initialized=!0;r.supported=!1}function l(){if(!r.initialized){var m,d=!1,c=!1;a(document,"createRange")&&
(m=document.createRange(),q(m,u)&&C(m,s)&&(d=!0),m.detach());if((m=b(document,"body")?document.body:document.getElementsByTagName("body")[0])&&a(m,"createTextRange"))m=m.createTextRange(),e(m)&&(c=!0);!d&&!c&&g("Neither Range nor TextRange are implemented");r.initialized=!0;r.features={implementsDomRange:d,implementsTextRange:c};d=K.concat(F);c=0;for(m=d.length;c<m;++c)try{d[c](r)}catch(n){b(window,"console")&&a(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",
n)}}}function j(a){this.name=a;this.supported=this.initialized=!1}var h="object",v="function",p="undefined",s="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer START_TO_START START_TO_END END_TO_START END_TO_END".split(" "),u="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),
x="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),n="collapse compareEndPoints duplicate getBookmark moveToBookmark moveToElementText parentElement pasteHTML select setEndPoint getBoundingClientRect".split(" "),q=c(a),m=c(b),C=c(d),r={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:a,isHostObject:b,isHostProperty:d,areHostMethods:q,areHostObjects:m,areHostProperties:C,isTextRange:e},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};
r.fail=g;r.warn=function(a){a="Rangy warning: "+a;r.config.alertOnWarn?window.alert(a):typeof window.console!=p&&typeof window.console.log!=p&&window.console.log(a)};({}).hasOwnProperty?r.util.extend=function(a,m){for(var b in m)m.hasOwnProperty(b)&&(a[b]=m[b])}:g("hasOwnProperty not supported");var F=[],K=[];r.init=l;r.addInitListener=function(a){r.initialized?a(r):F.push(a)};var G=[];r.addCreateMissingNativeApiListener=function(a){G.push(a)};r.createMissingNativeApi=function(a){a=a||window;l();
for(var m=0,b=G.length;m<b;++m)G[m](a)};j.prototype.fail=function(a){this.initialized=!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+a);};j.prototype.warn=function(a){r.warn("Module "+this.name+": "+a)};j.prototype.createError=function(a){return Error("Error in Rangy "+this.name+" module: "+a)};r.createModule=function(a,m){var b=new j(a);r.modules[a]=b;K.push(function(a){m(a,b);b.initialized=!0;b.supported=!0})};r.requireModules=function(a){for(var m=0,b=a.length,d,c;m<
b;++m){c=a[m];d=r.modules[c];if(!d||!(d instanceof j))throw Error("Module '"+c+"' not found");if(!d.supported)throw Error("Module '"+c+"' not supported");}};var E=!1,m=function(){E||(E=!0,r.initialized||l())};if(typeof window==p)g("No window found");else if(typeof document==p)g("No document found");else return a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",m,!1),a(window,"addEventListener")?window.addEventListener("load",m,!1):a(window,"attachEvent")?window.attachEvent("onload",
m):g("Window does not have required addEventListener or attachEvent method"),r}();
rangy.createModule("DomUtil",function(a,b){function d(a){for(var b=0;a=a.previousSibling;)b++;return b}function c(a,b){var d=[],c;for(c=a;c;c=c.parentNode)d.push(c);for(c=b;c;c=c.parentNode)if(q(d,c))return c;return null}function e(a,b,c){for(c=c?a:a.parentNode;c;){a=c.parentNode;if(a===b)return c;c=a}return null}function g(a){a=a.nodeType;return 3==a||4==a||8==a}function l(a,b){var c=b.nextSibling,d=b.parentNode;c?d.insertBefore(a,c):d.appendChild(a);return a}function j(a){if(9==a.nodeType)return a;
if(typeof a.ownerDocument!=u)return a.ownerDocument;if(typeof a.document!=u)return a.document;if(a.parentNode)return j(a.parentNode);throw Error("getDocument: no document found for node");}function h(a){return!a?"[No node]":g(a)?'"'+a.data+'"':1==a.nodeType?"<"+a.nodeName+(a.id?' id="'+a.id+'"':"")+">["+a.childNodes.length+"]":a.nodeName}function v(a){this._next=this.root=a}function p(a,b){this.node=a;this.offset=b}function s(a){this.code=this[a];this.codeName=a;this.message="DOMException: "+this.codeName}
var u="undefined",x=a.util;x.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method");x.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var n=document.createElement("div");x.areHostMethods(n,["insertBefore","appendChild","cloneNode"])||b.fail("Incomplete Element implementation");x.isHostProperty(n,"innerHTML")||b.fail("Element is missing innerHTML property");n=document.createTextNode("test");
x.areHostMethods(n,["splitText","deleteData","insertData","appendData","cloneNode"])||b.fail("Incomplete Text Node implementation");var q=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};v.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next,b;if(this._current){b=a.firstChild;if(!b)for(b=null;a!==this.root&&!(b=a.nextSibling);)a=a.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=
null}};p.prototype={equals:function(a){return this.node===a.node&this.offset==a.offset},inspect:function(){return"[DomPosition("+h(this.node)+":"+this.offset+")]"}};s.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};s.prototype.toString=function(){return this.message};a.dom={arrayContains:q,isHtmlNamespace:function(a){var b;return typeof a.namespaceURI==u||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==
b},parentElement:function(a){a=a.parentNode;return 1==a.nodeType?a:null},getNodeIndex:d,getNodeLength:function(a){var b;return g(a)?a.length:(b=a.childNodes)?b.length:0},getCommonAncestor:c,isAncestorOf:function(a,b,c){for(b=c?b:b.parentNode;b;){if(b===a)return!0;b=b.parentNode}return!1},getClosestAncestorIn:e,isCharacterDataNode:g,insertAfter:l,splitDataNode:function(a,b){var c=a.cloneNode(!1);c.deleteData(0,b);a.deleteData(b,a.length-b);l(c,a);return c},getDocument:j,getWindow:function(a){a=j(a);
if(typeof a.defaultView!=u)return a.defaultView;if(typeof a.parentWindow!=u)return a.parentWindow;throw Error("Cannot get a window object for node");},getIframeWindow:function(a){if(typeof a.contentWindow!=u)return a.contentWindow;if(typeof a.contentDocument!=u)return a.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element");},getIframeDocument:function(a){if(typeof a.contentDocument!=u)return a.contentDocument;if(typeof a.contentWindow!=u)return a.contentWindow.document;
throw Error("getIframeWindow: No Document object found for iframe element");},getBody:function(a){return x.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]},getRootContainer:function(a){for(var b;b=a.parentNode;)a=b;return a},comparePoints:function(a,b,n,g){var q;if(a==n)return b===g?0:b<g?-1:1;if(q=e(n,a,!0))return b<=d(q)?-1:1;if(q=e(a,n,!0))return d(q)<g?-1:1;b=c(a,n);a=a===b?b:e(a,b,!0);n=n===b?b:e(n,b,!0);if(a===n)throw Error("comparePoints got to case 4 and childA and childB are the same!");
for(b=b.firstChild;b;){if(b===a)return-1;if(b===n)return 1;b=b.nextSibling}throw Error("Should not be here!");},inspectNode:h,fragmentFromNodeChildren:function(a){for(var b=j(a).createDocumentFragment(),c;c=a.firstChild;)b.appendChild(c);return b},createIterator:function(a){return new v(a)},DomPosition:p};a.DOMException=s});
rangy.createModule("DomRange",function(a){function b(a,b){return 3!=a.nodeType&&(k.isAncestorOf(a,b.startContainer,!0)||k.isAncestorOf(a,b.endContainer,!0))}function d(a){return k.getDocument(a.startContainer)}function c(a,b,f){if(b=a._listeners[b])for(var c=0,d=b.length;c<d;++c)b[c].call(a,{target:a,args:f})}function e(a){return new L(a.parentNode,k.getNodeIndex(a))}function g(a){return new L(a.parentNode,k.getNodeIndex(a)+1)}function l(a,b,f){var c=11==a.nodeType?a.firstChild:a;k.isCharacterDataNode(b)?
f==b.length?k.insertAfter(a,b):b.parentNode.insertBefore(a,0==f?b:k.splitDataNode(b,f)):f>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[f]);return c}function j(a){for(var b,f,c=d(a.range).createDocumentFragment();f=a.next();){b=a.isPartiallySelectedSubtree();f=f.cloneNode(!b);b&&(b=a.getSubtreeIterator(),f.appendChild(j(b)),b.detach(!0));if(10==f.nodeType)throw new D("HIERARCHY_REQUEST_ERR");c.appendChild(f)}return c}function h(a,b,f){var c,d;for(f=f||{stop:!1};c=a.next();)if(a.isPartiallySelectedSubtree())if(!1===
b(c)){f.stop=!0;break}else{if(c=a.getSubtreeIterator(),h(c,b,f),c.detach(!0),f.stop)break}else for(c=k.createIterator(c);d=c.next();)if(!1===b(d)){f.stop=!0;return}}function v(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),v(b),b.detach(!0)):a.remove()}function p(a){for(var b,f=d(a.range).createDocumentFragment(),c;b=a.next();){a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),c=a.getSubtreeIterator(),b.appendChild(p(c)),c.detach(!0)):a.remove();if(10==b.nodeType)throw new D("HIERARCHY_REQUEST_ERR");
f.appendChild(b)}return f}function s(a,b,f){var c=!(!b||!b.length),d,n=!!f;c&&(d=RegExp("^("+b.join("|")+")$"));var B=[];h(new x(a,!1),function(a){(!c||d.test(a.nodeType))&&(!n||f(a))&&B.push(a)});return B}function u(a){return"["+("undefined"==typeof a.getName?"Range":a.getName())+"("+k.inspectNode(a.startContainer)+":"+a.startOffset+", "+k.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function x(a,b){this.range=a;this.clonePartiallySelectedTextNodes=b;if(!a.collapsed){this.sc=a.startContainer;
this.so=a.startOffset;this.ec=a.endContainer;this.eo=a.endOffset;var f=a.commonAncestorContainer;this.sc===this.ec&&k.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===f&&!k.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:k.getClosestAncestorIn(this.sc,f,!0),this._last=this.ec===f&&!k.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:k.getClosestAncestorIn(this.ec,f,!0))}}function n(a){this.code=
this[a];this.codeName=a;this.message="RangeException: "+this.codeName}function q(a,b,f){this.nodes=s(a,b,f);this._next=this.nodes[0];this._position=0}function m(a){return function(b,f){for(var c,d=f?b:b.parentNode;d;){c=d.nodeType;if(k.arrayContains(a,c))return d;d=d.parentNode}return null}}function C(a,b){if(P(a,b))throw new n("INVALID_NODE_TYPE_ERR");}function r(a){if(!a.startContainer)throw new D("INVALID_STATE_ERR");}function F(a,b){if(!k.arrayContains(b,a.nodeType))throw new n("INVALID_NODE_TYPE_ERR");
}function K(a,b){if(0>b||b>(k.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new D("INDEX_SIZE_ERR");}function G(a,b){if(M(a,!0)!==M(b,!0))throw new D("WRONG_DOCUMENT_ERR");}function E(a){if(W(a,!0))throw new D("NO_MODIFICATION_ALLOWED_ERR");}function A(a,b){if(!a)throw new D(b);}function w(a){r(a);if(!k.arrayContains(Q,a.startContainer.nodeType)&&!M(a.startContainer,!0)||!k.arrayContains(Q,a.endContainer.nodeType)&&!M(a.endContainer,!0)||!(a.startOffset<=(k.isCharacterDataNode(a.startContainer)?
a.startContainer.length:a.startContainer.childNodes.length))||!(a.endOffset<=(k.isCharacterDataNode(a.endContainer)?a.endContainer.length:a.endContainer.childNodes.length)))throw Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")");}function J(){}function U(a){a.START_TO_START=X;a.START_TO_END=$;a.END_TO_END=ea;a.END_TO_START=aa;a.NODE_BEFORE=ba;a.NODE_AFTER=ca;a.NODE_BEFORE_AND_AFTER=da;a.NODE_INSIDE=Y}function t(a){U(a);U(a.prototype)}function N(a,b){return function(){w(this);
var f=this.startContainer,c=this.startOffset,d=this.commonAncestorContainer,n=new x(this,!0);f!==d&&(f=k.getClosestAncestorIn(f,d,!0),c=g(f),f=c.node,c=c.offset);h(n,E);n.reset();d=a(n);n.detach();b(this,f,c,f,c);return d}}function R(f,c,d){function n(a,b){return function(f){r(this);F(f,H);F(O(f),Q);f=(a?e:g)(f);(b?B:q)(this,f.node,f.offset)}}function B(a,b,f){var d=a.endContainer,y=a.endOffset;if(b!==a.startContainer||f!==a.startOffset){if(O(b)!=O(d)||1==k.comparePoints(b,f,d,y))d=b,y=f;c(a,b,f,
d,y)}}function q(a,b,f){var d=a.startContainer,y=a.startOffset;if(b!==a.endContainer||f!==a.endOffset){if(O(b)!=O(d)||-1==k.comparePoints(b,f,d,y))d=b,y=f;c(a,d,y,b,f)}}f.prototype=new J;a.util.extend(f.prototype,{setStart:function(a,b){r(this);C(a,!0);K(a,b);B(this,a,b)},setEnd:function(a,b){r(this);C(a,!0);K(a,b);q(this,a,b)},setStartBefore:n(!0,!0),setStartAfter:n(!1,!0),setEndBefore:n(!0,!1),setEndAfter:n(!1,!1),collapse:function(a){w(this);a?c(this,this.startContainer,this.startOffset,this.startContainer,
this.startOffset):c(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){r(this);C(a,!0);c(this,a,0,a,k.getNodeLength(a))},selectNode:function(a){r(this);C(a,!1);F(a,H);var b=e(a);a=g(a);c(this,b.node,b.offset,a.node,a.offset)},extractContents:N(p,c),deleteContents:N(v,c),canSurroundContents:function(){w(this);E(this.startContainer);E(this.endContainer);var a=new x(this,!0),f=a._first&&b(a._first,this)||a._last&&b(a._last,this);a.detach();return!f},
detach:function(){d(this)},splitBoundaries:function(){w(this);var a=this.startContainer,b=this.startOffset,f=this.endContainer,d=this.endOffset,y=a===f;k.isCharacterDataNode(f)&&0<d&&d<f.length&&k.splitDataNode(f,d);k.isCharacterDataNode(a)&&0<b&&b<a.length&&(a=k.splitDataNode(a,b),y?(d-=b,f=a):f==a.parentNode&&d>=k.getNodeIndex(a)&&d++,b=0);c(this,a,b,f,d)},normalizeBoundaries:function(){w(this);var a=this.startContainer,b=this.startOffset,f=this.endContainer,d=this.endOffset,y=function(a){var b=
a.nextSibling;b&&b.nodeType==a.nodeType&&(f=a,d=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},n=function(c){var y=c.previousSibling;if(y&&y.nodeType==c.nodeType){a=c;var n=c.length;b=y.length;c.insertData(0,y.data);y.parentNode.removeChild(y);a==f?(d+=b,f=a):f==c.parentNode&&(y=k.getNodeIndex(c),d==y?(f=c,d=n):d>y&&d--)}},B=!0;k.isCharacterDataNode(f)?f.length==d&&y(f):(0<d&&(B=f.childNodes[d-1])&&k.isCharacterDataNode(B)&&y(B),B=!this.collapsed);B?k.isCharacterDataNode(a)?0==b&&n(a):
b<a.childNodes.length&&(y=a.childNodes[b])&&k.isCharacterDataNode(y)&&n(y):(a=f,b=d);c(this,a,b,f,d)},collapseToPoint:function(a,b){r(this);C(a,!0);K(a,b);(a!==this.startContainer||b!==this.startOffset||a!==this.endContainer||b!==this.endOffset)&&c(this,a,b,a,b)}});t(f)}function V(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;a.commonAncestorContainer=a.collapsed?a.startContainer:k.getCommonAncestor(a.startContainer,a.endContainer)}function S(a,b,f,d,n){var B=a.startContainer!==
b||a.startOffset!==f,e=a.endContainer!==d||a.endOffset!==n;a.startContainer=b;a.startOffset=f;a.endContainer=d;a.endOffset=n;V(a);c(a,"boundarychange",{startMoved:B,endMoved:e})}function z(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};V(this)}a.requireModules(["DomUtil"]);var k=a.dom,L=k.DomPosition,D=a.DOMException;x.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=
null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;a&&(this._next=a!==this._last?a.nextSibling:null,k.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so)));return a},remove:function(){var a=this._current,b,f;k.isCharacterDataNode(a)&&(a===this.sc||a===this.ec)?(b=a===this.sc?this.so:0,f=a===
this.ec?this.eo:a.length,b!=f&&a.deleteData(b,f-b)):a.parentNode&&a.parentNode.removeChild(a)},isPartiallySelectedSubtree:function(){return b(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new z(d(this.range));var b=this._current,f=b,c=0,n=b,B=k.getNodeLength(b);k.isAncestorOf(b,this.sc,!0)&&(f=this.sc,c=this.so);k.isAncestorOf(b,this.ec,!0)&&(n=this.ec,B=this.eo);S(a,f,c,n,B)}return new x(a,this.clonePartiallySelectedTextNodes)},
detach:function(a){a&&this.range.detach();this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};n.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};n.prototype.toString=function(){return this.message};q.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var H=[1,3,4,5,
7,8,10],Q=[2,9,11],I=[1,3,4,5,7,8,10,11],T=[1,3,4,5,7,8],O=k.getRootContainer,M=m([9,11]),W=m([5,6,10,12]),P=m([6,10,12]),f=document.createElement("style"),B=!1;try{f.innerHTML="<b>x</b>",B=3==f.firstChild.nodeType}catch(fa){}a.features.htmlParsingConforms=B;var Z="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),X=0,$=1,ea=2,aa=3,ba=0,ca=1,da=2,Y=3;J.prototype={attachListener:function(a,b){this._listeners[a].push(b)},compareBoundaryPoints:function(a,
b){w(this);G(this.startContainer,b.startContainer);var f=a==aa||a==X?"start":"end",c=a==$||a==X?"start":"end";return k.comparePoints(this[f+"Container"],this[f+"Offset"],b[c+"Container"],b[c+"Offset"])},insertNode:function(a){w(this);F(a,I);E(this.startContainer);if(k.isAncestorOf(a,this.startContainer,!0))throw new D("HIERARCHY_REQUEST_ERR");a=l(a,this.startContainer,this.startOffset);this.setStartBefore(a)},cloneContents:function(){w(this);var a,b;if(this.collapsed)return d(this).createDocumentFragment();
if(this.startContainer===this.endContainer&&k.isCharacterDataNode(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=d(this).createDocumentFragment(),b.appendChild(a),b;b=new x(this,!0);a=j(b);b.detach();return a},canSurroundContents:function(){w(this);E(this.startContainer);E(this.endContainer);var a=new x(this,!0),f=a._first&&b(a._first,this)||a._last&&b(a._last,this);a.detach();return!f},surroundContents:function(a){F(a,T);if(!this.canSurroundContents())throw new n("BAD_BOUNDARYPOINTS_ERR");
var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);l(a,this.startContainer,this.startOffset);a.appendChild(b);this.selectNode(a)},cloneRange:function(){w(this);for(var a=new z(d(this)),b=Z.length,f;b--;)f=Z[b],a[f]=this[f];return a},toString:function(){w(this);var a=this.startContainer;if(a===this.endContainer&&k.isCharacterDataNode(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[],a=new x(this,!0);h(a,function(a){(3==
a.nodeType||4==a.nodeType)&&b.push(a.data)});a.detach();return b.join("")},compareNode:function(a){w(this);var b=a.parentNode,f=k.getNodeIndex(a);if(!b)throw new D("NOT_FOUND_ERR");a=this.comparePoint(b,f);b=this.comparePoint(b,f+1);return 0>a?0<b?da:ba:0<b?ca:Y},comparePoint:function(a,b){w(this);A(a,"HIERARCHY_REQUEST_ERR");G(a,this.startContainer);return 0>k.comparePoints(a,b,this.startContainer,this.startOffset)?-1:0<k.comparePoints(a,b,this.endContainer,this.endOffset)?1:0},createContextualFragment:B?
function(a){var b=this.startContainer,f=k.getDocument(b);if(!b)throw new D("INVALID_STATE_ERR");var c=null;1==b.nodeType?c=b:k.isCharacterDataNode(b)&&(c=k.parentElement(b));c=null===c||"HTML"==c.nodeName&&k.isHtmlNamespace(k.getDocument(c).documentElement)&&k.isHtmlNamespace(c)?f.createElement("body"):c.cloneNode(!1);c.innerHTML=a;return k.fragmentFromNodeChildren(c)}:function(a){r(this);var b=d(this).createElement("body");b.innerHTML=a;return k.fragmentFromNodeChildren(b)},toHtml:function(){w(this);
var a=d(this).createElement("div");a.appendChild(this.cloneContents());return a.innerHTML},intersectsNode:function(a,b){w(this);A(a,"NOT_FOUND_ERR");if(k.getDocument(a)!==d(this))return!1;var f=a.parentNode,c=k.getNodeIndex(a);A(f,"NOT_FOUND_ERR");var n=k.comparePoints(f,c,this.endContainer,this.endOffset),f=k.comparePoints(f,c+1,this.startContainer,this.startOffset);return b?0>=n&&0<=f:0>n&&0<f},isPointInRange:function(a,b){w(this);A(a,"HIERARCHY_REQUEST_ERR");G(a,this.startContainer);return 0<=
k.comparePoints(a,b,this.startContainer,this.startOffset)&&0>=k.comparePoints(a,b,this.endContainer,this.endOffset)},intersectsRange:function(a,b){w(this);if(d(a)!=d(this))throw new D("WRONG_DOCUMENT_ERR");var f=k.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),c=k.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);return b?0>=f&&0<=c:0>f&&0<c},intersection:function(a){if(this.intersectsRange(a)){var b=k.comparePoints(this.startContainer,
this.startOffset,a.startContainer,a.startOffset),f=k.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),c=this.cloneRange();-1==b&&c.setStart(a.startContainer,a.startOffset);1==f&&c.setEnd(a.endContainer,a.endOffset);return c}return null},union:function(a){if(this.intersectsRange(a,!0)){var b=this.cloneRange();-1==k.comparePoints(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset);1==k.comparePoints(a.endContainer,
a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset);return b}throw new n("Ranges do not intersect");},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==Y},containsNodeContents:function(a){return 0<=this.comparePoint(a,0)&&0>=this.comparePoint(a,k.getNodeLength(a))},containsRange:function(a){return this.intersection(a).equals(a)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var f=b.getNodes([3]);return 0<f.length?
(b.setStart(f[0],0),a=f.pop(),b.setEnd(a,a.length),a=this.containsRange(b),b.detach(),a):this.containsNodeContents(a)},createNodeIterator:function(a,b){w(this);return new q(this,a,b)},getNodes:function(a,b){w(this);return s(this,a,b)},getDocument:function(){return d(this)},collapseBefore:function(a){r(this);this.setEndBefore(a);this.collapse(!1)},collapseAfter:function(a){r(this);this.setStartAfter(a);this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return z.rangesEqual(this,
a)},inspect:function(){return u(this)}};R(z,S,function(a){r(a);a.startContainer=a.startOffset=a.endContainer=a.endOffset=null;a.collapsed=a.commonAncestorContainer=null;c(a,"detach",null);a._listeners=null});a.rangePrototype=J.prototype;z.rangeProperties=Z;z.RangeIterator=x;z.copyComparisonConstants=t;z.createPrototypeRange=R;z.inspect=u;z.getRangeDocument=d;z.rangesEqual=function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===
b.endOffset};a.DomRange=z;a.RangeException=n});
rangy.createModule("WrappedRange",function(a){function b(a,b,c,d){var j=a.duplicate();j.collapse(c);var h=j.parentElement();e.isAncestorOf(b,h,!0)||(h=b);if(!h.canHaveHTML)return new g(h.parentNode,e.getNodeIndex(h));b=e.getDocument(h).createElement("span");var l,p=c?"StartToStart":"StartToEnd";do h.insertBefore(b,b.previousSibling),j.moveToElementText(b);while(0<(l=j.compareEndPoints(p,a))&&b.previousSibling);p=b.nextSibling;if(-1==l&&p&&e.isCharacterDataNode(p)){j.setEndPoint(c?"EndToStart":"EndToEnd",
a);if(/[\r\n]/.test(p.data)){h=j.duplicate();c=h.text.replace(/\r\n/g,"\r").length;for(c=h.moveStart("character",c);-1==h.compareEndPoints("StartToEnd",h);)c++,h.moveStart("character",1)}else c=j.text.length;h=new g(p,c)}else p=(d||!c)&&b.previousSibling,h=(c=(d||c)&&b.nextSibling)&&e.isCharacterDataNode(c)?new g(c,0):p&&e.isCharacterDataNode(p)?new g(p,p.length):new g(h,e.getNodeIndex(b));b.parentNode.removeChild(b);return h}function d(a,b){var c,d,g=a.offset,j=e.getDocument(a.node),h=j.body.createTextRange(),
l=e.isCharacterDataNode(a.node);l?(c=a.node,d=c.parentNode):(c=a.node.childNodes,c=g<c.length?c[g]:null,d=a.node);j=j.createElement("span");j.innerHTML="&#feff;";c?d.insertBefore(j,c):d.appendChild(j);h.moveToElementText(j);h.collapse(!b);d.removeChild(j);if(l)h[b?"moveStart":"moveEnd"]("character",g);return h}a.requireModules(["DomUtil","DomRange"]);var c,e=a.dom,g=e.DomPosition,l=a.DomRange;if(a.features.implementsDomRange&&(!a.features.implementsTextRange||!a.config.preferTextRange)){var j=function(a){for(var b=
v.length,c;b--;)c=v[b],a[c]=a.nativeRange[c]},h,v=l.rangeProperties,p;c=function(a){if(!a)throw Error("Range must be specified");this.nativeRange=a;j(this)};l.createPrototypeRange(c,function(a,b,c,d,g){var e=a.endContainer!==d||a.endOffset!=g;if(a.startContainer!==b||a.startOffset!=c||e)a.setEnd(d,g),a.setStart(b,c)},function(a){a.nativeRange.detach();a.detached=!0;for(var b=v.length,c;b--;)c=v[b],a[c]=null});h=c.prototype;h.selectNode=function(a){this.nativeRange.selectNode(a);j(this)};h.deleteContents=
function(){this.nativeRange.deleteContents();j(this)};h.extractContents=function(){var a=this.nativeRange.extractContents();j(this);return a};h.cloneContents=function(){return this.nativeRange.cloneContents()};h.surroundContents=function(a){this.nativeRange.surroundContents(a);j(this)};h.collapse=function(a){this.nativeRange.collapse(a);j(this)};h.cloneRange=function(){return new c(this.nativeRange.cloneRange())};h.refresh=function(){j(this)};h.toString=function(){return this.nativeRange.toString()};
var s=document.createTextNode("test");e.getBody(document).appendChild(s);var u=document.createRange();u.setStart(s,0);u.setEnd(s,0);try{u.setStart(s,1),h.setStart=function(a,b){this.nativeRange.setStart(a,b);j(this)},h.setEnd=function(a,b){this.nativeRange.setEnd(a,b);j(this)},p=function(a){return function(b){this.nativeRange[a](b);j(this)}}}catch(x){h.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(c){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}j(this)},h.setEnd=function(a,
b){try{this.nativeRange.setEnd(a,b)}catch(c){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}j(this)},p=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(d){this.nativeRange[b](c),this.nativeRange[a](c)}j(this)}}}h.setStartBefore=p("setStartBefore","setEndBefore");h.setStartAfter=p("setStartAfter","setEndAfter");h.setEndBefore=p("setEndBefore","setStartBefore");h.setEndAfter=p("setEndAfter","setStartAfter");u.selectNodeContents(s);h.selectNodeContents=u.startContainer==
s&&u.endContainer==s&&0==u.startOffset&&u.endOffset==s.length?function(a){this.nativeRange.selectNodeContents(a);j(this)}:function(a){this.setStart(a,0);this.setEnd(a,l.getEndOffset(a))};u.selectNodeContents(s);u.setEnd(s,3);p=document.createRange();p.selectNodeContents(s);p.setEnd(s,4);p.setStart(s,2);h.compareBoundaryPoints=-1==u.compareBoundaryPoints(u.START_TO_END,p)&1==u.compareBoundaryPoints(u.END_TO_START,p)?function(a,b){b=b.nativeRange||b;a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&
(a=b.START_TO_END);return this.nativeRange.compareBoundaryPoints(a,b)}:function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};a.util.isHostMethod(u,"createContextualFragment")&&(h.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)});e.getBody(document).removeChild(s);u.detach();p.detach();a.createNativeRange=function(a){a=a||document;return a.createRange()}}else a.features.implementsTextRange&&(c=function(a){this.textRange=a;this.refresh()},
c.prototype=new l(document),c.prototype.refresh=function(){var a,c,d=this.textRange;a=d.parentElement();var g=d.duplicate();g.collapse(!0);c=g.parentElement();g=d.duplicate();g.collapse(!1);d=g.parentElement();c=c==d?c:e.getCommonAncestor(c,d);c=c==a?c:e.getCommonAncestor(a,c);0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?c=a=b(this.textRange,c,!0,!0):(a=b(this.textRange,c,!0,!1),c=b(this.textRange,c,!1,!1));this.setStart(a.node,a.offset);this.setEnd(c.node,c.offset)},l.copyComparisonConstants(c),
h=function(){return this}(),"undefined"==typeof h.Range&&(h.Range=c),a.createNativeRange=function(a){a=a||document;return a.body.createTextRange()});a.features.implementsTextRange&&(c.rangeToTextRange=function(a){if(a.collapsed)return d(new g(a.startContainer,a.startOffset),!0);var b=d(new g(a.startContainer,a.startOffset),!0),c=d(new g(a.endContainer,a.endOffset),!1);a=e.getDocument(a.startContainer).body.createTextRange();a.setEndPoint("StartToStart",b);a.setEndPoint("EndToEnd",c);return a});c.prototype.getName=
function(){return"WrappedRange"};a.WrappedRange=c;a.createRange=function(b){b=b||document;return new c(a.createNativeRange(b))};a.createRangyRange=function(a){a=a||document;return new l(a)};a.createIframeRange=function(b){return a.createRange(e.getIframeDocument(b))};a.createIframeRangyRange=function(b){return a.createRangyRange(e.getIframeDocument(b))};a.addCreateMissingNativeApiListener(function(b){b=b.document;"undefined"==typeof b.createRange&&(b.createRange=function(){return a.createRange(this)});
b=b=null})});
rangy.createModule("WrappedSelection",function(a,b){function d(a){return(a||window).getSelection()}function c(a){return(a||window).document.selection}function e(a,b,c){var d=c?"end":"start";c=c?"start":"end";a.anchorNode=b[d+"Container"];a.anchorOffset=b[d+"Offset"];a.focusNode=b[c+"Container"];a.focusOffset=b[c+"Offset"]}function g(a){a.anchorNode=a.focusNode=null;a.anchorOffset=a.focusOffset=0;a.rangeCount=0;a.isCollapsed=!0;a._ranges.length=0}function l(b){var c;b instanceof C?(c=b._selectionNativeRange,
c||(c=a.createNativeRange(q.getDocument(b.startContainer)),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset),b._selectionNativeRange=c,b.attachListener("detach",function(){this._selectionNativeRange=null}))):b instanceof r?c=b.nativeRange:a.features.implementsDomRange&&b instanceof q.getWindow(b.startContainer).Range&&(c=b);return c}function j(a){var b=a.getNodes(),c;a:if(!b.length||1!=b[0].nodeType)c=!1;else{c=1;for(var d=b.length;c<d;++c)if(!q.isAncestorOf(b[0],b[c])){c=
!1;break a}c=!0}if(!c)throw Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return b[0]}function h(a,b){var c=new r(b);a._ranges=[c];e(a,c,!1);a.rangeCount=1;a.isCollapsed=c.collapsed}function v(b){b._ranges.length=0;if("None"==b.docSelection.type)g(b);else{var c=b.docSelection.createRange();if(c&&"undefined"!=typeof c.text)h(b,c);else{b.rangeCount=c.length;for(var d,j=q.getDocument(c.item(0)),l=0;l<b.rangeCount;++l)d=a.createRange(j),d.selectNode(c.item(l)),
b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed;e(b,b._ranges[b.rangeCount-1],!1)}}}function p(a,b){for(var c=a.docSelection.createRange(),d=j(b),g=q.getDocument(c.item(0)),g=q.getBody(g).createControlRange(),e=0,h=c.length;e<h;++e)g.add(c.item(e));try{g.add(d)}catch(l){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}g.select();v(a)}function s(a,b,c){this.nativeSelection=a;this.docSelection=b;this._ranges=
[];this.win=c;this.refresh()}function u(a,b){for(var c=q.getDocument(b[0].startContainer),c=q.getBody(c).createControlRange(),d=0,g;d<rangeCount;++d){g=j(b[d]);try{c.add(g)}catch(e){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}c.select();v(a)}function x(a,b){if(a.anchorNode&&q.getDocument(a.anchorNode)!==q.getDocument(b))throw new F("WRONG_DOCUMENT_ERR");}function n(a){var b=[],c=new K(a.anchorNode,a.anchorOffset),
d=new K(a.focusNode,a.focusOffset),g="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var e=0,j=a.rangeCount;e<j;++e)b[e]=C.inspect(a.getRangeAt(e));return"["+g+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.requireModules(["DomUtil","DomRange","WrappedRange"]);a.config.checkSelectionRanges=!0;var q=a.dom,m=a.util,C=a.DomRange,r=a.WrappedRange,F=a.DOMException,K=q.DomPosition,G,E,A=a.util.isHostMethod(window,"getSelection"),
w=a.util.isHostObject(document,"selection"),J=w&&(!A||a.config.preferTextRange);J?(G=c,a.isSelectionValid=function(a){a=(a||window).document;var b=a.selection;return"None"!=b.type||q.getDocument(b.createRange().parentElement())==a}):A?(G=d,a.isSelectionValid=function(){return!0}):b.fail("Neither document.selection or window.getSelection() detected.");a.getNativeSelection=G;var A=G(),U=a.createNativeRange(document),t=q.getBody(document),N=m.areHostObjects(A,m.areHostProperties(A,["anchorOffset","focusOffset"]));
a.features.selectionHasAnchorAndFocus=N;var R=m.isHostMethod(A,"extend");a.features.selectionHasExtend=R;var V="number"==typeof A.rangeCount;a.features.selectionHasRangeCount=V;var S=!1,z=!0;if(m.areHostMethods(A,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof A.rangeCount&&a.features.implementsDomRange){var k=document.createElement("iframe");t.appendChild(k);z=q.getIframeDocument(k);z.open();z.write("<html><head></head><body>12</body></html>");z.close();var L=q.getIframeWindow(k).getSelection(),
D=z.documentElement.lastChild.firstChild,H=z.createRange();H.setStart(D,1);H.collapse(!0);L.addRange(H);z=1==L.rangeCount;L.removeAllRanges();var Q=H.cloneRange();H.setStart(D,0);Q.setEnd(D,2);L.addRange(H);L.addRange(Q);S=2==L.rangeCount;H.detach();Q.detach();t.removeChild(k)}a.features.selectionSupportsMultipleRanges=S;a.features.collapsedNonEditableSelectionsSupported=z;var I=!1;t&&m.isHostMethod(t,"createControlRange")&&(t=t.createControlRange(),m.areHostProperties(t,["item","add"])&&(I=!0));
a.features.implementsControlRange=I;E=N?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var T;m.isHostMethod(A,"getRangeAt")?T=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:N&&(T=function(b){var c=q.getDocument(b.anchorNode),c=a.createRange(c);c.setStart(b.anchorNode,b.anchorOffset);c.setEnd(b.focusNode,b.focusOffset);c.collapsed!==this.isCollapsed&&(c.setStart(b.focusNode,b.focusOffset),
c.setEnd(b.anchorNode,b.anchorOffset));return c});a.getSelection=function(a){a=a||window;var b=a._rangySelection,d=G(a),g=w?c(a):null;b?(b.nativeSelection=d,b.docSelection=g,b.refresh(a)):(b=new s(d,g,a),a._rangySelection=b);return b};a.getIframeSelection=function(b){return a.getSelection(q.getIframeWindow(b))};t=s.prototype;if(!J&&N&&m.areHostMethods(A,["removeAllRanges","addRange"])){t.removeAllRanges=function(){this.nativeSelection.removeAllRanges();g(this)};var O=function(b,c){var d=C.getRangeDocument(c),
d=a.createRange(d);d.collapseToPoint(c.endContainer,c.endOffset);b.nativeSelection.addRange(l(d));b.nativeSelection.extend(c.startContainer,c.startOffset);b.refresh()};t.addRange=V?function(b,c){if(I&&w&&"Control"==this.docSelection.type)p(this,b);else if(c&&R)O(this,b);else{var d;S?d=this.rangeCount:(this.removeAllRanges(),d=0);this.nativeSelection.addRange(l(b));this.rangeCount=this.nativeSelection.rangeCount;this.rangeCount==d+1?(a.config.checkSelectionRanges&&(d=T(this.nativeSelection,this.rangeCount-
1))&&!C.rangesEqual(d,b)&&(b=new r(d)),this._ranges[this.rangeCount-1]=b,e(this,b,P(this.nativeSelection)),this.isCollapsed=E(this)):this.refresh()}}:function(a,b){b&&R?O(this,a):(this.nativeSelection.addRange(l(a)),this.refresh())};t.setRanges=function(a){if(I&&1<a.length)u(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}}}else if(m.isHostMethod(A,"empty")&&m.isHostMethod(U,"select")&&I&&J)t.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=
this.docSelection.type){var a;if(this.anchorNode)a=q.getDocument(this.anchorNode);else if("Control"==this.docSelection.type){var b=this.docSelection.createRange();b.length&&(a=q.getDocument(b.item(0)).body.createTextRange())}a&&(a.body.createTextRange().select(),this.docSelection.empty())}}catch(c){}g(this)},t.addRange=function(a){"Control"==this.docSelection.type?p(this,a):(r.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,e(this,a,!1))},
t.setRanges=function(a){this.removeAllRanges();var b=a.length;1<b?u(this,a):b&&this.addRange(a[0])};else return b.fail("No means of selecting a Range or TextRange was found"),!1;t.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new F("INDEX_SIZE_ERR");return this._ranges[a]};var M;if(J)M=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=q.getBody(b.win.document).createTextRange(),c.collapse(!0));"Control"==b.docSelection.type?v(b):c&&"undefined"!=typeof c.text?
h(b,c):g(b)};else if(m.isHostMethod(A,"getRangeAt")&&"number"==typeof A.rangeCount)M=function(b){if(I&&w&&"Control"==b.docSelection.type)v(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;c<d;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));e(b,b._ranges[b.rangeCount-1],P(b.nativeSelection));b.isCollapsed=E(b)}else g(b)};else if(N&&"boolean"==typeof A.isCollapsed&&"boolean"==typeof U.collapsed&&a.features.implementsDomRange)M=
function(a){var b;b=a.nativeSelection;b.anchorNode?(b=T(b,0),a._ranges=[b],a.rangeCount=1,b=a.nativeSelection,a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset,a.isCollapsed=E(a)):g(a)};else return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;t.refresh=function(a){var b=a?this._ranges.slice(0):null;M(this);if(a){a=b.length;if(a!=this._ranges.length)return!1;for(;a--;)if(!C.rangesEqual(b[a],this._ranges[a]))return!1;
return!0}};var W=function(a,b){var c=a.getAllRanges(),d=!1;a.removeAllRanges();for(var e=0,j=c.length;e<j;++e)d||b!==c[e]?a.addRange(c[e]):d=!0;a.rangeCount||g(a)};t.removeRange=I?function(a){if("Control"==this.docSelection.type){var b=this.docSelection.createRange();a=j(a);for(var c=q.getDocument(b.item(0)),c=q.getBody(c).createControlRange(),d,g=!1,e=0,h=b.length;e<h;++e)d=b.item(e),d!==a||g?c.add(b.item(e)):g=!0;c.select();v(this)}else W(this,a)}:function(a){W(this,a)};var P;!J&&N&&a.features.implementsDomRange?
(P=function(a){var b=!1;a.anchorNode&&(b=1==q.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset));return b},t.isBackwards=function(){return P(this)}):P=t.isBackwards=function(){return!1};t.toString=function(){for(var a=[],b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")};t.collapse=function(b,c){x(this,b);var d=a.createRange(q.getDocument(b));d.collapseToPoint(b,c);this.removeAllRanges();this.addRange(d);this.isCollapsed=!0};t.collapseToStart=function(){if(this.rangeCount){var a=
this._ranges[0];this.collapse(a.startContainer,a.startOffset)}else throw new F("INVALID_STATE_ERR");};t.collapseToEnd=function(){if(this.rangeCount){var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)}else throw new F("INVALID_STATE_ERR");};t.selectAllChildren=function(b){x(this,b);var c=a.createRange(q.getDocument(b));c.selectNodeContents(b);this.removeAllRanges();this.addRange(c)};t.deleteFromDocument=function(){if(I&&w&&"Control"==this.docSelection.type){for(var a=this.docSelection.createRange(),
b;a.length;)b=a.item(0),a.remove(b),b.parentNode.removeChild(b);this.refresh()}else if(this.rangeCount){a=this.getAllRanges();this.removeAllRanges();b=0;for(var c=a.length;b<c;++b)a[b].deleteContents();this.addRange(a[c-1])}};t.getAllRanges=function(){return this._ranges.slice(0)};t.setSingleRange=function(a){this.setRanges([a])};t.containsNode=function(a,b){for(var c=0,d=this._ranges.length;c<d;++c)if(this._ranges[c].containsNode(a,b))return!0;return!1};t.toHtml=function(){var a="";if(this.rangeCount){for(var a=
C.getRangeDocument(this._ranges[0]).createElement("div"),b=0,c=this._ranges.length;b<c;++b)a.appendChild(this._ranges[b].cloneContents());a=a.innerHTML}return a};t.getName=function(){return"WrappedSelection"};t.inspect=function(){return n(this)};t.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null};s.inspect=n;a.Selection=s;a.selectionPrototype=t;a.addCreateMissingNativeApiListener(function(b){"undefined"==typeof b.getSelection&&(b.getSelection=function(){return a.getSelection(this)});
b=null})});
workpad.browser=function(){var a=navigator.userAgent,b=document.createElement("div"),d=-1!==a.indexOf("MSIE")&&-1===a.indexOf("Opera"),c=-1!==a.indexOf("Gecko")&&-1===a.indexOf("KHTML"),e=-1!==a.indexOf("AppleWebKit/");a.indexOf("Chrome/");a.indexOf("Opera/");var g={formatBlock:d,insertUnorderedList:d||e,insertOrderedList:d||e},l={insertHTML:c};return{USER_AGENT:a,supported:function(){var a=this.USER_AGENT.toLowerCase(),c="contentEditable"in b,d=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,
g=document.querySelector&&document.querySelectorAll,a=this.isIos()&&5>+(/ipad|iphone|ipod/.test(a)&&a.match(/ os (\d+).+? like mac os x/)||[,0])[1]||this.isAndroid()&&4>+(a.match(/android (\d+)/)||[,0])[1]||-1!==a.indexOf("opera mobi")||-1!==a.indexOf("hpwos/");return c&&d&&g&&!a},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},isTouchDevice:function(){return this.supportEvent("touchmove")},supportEvent:function(a){var c;
if(!(c="on"+a in b))b.setAttribute("on"+a,"return;"),c="function"===typeof b["on"+a];return c},supportsCommand:function(a,b){if(!g[b]){try{return a.queryCommandSupported(b)}catch(c){}try{return a.queryCommandEnabled(b)}catch(d){return!!l[b]}}return!1}}}();
(function(a){var b=["debug","info","warn","error"];a.util.debug=function(){var d=Array.prototype.slice.call(arguments),c=function(c,d,l){var j=b.indexOf(l),h=b.indexOf("debug");c=a.util.array(c).clone();c.unshift(console,d);return-1<j&&-1<h&&j>=h?console[l]?Function.prototype.bind.apply(console[l],c):Function.prototype.bind.apply(console.log,c):a.EMPTY_FUNCTION};return{error:c(d,"[WorkPad error!!!]: ","error"),debug:c(d,"[WorkPad debug]: ","debug"),info:c(d,"[WorkPad info]: ","info"),warn:c(d,"[Workpad warn!]: ",
"warn")}}})(workpad);
(function(){workpad.util.array=function(a){return{contains:function(b){if(a.indexOf)return-1!==a.indexOf(b);for(var d=0,c=a.length;d<c;d++)if(a[d]===b)return!0;return!1},without:function(b){b=workpad.util.array(b);for(var d=[],c=0,e=a.length;c<e;c++)b.contains(a[c])||d.push(a[c]);return d},get:function(){for(var b=0,d=a.length,c=[];b<d;b++)c.push(a[b]);return c},unique:function(){for(var b=[],d=0,c=a.length;d<c;d++)workpad.util.array(b).contains(a[d])||b.push(a[d]);return b},clone:function(){for(var b=
[],d=0,c=a.length;d<c;d++)b.push(a[d]);return b}}}})();(function(){var a=/^\s+/,b=/\s+$/;workpad.util.string=function(d){d=String(d);return{trim:function(){return d.replace(a,"").replace(b,"")},interpolate:function(a){for(var b in a)d=this.replace("#{"+b+"}").by(a[b]);return d},replace:function(a){return{by:function(b){return d.split(a).join(b)}}}}}})();
(function(){workpad.util.object=function(a){return{merge:function(b){for(var d in b)a[d]=b[d];return this},get:function(){return a},clone:function(){var b={},d;for(d in a)b[d]=a[d];return b},isArray:function(){return"[object Array]"===Object.prototype.toString.call(a)},safeJSON:function(){try{var b=JSON.parse(JSON.stringify(a))}catch(d){b={}}return b}}}})();
workpad.util.Events=Base.extend({on:function(a,b){this.events=this.events||{};this.events[a]=this.events[a]||[];this.events[a].push(b);return this},off:function(a,b){this.events=this.events||{};var d=0,c,e;if(a){c=this.events[a]||[];for(e=[];d<c.length;d++)c[d]!==b&&b&&e.push(c[d]);this.events[a]=e}else this.events={};return this},fire:function(a,b){this.events=this.events||{};for(var d=this.events[a]||[],c=0;c<d.length;c++)d[c].call(this,b);return this}});
workpad.data.predata=function(){return{EMPTY_DATA:[{content:"Begin to edit your workpad",description:"",id:"00000000-0000-0000-0000-000000000000",collapsed:!0,children:[]}]}}();workpad.data.check=function(a){return{isObject:function(){return"object"===typeof a&&"[object object]"===Object.prototype.toString.call(a).toLowerCase()&&!a.length}}};
(function(a){var b=a.util;a.data.pretty=function(d){return{get:function(){if(b.object(d).isArray()){for(var c=[],e=d.length,g=0;g<e;g++)if(a.data.check(d[g]).isObject())try{var l=JSON.stringify(d[g]);"{}"!==l&&c.push(JSON.parse(l))}catch(j){}1>c.length&&(c=a.data.predata.EMPTY_DATA);return c}return a.data.predata.EMPTY_DATA}}}})(workpad);
(function(a){var b=a.dom;b.addClass=function(a,c){var e=a.classList;if(e)return e.add(c);b.hasClass(a,c)||(a.className+=" "+c)};b.removeClass=function(a,b){var e=a.classList;if(e)return e.remove(b);a.className=a.className.replace(RegExp("(^|\\s+)"+b+"(\\s+|$)")," ")};b.hasClass=function(a,b){var e=a.classList;if(e)return e.contains(b);e=a.className;return 0<e.length&&(e==b||RegExp("(^|\\s)"+b+"(\\s|$)").test(e))}})(workpad);
(function(){var a={className:"class"};workpad.dom.setAttributes=function(b){return{on:function(d){for(var c in b)d.setAttribute(a[c]||c,b[c])}}}})();
workpad.dom.style=function(a){var b=workpad.dom,d={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},c=/\-[a-z]/g,e=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"];return{setto:function(b){b=b.style;if("string"===typeof a)b.cssText+=";"+a;else{a=workpad.util.object(a).safeJSON();for(var c in a)"float"===c?(b.cssFloat=a[c],b.styleFloat=a[c]):b[c]=a[c]}},getfrom:function(b){if(b.nodeType===workpad.ELEMENT_NODE){var e=b.ownerDocument,j=a,h=d[a]||
a.replace(c,function(a){return a.charAt(1).toUpperCase()}),v=b.style,p=b.currentStyle,s=v[h];if(s)return s;if(p)try{return p[h]}catch(u){}var h=e.defaultView||e.parentWindow,e=("height"===j||"width"===j)&&"TEXTAREA"===b.nodeName,x;if(h.getComputedStyle)return e&&(x=v.overflow,v.overflow="hidden"),b=h.getComputedStyle(b,null).getPropertyValue(j),e&&(v.overflow=x||""),b}},getNumberFrom:function(b){var c=this.getfrom(b),c=c?c.replace("px",""):0,c=parseFloat(c);return isNaN(c)?(workpad.util.debug("can't return a number about "+
a+" from ",b).error(),0):c},copyfrom:function(c){var d=a,j;a:{j=0;for(var h=e.length;j<h;j++)if("border-box"===b.style(e[j]).getfrom(c)){j=e[j];break a}j=void 0}(j=j?parseInt(b.style("width").getfrom(c),10)<c.offsetWidth:!1)&&(d=workpad.util.array(d).without(e));var v="";j=d.length;for(var h=0,p;h<j;h++)p=d[h],v+=p+":"+b.style(p).getfrom(c)+";";return{to:function(a){b.style(v).setto(a);return{andTo:arguments.callee}}}}}};
(function(a){a.dom.offset=function(b){var d=a.dom;return{get:function(){var a=b&&b.ownerDocument,d={top:0,left:0},g;if(a)return g=a.documentElement,"undefined"!==typeof b.getBoundingClientRect&&(d=b.getBoundingClientRect()),a=null!=a&&a===a.window?a:9===a.nodeType&&a.defaultView,{top:d.top+a.pageYOffset-g.clientTop,left:d.left+a.pageXOffset-g.clientLeft,width:d.width,height:d.height}},set:function(a){var e,g,l,j=d.style("position").getfrom(b),h={};"static"===j&&(b.style.position="relative");l=d.offset(b).get();
g=d.style("top").getfrom(b);e=d.style("left").getfrom(b);("absolute"===j||"fixed"===j)&&-1<(g+e).indexOf("auto")?(e=d.offset(b).position(),g=e.top,e=e.left):(g=parseFloat(g)||0,e=parseFloat(e)||0);null!=a.top&&(h.top=a.top-l.top+g+"px");null!=a.left&&(h.left=a.left-l.left+e+"px");null!=a.width&&(h.width=a.width+"px");null!=a.height&&(h.height=a.height+"px");d.style(h).setto(b)},offsetParent:function(){for(var a=b.offsetParent||document.documentElement;a&&!(a.nodeName&&"html"===a.nodeName.toLowerCase())&&
"static"===d.style("position").getfrom(a);)a=a.offsetParent;return a||document.documentElement},position:function(){if(b){var a,e,g={top:0,left:0};"fixed"===d.style("position").getfrom(b)?e=b.getBoundingClientRect():(a=d.offset(b).offsetParent(),e=d.offset(b).get(),a.nodeName&&"html"===a.nodeName.toLowerCase()||(g=d.offset(a).get()),g.top+=d.style("borderTopWidth").getNumberFrom(a),g.left+=d.style("borderLeftWidth").getNumberFrom(a));return{top:e.top-g.top-d.style("marginTop").getNumberFrom(a),left:e.left-
g.left-d.style("marginLeft").getNumberFrom(a)}}}}}})(workpad);workpad.dom.insert=function(a){return{after:function(b){b.parentNode.insertBefore(a,b.nextSibling)},before:function(b){b.parentNode.insertBefore(a,b)},into:function(b){b.appendChild(a)}}};
workpad.dom.observe=function(a,b,d){b="string"===typeof b?[b]:b;for(var c,e,g=0,l=b.length;g<l;g++)e=b[g],a.addEventListener?a.addEventListener(e,d,!1):(c=function(b){"target"in b||(b.target=b.srcElement);b.preventDefault=b.preventDefault||function(){this.returnValue=!1};b.stopPropagation=b.stopPropagation||function(){this.cancelBubble=!0};d.call(a,b)},a.attachEvent("on"+e,c));return{stop:function(){for(var e,g=0,l=b.length;g<l;g++)e=b[g],a.removeEventListener?a.removeEventListener(e,d,!1):a.detachEvent("on"+
e,c)}}};(function(a){a.dom.delegate=function(b,d,c,e){return a.dom.observe(b,c,function(c){for(var l=c.target,j=a.util.array(b.querySelectorAll(d));l&&l!==b;){if(j.contains(l)){e.call(l,c);break}l=l.parentNode}})}})(workpad);
workpad.dom.getParentElement=function(){function a(a,d){return!d||!d.length?!0:"string"===typeof d?a===d:workpad.util.array(d).contains(a)}return function(b,d,c){c=c||70;if(d.className||d.classRegExp){a:{var e=d.nodeName,g=d.className;for(d=d.classRegExp;c--&&b&&"BODY"!==b.nodeName;){var l;if(l=b.nodeType===workpad.ELEMENT_NODE)if(l=a(b.nodeName,e)){l=g;var j=d,j=j||l,j=(b.className||"").match(j)||[];l=!l?!!j.length:j[j.length-1]===l}if(l)break a;b=b.parentNode}b=null}return b}a:{e=d.nodeName;for(g=
c;g--&&b&&"BODY"!==b.nodeName;){if(a(b.nodeName,e))break a;b=b.parentNode}b=null}return b}}();
(function(a){var b=document;a.dom.editArea=Base.extend({constructor:function(b,c){var e=this;this.callback=b||a.EMPTY_FUNCTION;this.config=a.util.object({}).merge(c).get();this.editArea=this._createTextArea();setTimeout(function(){e.callback(e)},0)},insertInto:function(a){"string"===typeof a&&(a=b.getElementById(a));a.appendChild(this.editArea)},getEditArea:function(){return this.editArea},setContent:function(a){this.editArea.getElementsByTagName("textarea")[0].value=a;return this},getContent:function(){return this.editArea.getElementsByTagName("textarea")[0].value},
empty:function(){this.editArea.getElementsByTagName("textarea")[0].value="";return this},_createTextArea:function(){var a=b.createElement("div");textarea=b.createElement("textarea");a.className="workpad-editArea editor";a.appendChild(textarea);return a}})})(workpad);workpad.Commands=Base.extend({constructor:function(a){this.editor=a;this.composer=a.composer;this.doc=this.composer.doc},support:function(a){return workpad.browser.supportsCommand(this.doc,a)}});
workpad.views.View=Base.extend({constructor:function(a,b,d){this.parent=a;this.element=b;this.config=d},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(a){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}});
(function(a){var b=a.dom;a.views.Composer=a.views.View.extend({name:"composer",constructor:function(a,b,e){this.base(a,b,e);this.wp=this.parent.wp;this._initEditArea()},_initEditArea:function(){var a=this;this.editArea=new b.editArea(function(){a._create()});this.editAreaElement=this.editArea.getEditArea();var c=this.wp.element;b.insert(this.editAreaElement).after(c)},_create:function(){this.doc=document;this.element=this.wp;this.wp=this.parent.wp;this.commands=new a.Commands(this.parent);this.observe()}})})(workpad);
(function(a){var b=a.dom,d=a.util;a.views.Composer.prototype.observe=function(){var a=this,e=this.parent.element,g=this.editArea.getEditArea();pasteEvents=["drop","paste"];d.debug(e,g).debug();b.observe(g,"keydown",function(){});b.delegate(e,".content","mouseover",function(d){b.getParentElement(d.target,{nodeName:"DIV",className:"item"});var e=d.target.textContent;b.offset(g).set(b.offset(d.target).get());a.editArea.setContent(e)});b.delegate(e,".content","mouseout",function(){})}})(workpad);
(function(a){var b=a.data,d=a.util.debug;a.views.Wp=a.views.View.extend({name:"workpad",constructor:function(a,b,d){this.base(a,b,d);this._observe()},initContentByData:function(a){a=b.pretty(a).get();a=this.buildDomByDatas(a);this._setContent(a)},getElementByitemId:function(a){return this.element.querySelector(".item[data-id='"+a+"']")},getContentById:function(a){a=this.getElementByitemId(a);d(a).debug()},_setContent:function(a){this.element.innerHTML=a},_observe:function(){}})})(workpad);
(function(a){var b=a.util;a.views.Wp.prototype.buildDomByDatas=function(a){var b=this;return function g(a){for(var d="",h="",v=0,p=a.length;v<p;v++){var s=a[v];0<s.children.length&&s.collapse&&(h=g(s.children));d+=b.buildHTMLBySingleData({id:s.id,content:s.content,description:s.description,children:h});h=""}return d}(a)};a.views.Wp.prototype.buildHTMLBySingleData=function(a){return b.string('<div class="item" data-id="#{id}"><div class="maindata"><div class="content">#{content}</div><div class="description">#{description}</div></div><div class="children">#{children}</div></div>').interpolate(a)}})(workpad);
(function(a){var b={initContent:void 0};a.Init=a.util.Events.extend({constructor:function(d,c){this.element="string"===typeof d?document.getElementById(d):d;this.config=a.util.object({}).merge(b).merge(c).get();this.currentView=this.wp=new a.views.Wp(this,this.element,this.config);this._isCompatible=a.browser.supported();this.currentView=this.composer=new a.views.Composer(this,this.wp,this.config);this.wp.initContentByData(this.config.initContent)}})})(workpad);
//@ sourceMappingURL=workpad.js.map