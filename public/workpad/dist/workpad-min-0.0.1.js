/**
 Author: liuyixi
 this is lincence
*/
var workpad={version:"0.0.1",util:{},dom:{},commands:{},ui:{},views:{},log:{},data:{},EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,KEYS:{BACKSPACE_KEY:8,TAB_KEY:9,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,END_KEY:35,HOME_KEY:36,LEFT_KEY:37,UP_KEY:38,RIGHT_KEY:39,DOWN_KEY:40,DELETE_KEY:46,A_KEY:65,C_KEY:67,X_KEY:88,V_KEY:86,Z_KEY:90}},Base=function(){};
Base.extend=function(a,c){var b=Base.prototype.extend;Base._prototyping=!0;var d=new this;b.call(d,a);d.base=function(){};delete Base._prototyping;var f=d.constructor,j=d.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==j)this._constructing=!0,f.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||b).call(arguments[0],d)};j.ancestor=this;j.extend=this.extend;j.forEach=this.forEach;j.implement=this.implement;j.prototype=
d;j.toString=this.toString;j.valueOf=function(a){return"object"==a?j:f.valueOf()};b.call(j,c);"function"==typeof j.init&&j.init();return j};
Base.prototype={extend:function(a,c){if(1<arguments.length){var b=this[a];if(b&&"function"==typeof c&&(!b.valueOf||b.valueOf()!=c.valueOf())&&/\bbase\b/.test(c)){var d=c.valueOf();c=function(){var a=this.base||Base.prototype.base;this.base=b;var c=d.apply(this,arguments);this.base=a;return c};c.valueOf=function(a){return"object"==a?c:d};c.toString=Base.toString}this[a]=c}else if(a){var f=Base.prototype.extend;!Base._prototyping&&"function"!=typeof this&&(f=this.extend||f);for(var j={toSource:null},
l=["constructor","toString","valueOf"],k=Base._prototyping?0:1;g=l[k++];)a[g]!=j[g]&&f.call(this,g,a[g]);for(var g in a)j[g]||f.call(this,g,a[g])}return this}};
Base=Base.extend({constructor:function(a){this.extend(a)}},{ancestor:Object,version:"1.1",forEach:function(a,c,b){for(var d in a)void 0===this.prototype[d]&&c.call(b,a[d],d,a)},implement:function(){for(var a=0;a<arguments.length;a++)if("function"==typeof arguments[a])arguments[a](this.prototype);else this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}});
window.rangy=function(){function a(a,m){var b=typeof a[m];return b==v||!!(b==g&&a[m])||"unknown"==b}function c(a,m){return!!(typeof a[m]==g&&a[m])}function b(a,m){return typeof a[m]!=u}function d(a){return function(m,b){for(var c=b.length;c--;)if(!a(m,b[c]))return!1;return!0}}function f(a){return a&&q(a,n)&&C(a,y)}function j(a){window.alert("Rangy not supported in your browser. Reason: "+a);r.initialized=!0;r.supported=!1}function l(){if(!r.initialized){var m,b=!1,d=!1;a(document,"createRange")&&
(m=document.createRange(),q(m,t)&&C(m,p)&&(b=!0),m.detach());if((m=c(document,"body")?document.body:document.getElementsByTagName("body")[0])&&a(m,"createTextRange"))m=m.createTextRange(),f(m)&&(d=!0);!b&&!d&&j("Neither Range nor TextRange are implemented");r.initialized=!0;r.features={implementsDomRange:b,implementsTextRange:d};b=K.concat(F);d=0;for(m=b.length;d<m;++d)try{b[d](r)}catch(n){c(window,"console")&&a(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",
n)}}}function k(a){this.name=a;this.supported=this.initialized=!1}var g="object",v="function",u="undefined",p="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer START_TO_START START_TO_END END_TO_START END_TO_END".split(" "),t="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),
y="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),n="collapse compareEndPoints duplicate getBookmark moveToBookmark moveToElementText parentElement pasteHTML select setEndPoint getBoundingClientRect".split(" "),q=d(a),m=d(c),C=d(b),r={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:a,isHostObject:c,isHostProperty:b,areHostMethods:q,areHostObjects:m,areHostProperties:C,isTextRange:f},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};
r.fail=j;r.warn=function(a){a="Rangy warning: "+a;r.config.alertOnWarn?window.alert(a):typeof window.console!=u&&typeof window.console.log!=u&&window.console.log(a)};({}).hasOwnProperty?r.util.extend=function(a,m){for(var b in m)m.hasOwnProperty(b)&&(a[b]=m[b])}:j("hasOwnProperty not supported");var F=[],K=[];r.init=l;r.addInitListener=function(a){r.initialized?a(r):F.push(a)};var G=[];r.addCreateMissingNativeApiListener=function(a){G.push(a)};r.createMissingNativeApi=function(a){a=a||window;l();
for(var m=0,b=G.length;m<b;++m)G[m](a)};k.prototype.fail=function(a){this.initialized=!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+a);};k.prototype.warn=function(a){r.warn("Module "+this.name+": "+a)};k.prototype.createError=function(a){return Error("Error in Rangy "+this.name+" module: "+a)};r.createModule=function(a,m){var b=new k(a);r.modules[a]=b;K.push(function(a){m(a,b);b.initialized=!0;b.supported=!0})};r.requireModules=function(a){for(var m=0,b=a.length,c,d;m<
b;++m){d=a[m];c=r.modules[d];if(!c||!(c instanceof k))throw Error("Module '"+d+"' not found");if(!c.supported)throw Error("Module '"+d+"' not supported");}};var E=!1,m=function(){E||(E=!0,r.initialized||l())};if(typeof window==u)j("No window found");else if(typeof document==u)j("No document found");else return a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",m,!1),a(window,"addEventListener")?window.addEventListener("load",m,!1):a(window,"attachEvent")?window.attachEvent("onload",
m):j("Window does not have required addEventListener or attachEvent method"),r}();
rangy.createModule("DomUtil",function(a,c){function b(a){for(var b=0;a=a.previousSibling;)b++;return b}function d(a,b){var c=[],d;for(d=a;d;d=d.parentNode)c.push(d);for(d=b;d;d=d.parentNode)if(q(c,d))return d;return null}function f(a,b,c){for(c=c?a:a.parentNode;c;){a=c.parentNode;if(a===b)return c;c=a}return null}function j(a){a=a.nodeType;return 3==a||4==a||8==a}function l(a,b){var c=b.nextSibling,d=b.parentNode;c?d.insertBefore(a,c):d.appendChild(a);return a}function k(a){if(9==a.nodeType)return a;
if(typeof a.ownerDocument!=t)return a.ownerDocument;if(typeof a.document!=t)return a.document;if(a.parentNode)return k(a.parentNode);throw Error("getDocument: no document found for node");}function g(a){return!a?"[No node]":j(a)?'"'+a.data+'"':1==a.nodeType?"<"+a.nodeName+(a.id?' id="'+a.id+'"':"")+">["+a.childNodes.length+"]":a.nodeName}function v(a){this._next=this.root=a}function u(a,b){this.node=a;this.offset=b}function p(a){this.code=this[a];this.codeName=a;this.message="DOMException: "+this.codeName}
var t="undefined",y=a.util;y.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||c.fail("document missing a Node creation method");y.isHostMethod(document,"getElementsByTagName")||c.fail("document missing getElementsByTagName method");var n=document.createElement("div");y.areHostMethods(n,["insertBefore","appendChild","cloneNode"])||c.fail("Incomplete Element implementation");y.isHostProperty(n,"innerHTML")||c.fail("Element is missing innerHTML property");n=document.createTextNode("test");
y.areHostMethods(n,["splitText","deleteData","insertData","appendData","cloneNode"])||c.fail("Incomplete Text Node implementation");var q=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};v.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next,b;if(this._current){b=a.firstChild;if(!b)for(b=null;a!==this.root&&!(b=a.nextSibling);)a=a.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=
null}};u.prototype={equals:function(a){return this.node===a.node&this.offset==a.offset},inspect:function(){return"[DomPosition("+g(this.node)+":"+this.offset+")]"}};p.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};p.prototype.toString=function(){return this.message};a.dom={arrayContains:q,isHtmlNamespace:function(a){var b;return typeof a.namespaceURI==t||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==
b},parentElement:function(a){a=a.parentNode;return 1==a.nodeType?a:null},getNodeIndex:b,getNodeLength:function(a){var b;return j(a)?a.length:(b=a.childNodes)?b.length:0},getCommonAncestor:d,isAncestorOf:function(a,b,c){for(b=c?b:b.parentNode;b;){if(b===a)return!0;b=b.parentNode}return!1},getClosestAncestorIn:f,isCharacterDataNode:j,insertAfter:l,splitDataNode:function(a,b){var c=a.cloneNode(!1);c.deleteData(0,b);a.deleteData(b,a.length-b);l(c,a);return c},getDocument:k,getWindow:function(a){a=k(a);
if(typeof a.defaultView!=t)return a.defaultView;if(typeof a.parentWindow!=t)return a.parentWindow;throw Error("Cannot get a window object for node");},getIframeWindow:function(a){if(typeof a.contentWindow!=t)return a.contentWindow;if(typeof a.contentDocument!=t)return a.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element");},getIframeDocument:function(a){if(typeof a.contentDocument!=t)return a.contentDocument;if(typeof a.contentWindow!=t)return a.contentWindow.document;
throw Error("getIframeWindow: No Document object found for iframe element");},getBody:function(a){return y.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]},getRootContainer:function(a){for(var b;b=a.parentNode;)a=b;return a},comparePoints:function(a,c,n,q){var k;if(a==n)return c===q?0:c<q?-1:1;if(k=f(n,a,!0))return c<=b(k)?-1:1;if(k=f(a,n,!0))return b(k)<q?-1:1;c=d(a,n);a=a===c?c:f(a,c,!0);n=n===c?c:f(n,c,!0);if(a===n)throw Error("comparePoints got to case 4 and childA and childB are the same!");
for(c=c.firstChild;c;){if(c===a)return-1;if(c===n)return 1;c=c.nextSibling}throw Error("Should not be here!");},inspectNode:g,fragmentFromNodeChildren:function(a){for(var b=k(a).createDocumentFragment(),c;c=a.firstChild;)b.appendChild(c);return b},createIterator:function(a){return new v(a)},DomPosition:u};a.DOMException=p});
rangy.createModule("DomRange",function(a){function c(a,e){return 3!=a.nodeType&&(h.isAncestorOf(a,e.startContainer,!0)||h.isAncestorOf(a,e.endContainer,!0))}function b(a){return h.getDocument(a.startContainer)}function d(a,e,b){if(e=a._listeners[e])for(var c=0,d=e.length;c<d;++c)e[c].call(a,{target:a,args:b})}function f(a){return new L(a.parentNode,h.getNodeIndex(a))}function j(a){return new L(a.parentNode,h.getNodeIndex(a)+1)}function l(a,e,b){var c=11==a.nodeType?a.firstChild:a;h.isCharacterDataNode(e)?
b==e.length?h.insertAfter(a,e):e.parentNode.insertBefore(a,0==b?e:h.splitDataNode(e,b)):b>=e.childNodes.length?e.appendChild(a):e.insertBefore(a,e.childNodes[b]);return c}function k(a){for(var e,c,d=b(a.range).createDocumentFragment();c=a.next();){e=a.isPartiallySelectedSubtree();c=c.cloneNode(!e);e&&(e=a.getSubtreeIterator(),c.appendChild(k(e)),e.detach(!0));if(10==c.nodeType)throw new D("HIERARCHY_REQUEST_ERR");d.appendChild(c)}return d}function g(a,e,b){var c,d;for(b=b||{stop:!1};c=a.next();)if(a.isPartiallySelectedSubtree())if(!1===
e(c)){b.stop=!0;break}else{if(c=a.getSubtreeIterator(),g(c,e,b),c.detach(!0),b.stop)break}else for(c=h.createIterator(c);d=c.next();)if(!1===e(d)){b.stop=!0;return}}function v(a){for(var e;a.next();)a.isPartiallySelectedSubtree()?(e=a.getSubtreeIterator(),v(e),e.detach(!0)):a.remove()}function u(a){for(var e,c=b(a.range).createDocumentFragment(),d;e=a.next();){a.isPartiallySelectedSubtree()?(e=e.cloneNode(!1),d=a.getSubtreeIterator(),e.appendChild(u(d)),d.detach(!0)):a.remove();if(10==e.nodeType)throw new D("HIERARCHY_REQUEST_ERR");
c.appendChild(e)}return c}function p(a,e,b){var c=!(!e||!e.length),d,B=!!b;c&&(d=RegExp("^("+e.join("|")+")$"));var n=[];g(new y(a,!1),function(a){(!c||d.test(a.nodeType))&&(!B||b(a))&&n.push(a)});return n}function t(a){return"["+("undefined"==typeof a.getName?"Range":a.getName())+"("+h.inspectNode(a.startContainer)+":"+a.startOffset+", "+h.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function y(a,e){this.range=a;this.clonePartiallySelectedTextNodes=e;if(!a.collapsed){this.sc=a.startContainer;
this.so=a.startOffset;this.ec=a.endContainer;this.eo=a.endOffset;var b=a.commonAncestorContainer;this.sc===this.ec&&h.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===b&&!h.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:h.getClosestAncestorIn(this.sc,b,!0),this._last=this.ec===b&&!h.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:h.getClosestAncestorIn(this.ec,b,!0))}}function n(a){this.code=
this[a];this.codeName=a;this.message="RangeException: "+this.codeName}function q(a,e,b){this.nodes=p(a,e,b);this._next=this.nodes[0];this._position=0}function m(a){return function(e,b){for(var c,d=b?e:e.parentNode;d;){c=d.nodeType;if(h.arrayContains(a,c))return d;d=d.parentNode}return null}}function C(a,e){if(P(a,e))throw new n("INVALID_NODE_TYPE_ERR");}function r(a){if(!a.startContainer)throw new D("INVALID_STATE_ERR");}function F(a,e){if(!h.arrayContains(e,a.nodeType))throw new n("INVALID_NODE_TYPE_ERR");
}function K(a,e){if(0>e||e>(h.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new D("INDEX_SIZE_ERR");}function G(a,e){if(M(a,!0)!==M(e,!0))throw new D("WRONG_DOCUMENT_ERR");}function E(a){if(W(a,!0))throw new D("NO_MODIFICATION_ALLOWED_ERR");}function A(a,e){if(!a)throw new D(e);}function w(a){r(a);if(!h.arrayContains(Q,a.startContainer.nodeType)&&!M(a.startContainer,!0)||!h.arrayContains(Q,a.endContainer.nodeType)&&!M(a.endContainer,!0)||!(a.startOffset<=(h.isCharacterDataNode(a.startContainer)?
a.startContainer.length:a.startContainer.childNodes.length))||!(a.endOffset<=(h.isCharacterDataNode(a.endContainer)?a.endContainer.length:a.endContainer.childNodes.length)))throw Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")");}function J(){}function U(a){a.START_TO_START=X;a.START_TO_END=$;a.END_TO_END=ea;a.END_TO_START=aa;a.NODE_BEFORE=ba;a.NODE_AFTER=ca;a.NODE_BEFORE_AND_AFTER=da;a.NODE_INSIDE=Y}function s(a){U(a);U(a.prototype)}function N(a,e){return function(){w(this);
var b=this.startContainer,c=this.startOffset,d=this.commonAncestorContainer,n=new y(this,!0);b!==d&&(b=h.getClosestAncestorIn(b,d,!0),c=j(b),b=c.node,c=c.offset);g(n,E);n.reset();d=a(n);n.detach();e(this,b,c,b,c);return d}}function R(e,b,d){function n(a,e){return function(b){r(this);F(b,H);F(O(b),Q);b=(a?f:j)(b);(e?B:q)(this,b.node,b.offset)}}function B(a,e,c){var d=a.endContainer,x=a.endOffset;if(e!==a.startContainer||c!==a.startOffset){if(O(e)!=O(d)||1==h.comparePoints(e,c,d,x))d=e,x=c;b(a,e,c,
d,x)}}function q(a,e,c){var d=a.startContainer,x=a.startOffset;if(e!==a.endContainer||c!==a.endOffset){if(O(e)!=O(d)||-1==h.comparePoints(e,c,d,x))d=e,x=c;b(a,d,x,e,c)}}e.prototype=new J;a.util.extend(e.prototype,{setStart:function(a,e){r(this);C(a,!0);K(a,e);B(this,a,e)},setEnd:function(a,e){r(this);C(a,!0);K(a,e);q(this,a,e)},setStartBefore:n(!0,!0),setStartAfter:n(!1,!0),setEndBefore:n(!0,!1),setEndAfter:n(!1,!1),collapse:function(a){w(this);a?b(this,this.startContainer,this.startOffset,this.startContainer,
this.startOffset):b(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){r(this);C(a,!0);b(this,a,0,a,h.getNodeLength(a))},selectNode:function(a){r(this);C(a,!1);F(a,H);var e=f(a);a=j(a);b(this,e.node,e.offset,a.node,a.offset)},extractContents:N(u,b),deleteContents:N(v,b),canSurroundContents:function(){w(this);E(this.startContainer);E(this.endContainer);var a=new y(this,!0),e=a._first&&c(a._first,this)||a._last&&c(a._last,this);a.detach();return!e},
detach:function(){d(this)},splitBoundaries:function(){w(this);var a=this.startContainer,e=this.startOffset,c=this.endContainer,d=this.endOffset,x=a===c;h.isCharacterDataNode(c)&&0<d&&d<c.length&&h.splitDataNode(c,d);h.isCharacterDataNode(a)&&0<e&&e<a.length&&(a=h.splitDataNode(a,e),x?(d-=e,c=a):c==a.parentNode&&d>=h.getNodeIndex(a)&&d++,e=0);b(this,a,e,c,d)},normalizeBoundaries:function(){w(this);var a=this.startContainer,e=this.startOffset,c=this.endContainer,d=this.endOffset,x=function(a){var e=
a.nextSibling;e&&e.nodeType==a.nodeType&&(c=a,d=a.length,a.appendData(e.data),e.parentNode.removeChild(e))},n=function(b){var x=b.previousSibling;if(x&&x.nodeType==b.nodeType){a=b;var n=b.length;e=x.length;b.insertData(0,x.data);x.parentNode.removeChild(x);a==c?(d+=e,c=a):c==b.parentNode&&(x=h.getNodeIndex(b),d==x?(c=b,d=n):d>x&&d--)}},B=!0;h.isCharacterDataNode(c)?c.length==d&&x(c):(0<d&&(B=c.childNodes[d-1])&&h.isCharacterDataNode(B)&&x(B),B=!this.collapsed);B?h.isCharacterDataNode(a)?0==e&&n(a):
e<a.childNodes.length&&(x=a.childNodes[e])&&h.isCharacterDataNode(x)&&n(x):(a=c,e=d);b(this,a,e,c,d)},collapseToPoint:function(a,e){r(this);C(a,!0);K(a,e);(a!==this.startContainer||e!==this.startOffset||a!==this.endContainer||e!==this.endOffset)&&b(this,a,e,a,e)}});s(e)}function V(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;a.commonAncestorContainer=a.collapsed?a.startContainer:h.getCommonAncestor(a.startContainer,a.endContainer)}function S(a,e,b,c,n){var B=a.startContainer!==
e||a.startOffset!==b,q=a.endContainer!==c||a.endOffset!==n;a.startContainer=e;a.startOffset=b;a.endContainer=c;a.endOffset=n;V(a);d(a,"boundarychange",{startMoved:B,endMoved:q})}function z(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};V(this)}a.requireModules(["DomUtil"]);var h=a.dom,L=h.DomPosition,D=a.DOMException;y.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=
null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;a&&(this._next=a!==this._last?a.nextSibling:null,h.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so)));return a},remove:function(){var a=this._current,e,b;h.isCharacterDataNode(a)&&(a===this.sc||a===this.ec)?(e=a===this.sc?this.so:0,b=a===
this.ec?this.eo:a.length,e!=b&&a.deleteData(e,b-e)):a.parentNode&&a.parentNode.removeChild(a)},isPartiallySelectedSubtree:function(){return c(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new z(b(this.range));var e=this._current,c=e,d=0,n=e,B=h.getNodeLength(e);h.isAncestorOf(e,this.sc,!0)&&(c=this.sc,d=this.so);h.isAncestorOf(e,this.ec,!0)&&(n=this.ec,B=this.eo);S(a,c,d,n,B)}return new y(a,this.clonePartiallySelectedTextNodes)},
detach:function(a){a&&this.range.detach();this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};n.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};n.prototype.toString=function(){return this.message};q.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var H=[1,3,4,5,
7,8,10],Q=[2,9,11],I=[1,3,4,5,7,8,10,11],T=[1,3,4,5,7,8],O=h.getRootContainer,M=m([9,11]),W=m([5,6,10,12]),P=m([6,10,12]),e=document.createElement("style"),B=!1;try{e.innerHTML="<b>x</b>",B=3==e.firstChild.nodeType}catch(fa){}a.features.htmlParsingConforms=B;var Z="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),X=0,$=1,ea=2,aa=3,ba=0,ca=1,da=2,Y=3;J.prototype={attachListener:function(a,e){this._listeners[a].push(e)},compareBoundaryPoints:function(a,
e){w(this);G(this.startContainer,e.startContainer);var b=a==aa||a==X?"start":"end",c=a==$||a==X?"start":"end";return h.comparePoints(this[b+"Container"],this[b+"Offset"],e[c+"Container"],e[c+"Offset"])},insertNode:function(a){w(this);F(a,I);E(this.startContainer);if(h.isAncestorOf(a,this.startContainer,!0))throw new D("HIERARCHY_REQUEST_ERR");a=l(a,this.startContainer,this.startOffset);this.setStartBefore(a)},cloneContents:function(){w(this);var a,e;if(this.collapsed)return b(this).createDocumentFragment();
if(this.startContainer===this.endContainer&&h.isCharacterDataNode(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),e=b(this).createDocumentFragment(),e.appendChild(a),e;e=new y(this,!0);a=k(e);e.detach();return a},canSurroundContents:function(){w(this);E(this.startContainer);E(this.endContainer);var a=new y(this,!0),e=a._first&&c(a._first,this)||a._last&&c(a._last,this);a.detach();return!e},surroundContents:function(a){F(a,T);if(!this.canSurroundContents())throw new n("BAD_BOUNDARYPOINTS_ERR");
var e=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);l(a,this.startContainer,this.startOffset);a.appendChild(e);this.selectNode(a)},cloneRange:function(){w(this);for(var a=new z(b(this)),e=Z.length,c;e--;)c=Z[e],a[c]=this[c];return a},toString:function(){w(this);var a=this.startContainer;if(a===this.endContainer&&h.isCharacterDataNode(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var e=[],a=new y(this,!0);g(a,function(a){(3==
a.nodeType||4==a.nodeType)&&e.push(a.data)});a.detach();return e.join("")},compareNode:function(a){w(this);var e=a.parentNode,b=h.getNodeIndex(a);if(!e)throw new D("NOT_FOUND_ERR");a=this.comparePoint(e,b);e=this.comparePoint(e,b+1);return 0>a?0<e?da:ba:0<e?ca:Y},comparePoint:function(a,e){w(this);A(a,"HIERARCHY_REQUEST_ERR");G(a,this.startContainer);return 0>h.comparePoints(a,e,this.startContainer,this.startOffset)?-1:0<h.comparePoints(a,e,this.endContainer,this.endOffset)?1:0},createContextualFragment:B?
function(a){var e=this.startContainer,b=h.getDocument(e);if(!e)throw new D("INVALID_STATE_ERR");var c=null;1==e.nodeType?c=e:h.isCharacterDataNode(e)&&(c=h.parentElement(e));c=null===c||"HTML"==c.nodeName&&h.isHtmlNamespace(h.getDocument(c).documentElement)&&h.isHtmlNamespace(c)?b.createElement("body"):c.cloneNode(!1);c.innerHTML=a;return h.fragmentFromNodeChildren(c)}:function(a){r(this);var e=b(this).createElement("body");e.innerHTML=a;return h.fragmentFromNodeChildren(e)},toHtml:function(){w(this);
var a=b(this).createElement("div");a.appendChild(this.cloneContents());return a.innerHTML},intersectsNode:function(a,e){w(this);A(a,"NOT_FOUND_ERR");if(h.getDocument(a)!==b(this))return!1;var c=a.parentNode,d=h.getNodeIndex(a);A(c,"NOT_FOUND_ERR");var n=h.comparePoints(c,d,this.endContainer,this.endOffset),c=h.comparePoints(c,d+1,this.startContainer,this.startOffset);return e?0>=n&&0<=c:0>n&&0<c},isPointInRange:function(a,e){w(this);A(a,"HIERARCHY_REQUEST_ERR");G(a,this.startContainer);return 0<=
h.comparePoints(a,e,this.startContainer,this.startOffset)&&0>=h.comparePoints(a,e,this.endContainer,this.endOffset)},intersectsRange:function(a,e){w(this);if(b(a)!=b(this))throw new D("WRONG_DOCUMENT_ERR");var c=h.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),d=h.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);return e?0>=c&&0<=d:0>c&&0<d},intersection:function(a){if(this.intersectsRange(a)){var e=h.comparePoints(this.startContainer,
this.startOffset,a.startContainer,a.startOffset),b=h.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),c=this.cloneRange();-1==e&&c.setStart(a.startContainer,a.startOffset);1==b&&c.setEnd(a.endContainer,a.endOffset);return c}return null},union:function(a){if(this.intersectsRange(a,!0)){var e=this.cloneRange();-1==h.comparePoints(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&e.setStart(a.startContainer,a.startOffset);1==h.comparePoints(a.endContainer,
a.endOffset,this.endContainer,this.endOffset)&&e.setEnd(a.endContainer,a.endOffset);return e}throw new n("Ranges do not intersect");},containsNode:function(a,e){return e?this.intersectsNode(a,!1):this.compareNode(a)==Y},containsNodeContents:function(a){return 0<=this.comparePoint(a,0)&&0>=this.comparePoint(a,h.getNodeLength(a))},containsRange:function(a){return this.intersection(a).equals(a)},containsNodeText:function(a){var e=this.cloneRange();e.selectNode(a);var b=e.getNodes([3]);return 0<b.length?
(e.setStart(b[0],0),a=b.pop(),e.setEnd(a,a.length),a=this.containsRange(e),e.detach(),a):this.containsNodeContents(a)},createNodeIterator:function(a,e){w(this);return new q(this,a,e)},getNodes:function(a,e){w(this);return p(this,a,e)},getDocument:function(){return b(this)},collapseBefore:function(a){r(this);this.setEndBefore(a);this.collapse(!1)},collapseAfter:function(a){r(this);this.setStartAfter(a);this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return z.rangesEqual(this,
a)},inspect:function(){return t(this)}};R(z,S,function(a){r(a);a.startContainer=a.startOffset=a.endContainer=a.endOffset=null;a.collapsed=a.commonAncestorContainer=null;d(a,"detach",null);a._listeners=null});a.rangePrototype=J.prototype;z.rangeProperties=Z;z.RangeIterator=y;z.copyComparisonConstants=s;z.createPrototypeRange=R;z.inspect=t;z.getRangeDocument=b;z.rangesEqual=function(a,e){return a.startContainer===e.startContainer&&a.startOffset===e.startOffset&&a.endContainer===e.endContainer&&a.endOffset===
e.endOffset};a.DomRange=z;a.RangeException=n});
rangy.createModule("WrappedRange",function(a){function c(a,b,c,d){var k=a.duplicate();k.collapse(c);var g=k.parentElement();f.isAncestorOf(b,g,!0)||(g=b);if(!g.canHaveHTML)return new j(g.parentNode,f.getNodeIndex(g));b=f.getDocument(g).createElement("span");var l,p=c?"StartToStart":"StartToEnd";do g.insertBefore(b,b.previousSibling),k.moveToElementText(b);while(0<(l=k.compareEndPoints(p,a))&&b.previousSibling);p=b.nextSibling;if(-1==l&&p&&f.isCharacterDataNode(p)){k.setEndPoint(c?"EndToStart":"EndToEnd",
a);if(/[\r\n]/.test(p.data)){g=k.duplicate();c=g.text.replace(/\r\n/g,"\r").length;for(c=g.moveStart("character",c);-1==g.compareEndPoints("StartToEnd",g);)c++,g.moveStart("character",1)}else c=k.text.length;g=new j(p,c)}else p=(d||!c)&&b.previousSibling,g=(c=(d||c)&&b.nextSibling)&&f.isCharacterDataNode(c)?new j(c,0):p&&f.isCharacterDataNode(p)?new j(p,p.length):new j(g,f.getNodeIndex(b));b.parentNode.removeChild(b);return g}function b(a,b){var c,d,k=a.offset,g=f.getDocument(a.node),j=g.body.createTextRange(),
l=f.isCharacterDataNode(a.node);l?(c=a.node,d=c.parentNode):(c=a.node.childNodes,c=k<c.length?c[k]:null,d=a.node);g=g.createElement("span");g.innerHTML="&#feff;";c?d.insertBefore(g,c):d.appendChild(g);j.moveToElementText(g);j.collapse(!b);d.removeChild(g);if(l)j[b?"moveStart":"moveEnd"]("character",k);return j}a.requireModules(["DomUtil","DomRange"]);var d,f=a.dom,j=f.DomPosition,l=a.DomRange;if(a.features.implementsDomRange&&(!a.features.implementsTextRange||!a.config.preferTextRange)){var k=function(a){for(var b=
v.length,c;b--;)c=v[b],a[c]=a.nativeRange[c]},g,v=l.rangeProperties,u;d=function(a){if(!a)throw Error("Range must be specified");this.nativeRange=a;k(this)};l.createPrototypeRange(d,function(a,b,c,d,f){var g=a.endContainer!==d||a.endOffset!=f;if(a.startContainer!==b||a.startOffset!=c||g)a.setEnd(d,f),a.setStart(b,c)},function(a){a.nativeRange.detach();a.detached=!0;for(var b=v.length,c;b--;)c=v[b],a[c]=null});g=d.prototype;g.selectNode=function(a){this.nativeRange.selectNode(a);k(this)};g.deleteContents=
function(){this.nativeRange.deleteContents();k(this)};g.extractContents=function(){var a=this.nativeRange.extractContents();k(this);return a};g.cloneContents=function(){return this.nativeRange.cloneContents()};g.surroundContents=function(a){this.nativeRange.surroundContents(a);k(this)};g.collapse=function(a){this.nativeRange.collapse(a);k(this)};g.cloneRange=function(){return new d(this.nativeRange.cloneRange())};g.refresh=function(){k(this)};g.toString=function(){return this.nativeRange.toString()};
var p=document.createTextNode("test");f.getBody(document).appendChild(p);var t=document.createRange();t.setStart(p,0);t.setEnd(p,0);try{t.setStart(p,1),g.setStart=function(a,b){this.nativeRange.setStart(a,b);k(this)},g.setEnd=function(a,b){this.nativeRange.setEnd(a,b);k(this)},u=function(a){return function(b){this.nativeRange[a](b);k(this)}}}catch(y){g.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(c){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}k(this)},g.setEnd=function(a,
b){try{this.nativeRange.setEnd(a,b)}catch(c){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}k(this)},u=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(d){this.nativeRange[b](c),this.nativeRange[a](c)}k(this)}}}g.setStartBefore=u("setStartBefore","setEndBefore");g.setStartAfter=u("setStartAfter","setEndAfter");g.setEndBefore=u("setEndBefore","setStartBefore");g.setEndAfter=u("setEndAfter","setStartAfter");t.selectNodeContents(p);g.selectNodeContents=t.startContainer==
p&&t.endContainer==p&&0==t.startOffset&&t.endOffset==p.length?function(a){this.nativeRange.selectNodeContents(a);k(this)}:function(a){this.setStart(a,0);this.setEnd(a,l.getEndOffset(a))};t.selectNodeContents(p);t.setEnd(p,3);u=document.createRange();u.selectNodeContents(p);u.setEnd(p,4);u.setStart(p,2);g.compareBoundaryPoints=-1==t.compareBoundaryPoints(t.START_TO_END,u)&1==t.compareBoundaryPoints(t.END_TO_START,u)?function(a,b){b=b.nativeRange||b;a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&
(a=b.START_TO_END);return this.nativeRange.compareBoundaryPoints(a,b)}:function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};a.util.isHostMethod(t,"createContextualFragment")&&(g.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)});f.getBody(document).removeChild(p);t.detach();u.detach();a.createNativeRange=function(a){a=a||document;return a.createRange()}}else a.features.implementsTextRange&&(d=function(a){this.textRange=a;this.refresh()},
d.prototype=new l(document),d.prototype.refresh=function(){var a,b,d=this.textRange;a=d.parentElement();var g=d.duplicate();g.collapse(!0);b=g.parentElement();g=d.duplicate();g.collapse(!1);d=g.parentElement();b=b==d?b:f.getCommonAncestor(b,d);b=b==a?b:f.getCommonAncestor(a,b);0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?b=a=c(this.textRange,b,!0,!0):(a=c(this.textRange,b,!0,!1),b=c(this.textRange,b,!1,!1));this.setStart(a.node,a.offset);this.setEnd(b.node,b.offset)},l.copyComparisonConstants(d),
g=function(){return this}(),"undefined"==typeof g.Range&&(g.Range=d),a.createNativeRange=function(a){a=a||document;return a.body.createTextRange()});a.features.implementsTextRange&&(d.rangeToTextRange=function(a){if(a.collapsed)return b(new j(a.startContainer,a.startOffset),!0);var c=b(new j(a.startContainer,a.startOffset),!0),d=b(new j(a.endContainer,a.endOffset),!1);a=f.getDocument(a.startContainer).body.createTextRange();a.setEndPoint("StartToStart",c);a.setEndPoint("EndToEnd",d);return a});d.prototype.getName=
function(){return"WrappedRange"};a.WrappedRange=d;a.createRange=function(b){b=b||document;return new d(a.createNativeRange(b))};a.createRangyRange=function(a){a=a||document;return new l(a)};a.createIframeRange=function(b){return a.createRange(f.getIframeDocument(b))};a.createIframeRangyRange=function(b){return a.createRangyRange(f.getIframeDocument(b))};a.addCreateMissingNativeApiListener(function(b){b=b.document;"undefined"==typeof b.createRange&&(b.createRange=function(){return a.createRange(this)});
b=b=null})});
rangy.createModule("WrappedSelection",function(a,c){function b(a){return(a||window).getSelection()}function d(a){return(a||window).document.selection}function f(a,b,c){var d=c?"end":"start";c=c?"start":"end";a.anchorNode=b[d+"Container"];a.anchorOffset=b[d+"Offset"];a.focusNode=b[c+"Container"];a.focusOffset=b[c+"Offset"]}function j(a){a.anchorNode=a.focusNode=null;a.anchorOffset=a.focusOffset=0;a.rangeCount=0;a.isCollapsed=!0;a._ranges.length=0}function l(e){var b;e instanceof C?(b=e._selectionNativeRange,
b||(b=a.createNativeRange(q.getDocument(e.startContainer)),b.setEnd(e.endContainer,e.endOffset),b.setStart(e.startContainer,e.startOffset),e._selectionNativeRange=b,e.attachListener("detach",function(){this._selectionNativeRange=null}))):e instanceof r?b=e.nativeRange:a.features.implementsDomRange&&e instanceof q.getWindow(e.startContainer).Range&&(b=e);return b}function k(a){var b=a.getNodes(),c;a:if(!b.length||1!=b[0].nodeType)c=!1;else{c=1;for(var d=b.length;c<d;++c)if(!q.isAncestorOf(b[0],b[c])){c=
!1;break a}c=!0}if(!c)throw Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return b[0]}function g(a,b){var c=new r(b);a._ranges=[c];f(a,c,!1);a.rangeCount=1;a.isCollapsed=c.collapsed}function v(b){b._ranges.length=0;if("None"==b.docSelection.type)j(b);else{var c=b.docSelection.createRange();if(c&&"undefined"!=typeof c.text)g(b,c);else{b.rangeCount=c.length;for(var d,k=q.getDocument(c.item(0)),h=0;h<b.rangeCount;++h)d=a.createRange(k),d.selectNode(c.item(h)),
b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed;f(b,b._ranges[b.rangeCount-1],!1)}}}function u(a,b){for(var c=a.docSelection.createRange(),d=k(b),f=q.getDocument(c.item(0)),f=q.getBody(f).createControlRange(),g=0,h=c.length;g<h;++g)f.add(c.item(g));try{f.add(d)}catch(j){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}f.select();v(a)}function p(a,b,c){this.nativeSelection=a;this.docSelection=b;this._ranges=
[];this.win=c;this.refresh()}function t(a,b){for(var c=q.getDocument(b[0].startContainer),c=q.getBody(c).createControlRange(),d=0,f;d<rangeCount;++d){f=k(b[d]);try{c.add(f)}catch(g){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}c.select();v(a)}function y(a,b){if(a.anchorNode&&q.getDocument(a.anchorNode)!==q.getDocument(b))throw new F("WRONG_DOCUMENT_ERR");}function n(a){var b=[],c=new K(a.anchorNode,a.anchorOffset),
d=new K(a.focusNode,a.focusOffset),f="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var g=0,k=a.rangeCount;g<k;++g)b[g]=C.inspect(a.getRangeAt(g));return"["+f+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.requireModules(["DomUtil","DomRange","WrappedRange"]);a.config.checkSelectionRanges=!0;var q=a.dom,m=a.util,C=a.DomRange,r=a.WrappedRange,F=a.DOMException,K=q.DomPosition,G,E,A=a.util.isHostMethod(window,"getSelection"),
w=a.util.isHostObject(document,"selection"),J=w&&(!A||a.config.preferTextRange);J?(G=d,a.isSelectionValid=function(a){a=(a||window).document;var b=a.selection;return"None"!=b.type||q.getDocument(b.createRange().parentElement())==a}):A?(G=b,a.isSelectionValid=function(){return!0}):c.fail("Neither document.selection or window.getSelection() detected.");a.getNativeSelection=G;var A=G(),U=a.createNativeRange(document),s=q.getBody(document),N=m.areHostObjects(A,m.areHostProperties(A,["anchorOffset","focusOffset"]));
a.features.selectionHasAnchorAndFocus=N;var R=m.isHostMethod(A,"extend");a.features.selectionHasExtend=R;var V="number"==typeof A.rangeCount;a.features.selectionHasRangeCount=V;var S=!1,z=!0;if(m.areHostMethods(A,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof A.rangeCount&&a.features.implementsDomRange){var h=document.createElement("iframe");s.appendChild(h);z=q.getIframeDocument(h);z.open();z.write("<html><head></head><body>12</body></html>");z.close();var L=q.getIframeWindow(h).getSelection(),
D=z.documentElement.lastChild.firstChild,H=z.createRange();H.setStart(D,1);H.collapse(!0);L.addRange(H);z=1==L.rangeCount;L.removeAllRanges();var Q=H.cloneRange();H.setStart(D,0);Q.setEnd(D,2);L.addRange(H);L.addRange(Q);S=2==L.rangeCount;H.detach();Q.detach();s.removeChild(h)}a.features.selectionSupportsMultipleRanges=S;a.features.collapsedNonEditableSelectionsSupported=z;var I=!1;s&&m.isHostMethod(s,"createControlRange")&&(s=s.createControlRange(),m.areHostProperties(s,["item","add"])&&(I=!0));
a.features.implementsControlRange=I;E=N?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var T;m.isHostMethod(A,"getRangeAt")?T=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:N&&(T=function(b){var c=q.getDocument(b.anchorNode),c=a.createRange(c);c.setStart(b.anchorNode,b.anchorOffset);c.setEnd(b.focusNode,b.focusOffset);c.collapsed!==this.isCollapsed&&(c.setStart(b.focusNode,b.focusOffset),
c.setEnd(b.anchorNode,b.anchorOffset));return c});a.getSelection=function(a){a=a||window;var b=a._rangySelection,c=G(a),f=w?d(a):null;b?(b.nativeSelection=c,b.docSelection=f,b.refresh(a)):(b=new p(c,f,a),a._rangySelection=b);return b};a.getIframeSelection=function(b){return a.getSelection(q.getIframeWindow(b))};s=p.prototype;if(!J&&N&&m.areHostMethods(A,["removeAllRanges","addRange"])){s.removeAllRanges=function(){this.nativeSelection.removeAllRanges();j(this)};var O=function(b,c){var d=C.getRangeDocument(c),
d=a.createRange(d);d.collapseToPoint(c.endContainer,c.endOffset);b.nativeSelection.addRange(l(d));b.nativeSelection.extend(c.startContainer,c.startOffset);b.refresh()};s.addRange=V?function(b,c){if(I&&w&&"Control"==this.docSelection.type)u(this,b);else if(c&&R)O(this,b);else{var d;S?d=this.rangeCount:(this.removeAllRanges(),d=0);this.nativeSelection.addRange(l(b));this.rangeCount=this.nativeSelection.rangeCount;this.rangeCount==d+1?(a.config.checkSelectionRanges&&(d=T(this.nativeSelection,this.rangeCount-
1))&&!C.rangesEqual(d,b)&&(b=new r(d)),this._ranges[this.rangeCount-1]=b,f(this,b,P(this.nativeSelection)),this.isCollapsed=E(this)):this.refresh()}}:function(a,b){b&&R?O(this,a):(this.nativeSelection.addRange(l(a)),this.refresh())};s.setRanges=function(a){if(I&&1<a.length)t(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}}}else if(m.isHostMethod(A,"empty")&&m.isHostMethod(U,"select")&&I&&J)s.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=
this.docSelection.type){var a;if(this.anchorNode)a=q.getDocument(this.anchorNode);else if("Control"==this.docSelection.type){var b=this.docSelection.createRange();b.length&&(a=q.getDocument(b.item(0)).body.createTextRange())}a&&(a.body.createTextRange().select(),this.docSelection.empty())}}catch(c){}j(this)},s.addRange=function(a){"Control"==this.docSelection.type?u(this,a):(r.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,f(this,a,!1))},
s.setRanges=function(a){this.removeAllRanges();var b=a.length;1<b?t(this,a):b&&this.addRange(a[0])};else return c.fail("No means of selecting a Range or TextRange was found"),!1;s.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new F("INDEX_SIZE_ERR");return this._ranges[a]};var M;if(J)M=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=q.getBody(b.win.document).createTextRange(),c.collapse(!0));"Control"==b.docSelection.type?v(b):c&&"undefined"!=typeof c.text?
g(b,c):j(b)};else if(m.isHostMethod(A,"getRangeAt")&&"number"==typeof A.rangeCount)M=function(b){if(I&&w&&"Control"==b.docSelection.type)v(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;c<d;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));f(b,b._ranges[b.rangeCount-1],P(b.nativeSelection));b.isCollapsed=E(b)}else j(b)};else if(N&&"boolean"==typeof A.isCollapsed&&"boolean"==typeof U.collapsed&&a.features.implementsDomRange)M=
function(a){var b;b=a.nativeSelection;b.anchorNode?(b=T(b,0),a._ranges=[b],a.rangeCount=1,b=a.nativeSelection,a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset,a.isCollapsed=E(a)):j(a)};else return c.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;s.refresh=function(a){var b=a?this._ranges.slice(0):null;M(this);if(a){a=b.length;if(a!=this._ranges.length)return!1;for(;a--;)if(!C.rangesEqual(b[a],this._ranges[a]))return!1;
return!0}};var W=function(a,b){var c=a.getAllRanges(),d=!1;a.removeAllRanges();for(var f=0,g=c.length;f<g;++f)d||b!==c[f]?a.addRange(c[f]):d=!0;a.rangeCount||j(a)};s.removeRange=I?function(a){if("Control"==this.docSelection.type){var b=this.docSelection.createRange();a=k(a);for(var c=q.getDocument(b.item(0)),c=q.getBody(c).createControlRange(),d,f=!1,g=0,h=b.length;g<h;++g)d=b.item(g),d!==a||f?c.add(b.item(g)):f=!0;c.select();v(this)}else W(this,a)}:function(a){W(this,a)};var P;!J&&N&&a.features.implementsDomRange?
(P=function(a){var b=!1;a.anchorNode&&(b=1==q.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset));return b},s.isBackwards=function(){return P(this)}):P=s.isBackwards=function(){return!1};s.toString=function(){for(var a=[],b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")};s.collapse=function(b,c){y(this,b);var d=a.createRange(q.getDocument(b));d.collapseToPoint(b,c);this.removeAllRanges();this.addRange(d);this.isCollapsed=!0};s.collapseToStart=function(){if(this.rangeCount){var a=
this._ranges[0];this.collapse(a.startContainer,a.startOffset)}else throw new F("INVALID_STATE_ERR");};s.collapseToEnd=function(){if(this.rangeCount){var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)}else throw new F("INVALID_STATE_ERR");};s.selectAllChildren=function(b){y(this,b);var c=a.createRange(q.getDocument(b));c.selectNodeContents(b);this.removeAllRanges();this.addRange(c)};s.deleteFromDocument=function(){if(I&&w&&"Control"==this.docSelection.type){for(var a=this.docSelection.createRange(),
b;a.length;)b=a.item(0),a.remove(b),b.parentNode.removeChild(b);this.refresh()}else if(this.rangeCount){a=this.getAllRanges();this.removeAllRanges();b=0;for(var c=a.length;b<c;++b)a[b].deleteContents();this.addRange(a[c-1])}};s.getAllRanges=function(){return this._ranges.slice(0)};s.setSingleRange=function(a){this.setRanges([a])};s.containsNode=function(a,b){for(var c=0,d=this._ranges.length;c<d;++c)if(this._ranges[c].containsNode(a,b))return!0;return!1};s.toHtml=function(){var a="";if(this.rangeCount){for(var a=
C.getRangeDocument(this._ranges[0]).createElement("div"),b=0,c=this._ranges.length;b<c;++b)a.appendChild(this._ranges[b].cloneContents());a=a.innerHTML}return a};s.getName=function(){return"WrappedSelection"};s.inspect=function(){return n(this)};s.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null};p.inspect=n;a.Selection=p;a.selectionPrototype=s;a.addCreateMissingNativeApiListener(function(b){"undefined"==typeof b.getSelection&&(b.getSelection=function(){return a.getSelection(this)});
b=null})});
workpad.browser=function(){var a=navigator.userAgent,c=document.createElement("div"),b=-1!==a.indexOf("MSIE")&&-1===a.indexOf("Opera"),d=-1!==a.indexOf("Gecko")&&-1===a.indexOf("KHTML"),f=-1!==a.indexOf("AppleWebKit/");a.indexOf("Chrome/");a.indexOf("Opera/");var j={formatBlock:b,insertUnorderedList:b||f,insertOrderedList:b||f},l={insertHTML:d};return{USER_AGENT:a,supported:function(){var a=this.USER_AGENT.toLowerCase(),b="contentEditable"in c,d=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,
f=document.querySelector&&document.querySelectorAll,a=this.isIos()&&5>+(/ipad|iphone|ipod/.test(a)&&a.match(/ os (\d+).+? like mac os x/)||[,0])[1]||this.isAndroid()&&4>+(a.match(/android (\d+)/)||[,0])[1]||-1!==a.indexOf("opera mobi")||-1!==a.indexOf("hpwos/");return b&&d&&f&&!a},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},isTouchDevice:function(){return this.supportEvent("touchmove")},supportEvent:function(a){var b;
if(!(b="on"+a in c))c.setAttribute("on"+a,"return;"),b="function"===typeof c["on"+a];return b},supportsCommand:function(a,b){if(!j[b]){try{return a.queryCommandSupported(b)}catch(c){}try{return a.queryCommandEnabled(b)}catch(d){return!!l[b]}}return!1}}}();
(function(a){var c=["debug","info","warn","error"];a.util.debug=function(){var b=Array.prototype.slice.call(arguments),d=function(b,d,l){var k=c.indexOf(l),g=c.indexOf("debug");b=a.util.array(b).clone();b.unshift(console,d);return-1<k&&-1<g&&k>=g?console[l]?Function.prototype.bind.apply(console[l],b):Function.prototype.bind.apply(console.log,b):a.EMPTY_FUNCTION};return{error:d(b,"[WorkPad error!!!]: ","error"),debug:d(b,"[WorkPad debug]: ","debug"),info:d(b,"[WorkPad info]: ","info"),warn:d(b,"[Workpad warn!]: ",
"warn")}}})(workpad);
(function(){workpad.util.array=function(a){return{contains:function(c){if(a.indexOf)return-1!==a.indexOf(c);for(var b=0,d=a.length;b<d;b++)if(a[b]===c)return!0;return!1},without:function(c){c=workpad.util.array(c);for(var b=[],d=0,f=a.length;d<f;d++)c.contains(a[d])||b.push(a[d]);return b},get:function(){for(var c=0,b=a.length,d=[];c<b;c++)d.push(a[c]);return d},unique:function(){for(var c=[],b=0,d=a.length;b<d;b++)workpad.util.array(c).contains(a[b])||c.push(a[b]);return c},clone:function(){for(var c=
[],b=0,d=a.length;b<d;b++)c.push(a[b]);return c}}}})();(function(){var a=/^\s+/,c=/\s+$/;workpad.util.string=function(b){b=String(b);return{trim:function(){return b.replace(a,"").replace(c,"")},interpolate:function(a){for(var c in a)b=this.replace("#{"+c+"}").by(a[c]);return b},replace:function(a){return{by:function(c){return b.split(a).join(c)}}}}}})();
(function(){workpad.util.object=function(a){return{merge:function(c){for(var b in c)a[b]=c[b];return this},get:function(){return a},clone:function(){var c={},b;for(b in a)c[b]=a[b];return c},isArray:function(){return"[object Array]"===Object.prototype.toString.call(a)},safeJSON:function(){try{var c=JSON.parse(JSON.stringify(a))}catch(b){c={}}return c}}}})();
workpad.util.Events=Base.extend({on:function(a,c){this.events=this.events||{};this.events[a]=this.events[a]||[];this.events[a].push(c);return this},off:function(a,c){this.events=this.events||{};var b=0,d,f;if(a){d=this.events[a]||[];for(f=[];b<d.length;b++)d[b]!==c&&c&&f.push(d[b]);this.events[a]=f}else this.events={};return this},fire:function(a,c){this.events=this.events||{};for(var b=this.events[a]||[],d=0;d<b.length;d++)b[d].call(this,c);return this}});
workpad.data.predata=function(){return{EMPTY_DATA:[{content:"Begin to edit your workpad",description:"",id:"00000000-0000-0000-0000-000000000000",collapsed:!0,children:[]}]}}();workpad.data.check=function(a){return{isObject:function(){return"object"===typeof a&&"[object object]"===Object.prototype.toString.call(a).toLowerCase()&&!a.length}}};
(function(a){var c=a.util;a.data.pretty=function(b){return{get:function(){if(c.object(b).isArray()){for(var d=[],f=b.length,j=0;j<f;j++)if(a.data.check(b[j]).isObject())try{var l=JSON.stringify(b[j]);"{}"!==l&&d.push(JSON.parse(l))}catch(k){}1>d.length&&(d=a.data.predata.EMPTY_DATA);return d}return a.data.predata.EMPTY_DATA}}}})(workpad);
(function(a){var c=a.dom;c.addClass=function(a,d){var f=a.classList;if(f)return f.add(d);c.hasClass(a,d)||(a.className+=" "+d)};c.removeClass=function(a,c){var f=a.classList;if(f)return f.remove(c);a.className=a.className.replace(RegExp("(^|\\s+)"+c+"(\\s+|$)")," ")};c.hasClass=function(a,c){var f=a.classList;if(f)return f.contains(c);f=a.className;return 0<f.length&&(f==c||RegExp("(^|\\s)"+c+"(\\s|$)").test(f))}})(workpad);
(function(a){a.dom.offset=function(a){return{get:function(){var b=a&&a.ownerDocument,d={top:0,left:0},f;if(b)return f=b.documentElement,"undefined"!==typeof a.getBoundingClientRect&&(d=a.getBoundingClientRect()),b=null!=b&&b===b.window?b:9===b.nodeType&&b.defaultView,{top:d.top+b.pageYOffset-f.clientTop,left:d.left+b.pageXOffset-f.clientLeft,width:d.width,height:d.height}},set:function(){}}}})(workpad);
(function(){var a={className:"class"};workpad.dom.setAttributes=function(c){return{on:function(b){for(var d in c)b.setAttribute(a[d]||d,c[d])}}}})();
workpad.dom.style=function(a){var c={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},b=/\-[a-z]/g;return{setto:function(b){b=b.style;if("string"===typeof a)b.cssText+=";"+a;else{a=workpad.util.object(a).safeJSON();for(var c in a)"float"===c?(b.cssFloat=a[c],b.styleFloat=a[c]):b[c]=a[c]}},getfrom:function(d){if(d.nodeType===workpad.ELEMENT_NODE){var f=d.ownerDocument,j=a,l=c[a]||a.replace(b,function(a){return a.charAt(1).toUpperCase()}),k=d.style,g=d.currentStyle,
v=k[l];if(v)return v;if(g)try{return g[l]}catch(u){}var l=f.defaultView||f.parentWindow,f=("height"===j||"width"===j)&&"TEXTAREA"===d.nodeName,p;if(l.getComputedStyle)return f&&(p=k.overflow,k.overflow="hidden"),d=l.getComputedStyle(d,null).getPropertyValue(j),f&&(k.overflow=p||""),d}}}};workpad.dom.insert=function(a){return{after:function(c){c.parentNode.insertBefore(a,c.nextSibling)},before:function(c){c.parentNode.insertBefore(a,c)},into:function(c){c.appendChild(a)}}};
workpad.dom.observe=function(a,c,b){c="string"===typeof c?[c]:c;for(var d,f,j=0,l=c.length;j<l;j++)f=c[j],a.addEventListener?a.addEventListener(f,b,!1):(d=function(c){"target"in c||(c.target=c.srcElement);c.preventDefault=c.preventDefault||function(){this.returnValue=!1};c.stopPropagation=c.stopPropagation||function(){this.cancelBubble=!0};b.call(a,c)},a.attachEvent("on"+f,d));return{stop:function(){for(var f,g=0,j=c.length;g<j;g++)f=c[g],a.removeEventListener?a.removeEventListener(f,b,!1):a.detachEvent("on"+
f,d)}}};(function(a){a.dom.delegate=function(c,b,d,f){return a.dom.observe(c,d,function(d){for(var l=d.target,k=a.util.array(c.querySelectorAll(b));l&&l!==c;){if(k.contains(l)){f.call(l,d);break}l=l.parentNode}})}})(workpad);
workpad.dom.getParentElement=function(){function a(a,b){return!b||!b.length?!0:"string"===typeof b?a===b:workpad.util.array(b).contains(a)}return function(c,b,d){d=d||70;if(b.className||b.classRegExp){a:{var f=b.nodeName,j=b.className;for(b=b.classRegExp;d--&&c&&"BODY"!==c.nodeName;){var l;if(l=c.nodeType===workpad.ELEMENT_NODE)if(l=a(c.nodeName,f)){l=j;var k=(c.className||"").match(b)||[];l=!l?!!k.length:k[k.length-1]===l}if(l)break a;c=c.parentNode}c=null}return c}a:{f=b.nodeName;for(j=d;j--&&c&&
"BODY"!==c.nodeName;){if(a(c.nodeName,f))break a;c=c.parentNode}c=null}return c}}();
(function(a){var c=document;a.dom.editArea=Base.extend({constructor:function(b,c){var f=this;this.callback=b||a.EMPTY_FUNCTION;this.config=a.util.object({}).merge(c).get();this.editArea=this._createTextArea();setTimeout(function(){f.callback(f)},0)},insertInto:function(a){"string"===typeof a&&(a=c.getElementById(a));a.appendChild(this.editArea)},getEditArea:function(){return this.editArea},setContent:function(a){this.editArea.value=a;return this},getContent:function(){return this.editArea.value},
empty:function(){this.editArea.value="";return this},_createTextArea:function(){var b=c.createElement("textarea");b.className="workpad-editArea";a.dom.setAttributes({width:0,height:0}).on(b);return b}})})(workpad);workpad.Commands=Base.extend({constructor:function(a){this.editor=a;this.composer=a.composer;this.doc=this.composer.doc},support:function(a){return workpad.browser.supportsCommand(this.doc,a)}});
workpad.views.View=Base.extend({constructor:function(a,c,b){this.parent=a;this.element=c;this.config=b},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(a){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}});
(function(a){var c=a.dom;a.views.Composer=a.views.View.extend({name:"composer",constructor:function(a,c,f){this.base(a,c,f);this.wp=this.parent.wp;this._initEditArea()},_initEditArea:function(){var a=this;this.editArea=new c.editArea(function(){a._create()});this.editAreaElement=this.editArea.getEditArea();var d=this.wp.element;c.insert(this.editAreaElement).after(d)},_create:function(){this.doc=document;this.element=this.wp;this.wp=this.parent.wp;this.commands=new a.Commands(this.parent);this.observe()}})})(workpad);
(function(a){var c=a.dom,b=a.util;a.views.Composer.prototype.observe=function(){var a=this.parent.element,f=this.editArea.getEditArea();pasteEvents=["drop","paste"];b.debug(a,f).debug();c.observe(f,"keydown",function(){});c.delegate(a,".content","mouseover",function(a){b.debug(c.offset(a.target).get()).debug()})}})(workpad);
(function(a){var c=a.data;a.views.Wp=a.views.View.extend({name:"workpad",constructor:function(a,c,f){this.base(a,c,f);this._observe()},initContentByData:function(a){a=c.pretty(a).get();a=this.buildDomByDatas(a);this._setContent(a)},_setContent:function(a){this.element.innerHTML=a},_observe:function(){}})})(workpad);
(function(a){var c=a.util;a.views.Wp.prototype.buildDomByDatas=function(a){var c=this;return function j(a){for(var b="",g="",v=0,u=a.length;v<u;v++){var p=a[v];0<p.children.length&&p.collapse&&(g=j(p.children));b+=c.buildHTMLBySingleData({id:p.id,content:p.content,description:p.description,children:g});g=""}return b}(a)};a.views.Wp.prototype.buildHTMLBySingleData=function(a){return c.string('<div class="item" data-id="#{id}"><div class="maindata"><div class="content">#{content}</div><div class="description">#{description}</div></div><div class="children">#{children}</div></div>').interpolate(a)}})(workpad);
(function(a){var c={initContent:void 0};a.Init=a.util.Events.extend({constructor:function(b,d){this.element="string"===typeof b?document.getElementById(b):b;this.config=a.util.object({}).merge(c).merge(d).get();this.currentView=this.wp=new a.views.Wp(this,this.element,this.config);this._isCompatible=a.browser.supported();this.currentView=this.composer=new a.views.Composer(this,this.wp,this.config);this.wp.initContentByData(this.config.initContent)}})})(workpad);
//@ sourceMappingURL=workpad.js.map